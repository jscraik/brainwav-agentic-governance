docs:
  - id: constitution
    file: .cortex/rules/00-core/constitution.md
    sha: e766755420bf5b0466a83722340de170e487d6d055b1172cf9686add88c5e1d3
    url: https://governance.cortex-os.local/docs/00-core/constitution.md
    full_text: >
      ---

      trigger: always_on

      alwaysApply: true

      ---

      # brAInwav Cortex-OS Constitution


      **Version**: 1.4.0  

      **Ratified**: 2025-10-08  

      **Last Amended**: 2025-11-12  

      **Maintainer**: brAInwav Development Team


      ---


      ## Purpose


      This constitution defines the **foundational principles** that govern all
      development within the brAInwav Cortex-OS ecosystem. It complements and
      extends the consolidated `AGENT_CHARTER.md` (Rules of AI) and
      `CODESTYLE.md` with project-specific governance for feature development,
      agent behavior, and quality standards. It is part of the **Governance
      Pack** (`/.cortex/rules/*`) and is **binding** on all repositories in the
      org.


      ---


      ## I. Core Principles


      ### 1. brAInwav Production Standards (NON-NEGOTIABLE)


      **No Mock Production Claims**: Never describe any implementation as
      "production-ready", "complete", "operational", or "fully implemented" if
      it contains any of the following in production paths:


      - `Math.random()` or fabricated data

      - Hardcoded mocks or placeholder adapters ("will be wired later")

      - `TODO`/`FIXME`/`HACK`, or `console.warn("not implemented")`

      - Fake metrics/telemetry


      **brAInwav Branding**: All system outputs, error messages, health checks,
      and status logs **must** include brAInwav branding (`"[brAInwav]"` and
      `brand:"brAInwav"` in structured logs).


      **Evidence-Based Status**: Status claims must be verified against passing
      gates and attached evidence.


      **Type Safety & Style (prod paths)**: No `any` in TS, **named exports
      only**, max **40 lines per function**, guard clauses, strict boundary
      types, `async/await` with **cancellation** (`AbortSignal` or SDK
      equivalent).


      **Domain Boundaries**: No cross-domain imports; interact via declared
      contracts (A2A topics, MCP tools/resources/prompts).


      ### 2. Test-Driven Development (MANDATORY)


      **Red‚ÄìGreen‚ÄìRefactor**:


      1) Write failing tests first  

      2) Implement minimal pass  

      3) Refactor while staying green


      **Coverage Requirements**: ‚â• **90% global**, ‚â• **95% changed lines**;
      mutation ‚â• **90%** where enabled. TDD plan stored per task.


      ### 3. Accessibility First (WCAG 2.2 AA)


      Semantic HTML/ARIA, keyboard complete, target ‚â• 44√ó44 CSS px,
      screen-reader coverage via `jest-axe`/axe/Playwright a11y.

      **Normative reference**: **WCAG 2.2 AA (ISO/IEC 40500:2025)**.


      ### 4. Monorepo Integrity


      Use affected-only **smart** targets (`pnpm *:smart`), respect Nx
      dependency graph, forbid circular deps. Follow repo structure rules and
      structure guard.


      ### 5. Agent-First Architecture


      **MCP** for external tools (contracts with Zod; audited via MCP audit
      events).  

      **A2A** for inter-agent comms (event envelopes; no direct cross-domain
      imports).  

      **Local Memory** for persistent context with **MCP/REST parity** (see
      ¬ßII.3 & ¬ßIII Documentation).


      **Structured Outputs (REQUIRED)**: Any model output that drives
      code/files/network **must** be produced via **function/tool calling** or
      **JSON‚ÄëSchema‚Äìenforced structured outputs**. Free‚Äëtext is prohibited for
      machine‚Äëconsumed steps.


      **Wikidata Semantic Surface**: The Wikidata connector defined in
      `config/connectors.manifest.json` is the canonical semantic-knowledge
      interface. Agents must route fact-finding and entity enrichment through
      this surface unless the Constitution grants an explicit waiver.


      **Academic Research Integration**: Agents must enhance all implementation
      plans with academic research from multiple sources (Wikidata vector
      search, arXiv, Semantic Scholar, OpenAlex, Context7) **and validate
      licenses** before vibe-check submission, per `vibe-check.md` ¬ß2.1.


      ### 6. Security by Default


      - Semgrep (**block ERROR**), gitleaks (**block ANY**), OSV clean  

      - **SBOM (CycloneDX 1.7)**  

      - **Provenance (SLSA v1.1)**  

      - **Sign & verify with Cosign v3 bundle** artifacts  

      - Minimal/pinned containers (non‚Äëroot, read‚Äëonly FS, drop caps)  

      - **No secrets in code**. Use shared env loader
      (`scripts/utils/dotenv-loader.mjs` or `@cortex-os/utils`) ‚Äî **never call
      `dotenv.config()` directly**.  

      - Secrets are retrieved **on demand** via the **1Password CLI (`op`)**;
      never persisted in repo or long‚Äëlived env vars.


      ### 7. Time Freshness Guard


      All reasoning anchored to harness "today"; convert relative dates to
      **ISO-8601**; treat "latest/current" as freshness checks. (See
      `10-flow/cortex-aegis.md` ¬ß Time Freshness Policy.)


      ### 8. Hybrid Model Solution ‚Äî **Live Only**


      Embeddings, rerankers, generations must use **live** engines (MLX, Ollama,
      or approved Frontier). **No stubs, recorded outputs, or "dry_run" modes.**
      Pre-merge evidence requires `pnpm models:health && pnpm models:smoke` logs
      (engine, model IDs, vector dims/norms, latency).


      ### 9. Governance Hooks (AGENTS.md + Vibe-Check)


      Agents must load the nearest `AGENTS.md` and record its SHA
      (`AGENTS_MD_SHA:<sha>`) in run state and logs. Agents must call **Vibe
      Check MCP** `vibe_check` after planning and **before** file writes/network
      calls/long runs; logs must include `"brAInwav-vibe-check"`.


      ### 10. Observability & Trace Context (NORMATIVE)


      All charter-governed logs are structured JSON and include: ISO‚Äë8601
      timestamp, `[brAInwav]` prefix, `brand:"brAInwav"`, **W3C Trace Context**
      correlation (`traceparent` header value) and `trace_id`/`span_id` fields
      for **OpenTelemetry** correlation.


      ### 11. Identity & Secrets (Federated)


      CI workflows and long‚Äëlived services **must** use **OIDC/WIF** to cloud
      providers (AWS/Azure/GCP). Static long‚Äëlived credentials are prohibited.
      Secret material is injected at runtime via **1Password CLI** secret
      references.


      ---


      ## II. Development Workflow (Phases & HITL)


      ### Phase Machine (R ‚Üí G ‚Üí F ‚Üí REVIEW) ‚Äî HITL Only at REVIEW


      - **R (Red)**: Write failing tests; plan minimal pass. No `human_input`
      (except **Ask‚ÄëFirst ‚â§3** clarifications in G0/G1). Auto‚Äëadvance to **G**
      once new failing tests then pass on next commit and time‚Äëfreshness
      evidence is logged.

      - **G (Green)**: Implement to pass; run security scans and **live model
      smoke**. No `human_input`. Auto‚Äëadvance to **F** when tests pass and
      coverage/mutation gates are met.

      - **F (Finished)**: Refactor, docs, a11y, SBOM/provenance, structure
      guard. No `human_input`. Auto‚Äëadvance to **REVIEW** when a11y + scanners +
      supply‚Äëchain + model‚Äëhealth evidence are attached.

      - **REVIEW**: **HITL permitted**; complete Code Review Checklist;
      approvals/waivers per Constitution.


      **Forbidden**: Any `human_input` before REVIEW is a policy violation
      (aside from the Ask‚ÄëFirst G0/G1 allowance).


      **Canonical details** (tokens, artifacts, CI mapping) are defined in:  

      `/.cortex/rules/agentic-phase-policy.md` (v2025.11) and
      `/.cortex/rules/agentic-coding-workflow.md`.


      ### Evidence Tokens (CI-Scanned)


      ---


      ## III. Quality Standards


      ### Code Quality


      ESLint/Biome/ast-grep; Python Ruff; Rust Clippy; no `console.log` in prod
      paths; deterministic outputs; structured logs with brand + request/run
      IDs; **OTel traces/logs/metrics with correlation**.


      ### Testing Requirements


      Vitest (TS), pytest (Py), property-based for critical code, Stryker
      mutation where enabled. a11y tests via axe/jest-axe/Playwright.


      ### Documentation


      Each package requires README with purpose, setup, API, examples,
      branding.  

      Per-task artifacts stored under `~/tasks/[feature]/`.  

      **Local Memory parity**: decisions/rationales appended to
      `.github/instructions/memories.instructions.md` **and** persisted via
      Local Memory MCP/REST.


      ### Runtime Surfaces & Auth


      MCP requires API key by default (dev may set `NO_AUTH=true`). OAuth2 mode
      (Auth0) allowed with scopes: `search.read`, `docs.write`, `memory.read`,
      `memory.write`, `memory.delete`; RBAC + Add-Permissions-in-Token enabled.
      MCP config must match port registry (`3024`, `3026`, `3002`, `39300`) and
      `.well-known/mcp.json`.


      ---


      ## IV. Feature Development Standards


      Prioritized stories (P0‚ÄìP3) that are **independently testable**;
      Given‚ÄìWhen‚ÄìThen acceptance criteria.  

      Technical debt tracked via ADRs + Issues with payoff plan.


      ---


      ## V. Compliance & Governance


      **Licensing**: Apache‚Äë2.0; `pnpm license:validate`; **SBOM via CycloneDX
      1.7**.  

      **Provenance**: **SLSA v1.1** attestations; verify with **Cosign v3
      bundle**.  

      **Privacy**: Local-first; GDPR erasure; privacy-preserving telemetry.


      **Review & Checklists (ENFORCED)**:


      - A **human (non-author)** completes and posts
      `/.cortex/rules/code-review-checklist.md`.  

      - BLOCKER items must be PASS; MAJORs need fixes or a waiver; MINORs need a
      follow-up task.


      ---


      ## VI. Amendment Process


      **Proposing Changes**: Create ADR; include rationale/impact; maintainer
      approval; bump version; announce.  

      **Conflict Resolution (highest ‚Üí lowest)**:


      1. **Governance Pack** (`/.cortex/rules/*`) with precedence:
         - `AGENT_CHARTER.md` (immutable ethics; consolidates Rules of AI)
         - **This Constitution**
         - `vision.md`, `agentic-coding-workflow.md`, `agentic-phase-policy.md`, `code-review-checklist.md`, `cortex-aegis.md` (Time Freshness Policy), `CHECKLIST.cortex-os.md`
      2. `CODESTYLE.md`  

      3. Root `AGENTS.md`  

      4. Package-level `AGENTS.md`  

      5. Model guides (adapters)


      ---


      ## VII. Enforcement


      **Automated**: CI gates (coverage/mutation, structure, security, a11y),
      evidence-token scan, checklist presence, live-model probes,
      **trace-context verification**, env-loader rule, domain boundary checks.


      **Manual**: Code owners approve; checklist verified; architecture
      decisions reviewed.


      **Continuous Improvement**: Retros, metrics, periodic audits.


      ---


      Co-authored-by: brAInwav Development Team
  - id: agent_charter
    file: .cortex/rules/00-core/AGENT_CHARTER.md
    sha: d9a9ef1575b4e1c4555a36f8e63ef5e0b8cc124c79e5b78de62b2ba7d8723968
    url: https://governance.cortex-os.local/docs/00-core/AGENT_CHARTER.md
    full_text: >
      # brAInwav ArcTDD Charter (Full Specification v2.0.0)


      **Status:** MANDATORY - Must be included in ALL agent instruction files  

      **Enforcement:** CI validates presence via SHA-256 checksum  

      **Last Updated:** 2025-10-29

      **Version:** 2.1.1


      ---


      ## ‚ö° **OPERATIVE GUARDRAILS** (Non-Negotiable)


      All agents executing workstreams within Cortex-OS MUST obey these rules:


      ### 1Ô∏è‚É£ **Step Budget ‚â§ 7** [AGENTS-STP-001]


      - Each execution arc MUST complete within **seven discrete plan/act
      iterations**

      - Larger efforts MUST be split into multiple arcs

      - **Enforcement**: `run-manifest.json` validation blocks merge if
      `arc.plan_steps.length > 7`

      - **Runtime Check**: Phase machine rejects arcs exceeding budget


      **Rationale:** Prevents cognitive overload and ensures atomic, reviewable
      units of work.


      ---


      ### 2Ô∏è‚É£ **Ask-First ‚â§ 3** [AGENTS-ASK-002]


      - Agents MAY ask at most **three clarifying questions** before writing
      code

      - Each question MUST enumerate **concrete options and consequences**

      - **Format**: "Choice: (A) option1 [consequence]; (B) option2
      [consequence]; (C) option3 [consequence]"

      - **Enforcement**: Interaction counter logs violations; coordinator blocks
      4th question


      **Rationale:** Reduces clarification loops and encourages autonomous
      decision-making within documented constraints.


      ---


      ### 3Ô∏è‚É£ **Explain-While-Doing** [AGENTS-EXP-003]


      - Narrate intent alongside actions in commits, diffs, and task logs

      - Enable reviewers to audit rationale without context-switching

      - **Enforcement**: Narrated diffs required in PR body (CI checks for
      presence)


      **Rationale:** Maintains audit trail and knowledge transfer; prevents
      "black box" implementations.


      ---


      ### 4Ô∏è‚É£ **Proof Required** [AGENTS-PRF-004]


      - Every behavioral change MUST ship with **executable proof**:
        - ‚úÖ Failing test first (red)
        - ‚úÖ Passing test after (green)
        - ‚úÖ Mutation or property evidence when applicable
      - **Evidence Triplet** mandatory per arc:
        1. Milestone test path (red‚Üígreen proof)
        2. Contract snapshot (types/schema/route)
        3. Reviewer JSON pointer
      - **Enforcement**: CI blocks merge if Evidence Triplet incomplete


      **Rationale:** TDD discipline ensures verifiable behavior; mutation
      testing prevents brittle tests.


      ---


      ### 5Ô∏è‚É£ **Recap in ‚â§ 500 Tokens** [AGENTS-RCP-005]


      - Close each arc with structured recap:
        - Scope, decisions, tests, follow-ups
        - Written to `evidence/recaps.log`
      - **Enforcement**: Token counter validates; excess triggers warning

      - **Format**: Generate recaps after every 400‚Äì700 tokens of output,
      ensuring each recap ‚â§ 500 tokens


      **Rationale:** Maintains context across sessions; prevents drift in
      long-running tasks.


      ---


      ### 6Ô∏è‚É£ **Brand Logs** [AGENTS-BRD-006]


      - Runtime and workflow logs MUST include:
        - Field: `{ "brand": "brAInwav" }`
        - Prefix: `[brAInwav]` in console output
      - OPA/Conftest policies enforce the following tokens in every
      charter-governed log line:
        - `MODELS:LIVE:OK` when model health passes
        - Latency markers (e.g., `LATENCY:123ms` or structured JSON field)
        - ISO-8601 timestamps with timezone offset
        - `NORTH_STAR:RED_FIRST` for the initial failing acceptance execution
        - `NORTH_STAR:GREEN_AFTER` once the acceptance turns green
      - **Enforcement**: Grep validation in CI; missing brand fails build


      **Rationale:** Ensures observability and traceability across distributed
      systems.


      #### Example Charter-Compliant Logs


      ```json

      {
        "timestamp": "2025-10-28T19:22:11.402-07:00",
        "brand": "brAInwav",
        "phase": "north_star",
        "marker": "NORTH_STAR:RED_FIRST",
        "latency_ms": 742,
        "model_status": "MODELS:LIVE:OK",
        "trace_id": "c6f2b0d7a9124f6c",
        "message": "Acceptance failed as expected"
      }

      ```


      ---


      ## üö® **AI BEHAVIORAL RULES** (Production Standards)


      > **Source:** Consolidated from RULES_OF_AI.md for single source of truth
      on AI behavior


      ### Hierarchy of Authority


      When documents overlap or conflict, follow this order (highest ‚Üí lowest):


      1. **Governance Pack** `/.cortex/rules/*` ‚Äî binding project rules

      2. **CODESTYLE.md** (root) ‚Äî coding & testing conventions enforced by CI

      3. **AGENTS.md** (root) ‚Äî operational rules for agents; repo defaults

      4. **Package-level `AGENTS.md`** ‚Äî may tighten rules; cannot weaken repo
      standards

      5. **Model guides** (`GPT-5-Codex.md`, `CLAUDE.md`, `QWEN.md`,
      `GEMINI.md`) ‚Äî adapter specifics only


      ### Production Truthfulness Standards


      #### Rule 1 ‚Äî No false implementation claims


      Never claim "production-ready/complete/operational" if any prod path
      contains:


      - `Math.random()`-fabricated data, hardcoded mocks, placeholder adapters
      ("will be wired later")

      - `TODO/FIXME/HACK`, `console.warn("not implemented")`

      - Fake metrics/telemetry


      #### Rule 2 ‚Äî brAInwav truthfulness standard


      - Verify claims against actual code & passing gates.

      - Distinguish test scaffolding from production.

      - Include brAInwav branding in outputs/errors.

      - Do not inflate readiness/completion metrics.


      #### Rule 3 ‚Äî Production validation requirements


      - [ ] Placeholders eliminated  

      - [ ] Real integrations in place (no fake data)  

      - [ ] Errors/logs branded `[brAInwav]` / `brand:"brAInwav"`  

      - [ ] Docs match code  

      - [ ] Tests validate real functionality


      #### Rule 4 ‚Äî Documentation accuracy


      - Status/percentages based on real metrics.

      - READMEs reflect current implementation.


      #### Rule 5 ‚Äî Commit message standards


      - Accurate, evidence-backed messages.

      - Add `Co-authored-by: brAInwav Development Team` when appropriate.


      ### Code Standards (Production Paths)


      - **Named exports only** (no `export default`)

      - **‚â§ 40 lines per function** (compose via guard clauses)

      - **No `any` in TypeScript** (except tests/justified compat shims)

      - **No cross-domain imports** ‚Äî use A2A topics/MCP tools/declared
      contracts

      - **async/await + AbortSignal** ‚Äî no `.then()` chains

      - **Structured logging** ‚Äî `brand:"brAInwav"`, request/run IDs, OTel
      traces


      ### Security & Supply Chain


      **Scanners (blocking)**:


      - **Semgrep** ‚Äî block on ERROR  

      - **gitleaks** ‚Äî block on ANY secret detection  

      - **OSV/audit** ‚Äî clean lockfiles  

      - **SBOM** ‚Äî CycloneDX 1.6 (ECMA-424) generated for all artifacts


      **Environment/config**:


      - Use shared loader (`scripts/utils/dotenv-loader.mjs` or
      `@cortex-os/utils`)

      - **Never call `dotenv.config()` directly**

      - No hardcoded secrets; env/secret managers only; retrieve API keys, SSH
      keys, and tokens via the 1Password CLI (`op`) at runtime


      ### Hybrid Model Solution ‚Äî Live-Only (CONSTITUTIONAL)


      **Hard rule**: Embeddings, rerankers, generations must use **live**
      engines:


      - **MLX** (local on-device)

      - **Ollama** (local server)  

      - **Frontier APIs** (OpenAI/Anthropic/Google/etc.)


      **Forbidden**: Stubs/recordings/`dry_run` for models. No cached "golden"
      vectors. No echo rerankers.


      **Evidence before merge**: `pnpm models:health && pnpm models:smoke`;
      attach logs (engine, model IDs, vector norms/shape, latency).


      **Fallback chain**: MLX ‚Üí Ollama ‚Üí Frontier (if live). If unavailable,
      mark task **blocked**; escalate per Constitution.


      ### Performance Standards (Constitutional)


      **Performance components must meet these non-negotiable standards**:


      #### Rule 1 ‚Äî Performance Component Standards


      - **No performance regressions**: All performance components must improve
      or maintain existing performance metrics

      - **Real metrics only**: No fake or simulated performance data in
      production code

      - **Comprehensive monitoring**: Every performance component must include
      structured metrics and health checks

      - **Graceful degradation**: Performance failures must not crash the system


      #### Rule 2 ‚Äî Auto-Scaling Standards


      - **ML model validation**: Auto-scaling ML models must be trained on real
      data with proven accuracy (>80%)

      - **Cost optimization**: Scaling decisions must consider cost implications
      and optimize for efficiency

      - **Emergency handling**: Auto-scaling must include emergency response
      protocols for critical load conditions

      - **Predictive accuracy**: Load forecasting must achieve minimum accuracy
      thresholds


      #### Rule 3 ‚Äî Resource Management Standards


      - **Memory efficiency**: GPU and memory management must minimize waste and
      prevent leaks

      - **Fair scheduling**: Resource allocation must be fair and prevent
      starvation

      - **Capacity planning**: Resource management must include forward-looking
      capacity analysis

      - **Resource isolation**: Performance components must not impact core
      system functionality


      #### Rule 4 ‚Äî Monitoring Standards


      - **Real-time metrics**: All performance components must emit real-time
      metrics

      - **Alert thresholds**: Performance alerts must have meaningful thresholds
      with clear escalation paths

      - **Performance baselines**: Every component must establish and maintain
      performance baselines

      - **Anomaly detection**: Performance monitoring must include automated
      anomaly detection


      #### Rule 5 ‚Äî Integration Standards


      - **Event-driven communication**: Performance components must use A2A
      events for inter-component communication

      - **Circuit breaker patterns**: All external dependencies must include
      circuit breaker protection

      - **Backward compatibility**: Performance improvements must not break
      existing integrations

      - **Configuration-driven**: Performance behavior must be configurable
      without code changes


      ### Quality Gates & Evidence


      **Coverage & mutation**:


      - **‚â• 90% global coverage**

      - **‚â• 95% changed lines**

      - **‚â• 90% mutation** (where enabled)


      **Tests**: TDD (Red-Green-Refactor); co-locate tests; property-based for
      critical paths.


      **Performance**: Bundle budgets, latency thresholds enforced in CI.


      ### Accessibility (WCAG 2.2 AA ¬∑ ISO/IEC 40500:2025)


      **Non-negotiable**:


      - Semantic HTML, correct ARIA roles, keyboard-complete, target ‚â• 44√ó44 CSS
      px

      - Screen-reader testing via `jest-axe`/axe

      - No color-only signaling; consistent focus order

      - CLI/TUI: support `--plain` output + high-contrast mode


      Include brAInwav branding in a11y announcements where appropriate.


      ```text

      [brAInwav] 2025-10-28T19:22:11.402-07:00 LATENCY:742ms MODELS:LIVE:OK
      NORTH_STAR:RED_FIRST Acceptance failed as expected

      ```


      Once the acceptance passes, emit `NORTH_STAR:GREEN_AFTER` with the same
      envelope. Emit `MODELS:LIVE:OK` only after hybrid model health checks
      succeed; stale connectors MUST prevent emission.


      #### Failure Modes & Incident Response


      - **Misconfigured logger wrappers** (missing decorators) ‚Üí redeploy the
      last known-good wrapper or roll back the partial change.

      - **Partial rollouts** mixing old/new formats ‚Üí promote a consistent build
      or gate traffic until all pods emit the enforced tokens.

      - **Incident hotfix bypassing middleware** ‚Üí capture a temporary waiver
      only when the hotfix blocks execution of the failing acceptance test, then
      restore the wrapper within 24 hours.


      Detection relies on CI Conftest failures, observability counters tracking
      `NORTH_STAR:`/`LATENCY:` frequency, and reviewer manifest audits. During
      incidents, run synthetic acceptance tests to re-seed `RED_FIRST` and
      `GREEN_AFTER` markers, document compensating controls, and preserve
      sanitized log content to honour privacy guarantees.


      ---


      ### 7Ô∏è‚É£ **Arc Protocol** [AGENTS-ARC-007]


      - Implementations MUST be organized into discrete **arcs** (vertical
      slices)

      - Each arc MUST:
        - Deliver ‚â§ 7 steps (see Guardrail #1)
        - Span 2‚Äì5 commits and 45‚Äì120 minutes end-to-end
        - Produce a **milestone test** (red ‚Üí green proof)
        - Freeze its contract (types/schema/route) before implementation
        - Include a contract snapshot in `design/contracts/`
      - **Enforcement**: `run-manifest.json` schema validates arc structure; CI
      blocks merge if arc lacks milestone test or contract snapshot


      **Rationale:** Vertical slices deliver incremental value; contract freeze
      prevents mid-arc scope creep.


      ---


      ### 8Ô∏è‚É£ **North-Star Acceptance Test** [AGENTS-NST-008]


      - Every task MUST define a **North-Star acceptance test** before
      implementation begins

      - Test MUST:
        - Prove the feature is real (Gherkin, HTTP contract, or executable spec)
        - Be written in `tests/acceptance/<slug>.spec.[ts|js|py|http]`
        - Fail initially, pass upon task completion
      - **Enforcement**: `run-manifest.json` requires
      `north_star.acceptance_test_path`; CI blocks merge if path missing or test
      not executable


      **Rationale:** Ensures goal clarity and prevents "almost done" syndrome;
      provides unambiguous completion criteria.


      ---


      ### 9Ô∏è‚É£ **Preflight Guards** [AGENTS-PRV-009]


      - Before any file writes, network calls, or long executions, agents MUST
      execute **preflight guards**:
        1. **Cortex Vibe (Oversight)** ‚Äì `pnpm oversight:vibe-check` or JSON-RPC to `${CORTEX_VIBE_HTTP_URL:-http://127.0.0.1:2001}`
           - Required headers: `Accept: application/json, text/event-stream`
           - Log saved to `logs/vibe-check/<task>.json`
        2. **Hybrid Model Health** ‚Äì `pnpm models:health && pnpm models:smoke` with live MLX/Ollama/Frontier engines (no stubs)
        3. **Knowledge Connector Health** ‚Äì Verify `${WIKIDATA_MCP_URL}/healthz` and `${ARXIV_MCP_URL}/healthz`; log to `research/connectors-health.log`
        4. **Trace Context Verification** ‚Äì `pnpm tsx scripts/ci/verify-trace-context.ts <logfile>` ensures W3C `trace_id` in all logs
        5. **Supply-Chain Evidence** ‚Äì `pnpm sbom:generate && pnpm attest:sign && pnpm verify:attest && pnpm sbom:scan`; store in `sbom/`
        6. **Identity Gate** ‚Äì CI/services MUST use GitHub Actions OIDC/WIF (no static credentials)
      - **Run Manifest Requirements**: `run-manifest.json` MUST include JSON
      pointers for each attached log artifact **and** persist the raw text
      submitted to policy helpers so OPA/Conftest inputs remain reproducible.

      - **Enforcement**: PR MUST attach preflight logs (vibe-check, model
      health, connector health, trace verification, SBOM attestation); missing
      logs block merge


      **Rationale:** Prevents governance bypass and ensures all runtime
      dependencies are healthy before execution begins.


      #### Run Manifest Evidence Structure


      ```json

      {
        "log_evidence": [
          {
            "pointer": "/preflight/logs/0",
            "artifact_path": "logs/vibe-check/arc-17.json",
            "raw_text": "[brAInwav] 2025-10-28T19:22:11.402-07:00 LATENCY:742ms MODELS:LIVE:OK NORTH_STAR:RED_FIRST Acceptance failed as expected",
            "sha256": "d41d8cd98f00b204e9800998ecf8427e"
          },
          {
            "pointer": "/preflight/logs/1",
            "artifact_path": "logs/vibe-check/arc-17.json",
            "raw_text": "[brAInwav] 2025-10-28T19:27:49.115-07:00 LATENCY:285ms MODELS:LIVE:OK NORTH_STAR:GREEN_AFTER Acceptance passed"
          },
          {
            "pointer": "/preflight/logs/connector-health",
            "artifact_path": "research/connectors-health.log",
            "raw_text": "[brAInwav] 2025-10-28T19:20:04.010-07:00 LATENCY:93ms CONNECTOR:WIKIDATA MODELS:LIVE:OK status=200"
          }
        ]
      }

      ```


      Pointers MUST align with the manifest schema, artifact paths MUST remain
      accessible to reviewers, and `raw_text` MUST be byte-identical to the
      content evaluated by policy helpers. Include hashes when feasible to
      streamline tamper checks.


      #### Automation Reference


      - **Conftest Policy**: Extend `log_tokens.rego` to assert the presence of
      `MODELS:LIVE:OK`, `NORTH_STAR:RED_FIRST`, `NORTH_STAR:GREEN_AFTER`,
      latency markers (`LATENCY:` or `latency_ms`), and ISO-8601 timestamps
      across `log_evidence[*].raw_text`.

      - **Manifest Validator**: Ship a lightweight Node.js/Python script that
      parses `run-manifest.json`, ensures every log evidence entry contains
      `pointer`, `artifact_path`, and `raw_text`, and confirms referenced
      artifacts exist (stream large files to avoid memory blow-ups).

      - **CI Integration**: Run both checks in the `policy-opa` job after unit
      tests. Cache policy bundles, fail fast with actionable messages, and
      export metrics (`policy.log_tokens.success`) for observability dashboards.

      - **Local Task**: Provide `pnpm policy:validate` mirroring CI behaviour so
      contributors can lint manifests pre-push.


      ---


      ### üîü **Session Hygiene** [AGENTS-SHG-010]


      - Agents MUST reset session context periodically to prevent drift:
        - **Cadence**: 50 minutes build / 10 minutes reset
        - **Context Diet**: Last 2 plan bullets + current failing test + current file + manifest summary only
        - **Hard Reset Triggers**:
          - 2 off-spec suggestions in a row
          - ‚â• 3 speculative edits without tests
          - Proposes renaming core interfaces mid-arc
      - Session resets MUST be logged in `run-manifest.json` with ISO-8601
      timestamps

      - **Enforcement**: CI warns if `session_resets` array empty and task
      duration > 60 minutes; reviewers verify reset discipline


      **Rationale:** Prevents context drift in long sessions; maintains focus on
      current arc objectives.


      ---


      ## üîí **ENFORCEMENT MECHANISMS**


      | Guardrail | Detection | Prevention | Recovery |

      |-----------|-----------|------------|----------|

      | Step Budget (#1) | `validate-run-manifest.ts` | Phase machine rejects |
      Split into new arc |

      | Ask-First (#2) | Interaction logs | Coordinator blocks 4th Q | Document
      assumption |

      | Explain-While-Doing (#3) | `narrated-diff.ts` check | PR template
      requires | Request amendment |

      | Proof Required (#4) | CI Evidence Triplet check | Template scaffolds
      tests | Add retroactive proof |

      | Recap Rule (#5) | Token counter | Template auto-generates | Trim to ‚â§500
      tokens |

      | Brand Logs (#6) | `grep -r 'brand.*brAInwav'` | Logger wrapper | Patch
      log calls |

      | Arc Protocol (#7) | `validate-run-manifest.ts` (arc structure, milestone
      test, contract snapshot) | Task scaffolding enforces arc template | Add
      missing arc artifacts |

      | North-Star Test (#8) | `validate-run-manifest.ts`
      (`north_star.acceptance_test_path` required) | `pnpm changelog:new`
      generates acceptance test scaffold | Write missing north-star test |

      | Preflight Guards (#9) | CI checks for `logs/vibe-check/*.json`, model
      health logs, trace context, SBOM | PR template checklist requires
      preflight evidence | Execute missing guards and attach logs |

      | Session Hygiene (#10) | `run-manifest.json` `session_resets` timestamps;
      reviewer audit | 10-minute reset hook calls `pnpm session:reset` | Log
      retrospective resets with justification |


      ---


      ## üìã **QUICK REFERENCE**


      **Before starting any task:**


      ```bash

      pnpm changelog:new --slug my-feature --tier feature  # Scaffolds
      charter-compliant structure + north-star test

      pnpm oversight:vibe-check --goal "<task>" --plan "<steps>" --session
      <id>  # Preflight guard

      pnpm models:health && pnpm models:smoke  # Verify live model engines

      ```


      **During implementation:**


      ```bash

      pnpm arc:new --slug my-feature --title "Arc 1: API boundary"  # Max 7
      steps enforced

      pnpm session:reset --slug my-feature  # At 50-minute mark

      ```


      **Before committing:**


      ```bash

      pnpm charter:validate  # Runs all charter compliance checks

      pnpm tsx scripts/ci/verify-trace-context.ts logs/dev.log  # Verify W3C
      trace_id

      pnpm sbom:generate && pnpm attest:sign && pnpm verify:attest  #
      Supply-chain evidence

      ```


      **In PR:**


      - Attach Evidence Triplet links (milestone test, contract snapshot,
      reviewer JSON)

      - Include narrated diff in body

      - Attach preflight logs: `logs/vibe-check/*.json`, model health output,
      connector health log, SBOM attestation

      - Reference `CHARTER_SHA256:
      1c8cbc194209f690ae9fd015c04223a1c619853190d6302a5ccfea6769ceac5f` in
      description


      ---


      ## üîó **CANONICAL REFERENCE**


      This document is authoritative. Any conflicts defer to:


      1. `/.cortex/rules/AGENT_CHARTER.md` (this file - full specification)

      2. `/.cortex/rules/agentic-coding-workflow.md` (workflow integration and
      task lifecycle)

      3. `/.cortex/rules/code-review-checklist.md` (verification)


      **Workflow Integration Notes:**


      - The full task lifecycle (gates G0‚ÄìG10) is governed by
      `agentic-coding-workflow.md`

      - Workflow MAY define task tiers (fix/feature/refactor) with
      differentiated gate requirements, provided all tiers enforce these core
      guardrails

      - Waivers policy detailed in **DEVIATION POLICY** below


      **Fragment SHA-256:**
      `3289664bc8ba94bec3d1418292b76558bcf2ec0eb974e7317f2fb437b5848067`

      **Fragment Path:** `/.cortex/rules/CHARTER_FRAGMENT.md`


      ---


      ## üìñ **GLOSSARY**


      - **Arc**: A vertical slice of work spanning API ‚Üí logic ‚Üí store ‚Üí tests,
      completed in 2‚Äì5 commits and 45‚Äì120 minutes.

      - **Step Budget**: Maximum of 7 discrete plan/act iterations per arc
      before splitting into a new arc.

      - **Evidence Triplet**: Three required artifacts per arc: (1) milestone
      test path, (2) contract snapshot, (3) reviewer JSON.

      - **North-Star Test**: An acceptance test written before implementation
      that proves the feature is real (must fail initially, pass upon
      completion).

      - **Preflight Guards**: Six mandatory checks before file writes/network
      calls: vibe-check, model health, connector health, trace context, SBOM,
      identity gate.

      - **Session Hygiene**: 50-minute work / 10-minute reset cadence with
      context diet and hard reset triggers.


      ---


      ## ‚ö†Ô∏è **DEVIATION POLICY**


      Waivers require **Maintainer approval** under `/.cortex/waivers/`. All
      deviations must:


      - Document justification with evidence

      - Specify compensation controls

      - Set expiration date (max 30 days)

      - Link to remediation plan

      - **Waiver Activation Rule:** A charter waiver is valid only after the
      `charter-enforce / danger` job posts ‚úÖ with a link to the `Apply Waiver`
      workflow run that recorded Maintainer approval.

      - **Emergency Waiver Sync:** If `charter-enforce / danger` or the Apply
      Waiver workflow is offline, treat any waiver as **provisional**‚Äîrecord
      Maintainer approval + compensating controls in `/.cortex/waivers/<id>.md`,
      annotate the PR with manual evidence, and hold a merge freeze unless
      explicitly escalated. When automation returns, re-run the Apply Waiver
      workflow, re-trigger the Danger job until the comment links to that run,
      and append a post-incident note referencing the workflow URL and restored
      automation timestamp.


      **Reviewer Guidance:**


      - "Red first" waivers (Guardrail #4) are acceptable only when a production
      incident blocks execution of a failing acceptance test. Waivers MUST
      capture validated reproduction evidence and include a follow-up task
      restoring the red-first proof within 24 hours.

      - Connector freshness waivers (Preflight Guard #3) MAY be approved during
      documented upstream outages when cached telemetry and timestamps are
      attached. These waivers expire within 72 hours and require explicit
      reviewer sign-off on compensating controls.


      Unapproved deviations are **constitutional violations** and will block
      merge.


      #### Connector Freshness Waiver Example


      ```yaml

      waiver_id: WAIVER-2025-10-28-connector-outage

      rule_ids: [AGENTS-PRV-009]

      approver: @maintainer-handle

      requested_by: @oncall-engineer

      expiry: 2025-10-30T19:00:00Z

      reason: |
        Wikidata upstream outage prevented live freshness probes during incident INC-4721.
        Cached dataset timestamped 2025-10-28T18:55:00Z served read-only traffic while upstream recovered.
      compensation_controls:
        - Validated cached telemetry checksum (sha256:3b5d5c3712955042212316173ccf37be)
        - Enabled read-only feature flag `connectors.wikidata.read_only`
        - Added pager alert for upstream recovery polling every 15 minutes
      evidence_required:
        - research/connectors/wikidata-cache-2025-10-28.json
        - docs/incidents/INC-4721-status-page.pdf
        - json/run-manifest.json#/log_evidence/2
      remediation_plan:
        tasks:
          - task_slug: restore-wikidata-freshness
            deadline: 2025-10-29T19:00:00Z
        follow_up:
          - Close waiver upon successful connector health log with current timestamp and attach proof in PR notes
      ```


      Reviewers MUST validate the outage evidence, confirm compensating
      controls, and ensure the waiver is closed within 72 hours after freshness
      is restored.


      ### Waiver Template


      ```yaml

      waiver_id: WAIVER-<YYYY-MM-DD>-<slug>

      rule_ids: [AGENTS-XXX-NNN, ...]

      approver: @maintainer-handle

      requested_by: @contributor-handle

      expiry: 2025-MM-DD

      reason: |
        Detailed justification explaining why compliance is infeasible
      compensation_controls:
        - Alternative safeguard 1
        - Alternative safeguard 2
      remediation_plan:
        tasks:
          - task_slug: fix-xxx
            deadline: 2025-MM-DD
        evidence_required:
          - Link to PR
          - Link to updated tests
      ```


      ---


      ## üìä **CI ENFORCEMENT MATRIX (Full)**


      | Rule ID        | Description                            | CI
      Job               | Script/Check                                     |

      | -------------- | -------------------------------------- |
      -------------------- | ------------------------------------------------ |

      | AGENTS-STP-001 | Step Budget ‚â§ 7                        |
      `validate-manifest`  | `scripts/governance/validate-run-manifest.ts`    |

      | AGENTS-ASK-002 | Ask-First ‚â§ 3                          |
      `interaction-guard`  | Interaction counter logs (manual review)         |

      | AGENTS-EXP-003 | Explain-While-Doing                    |
      `narrated-diff`      | `scripts/governance/narrated-diff.ts`            |

      | AGENTS-PRF-004 | Proof Required (Evidence Triplet)      |
      `evidence-check`     | `scripts/governance/validate-evidence-triplet.ts`|

      | AGENTS-RCP-005 | Recap ‚â§ 500 tokens                     |
      `recap-guard`        | Token counter in `evidence/recaps.log`           |

      | AGENTS-BRD-006 | Brand Logs                             |
      `brand-guard`        | `grep -r 'brand.*brAInwav'` in logs              |

      | AGENTS-ARC-007 | Arc Protocol                           |
      `validate-manifest`  | `validate-run-manifest.ts` (arc structure)       |

      | AGENTS-NST-008 | North-Star Test                        |
      `validate-manifest`  | `validate-run-manifest.ts` (north_star path)     |

      | AGENTS-PRV-009 | Preflight Guards                       |
      `preflight-check`    | Check for logs in `logs/vibe-check/`, SBOM, etc. |

      | AGENTS-SHG-010 | Session Hygiene                        |
      `session-guard`      | `run-manifest.json` session_resets timestamps    |


      ---


      ## üöÄ **QUICKSTART FOR NEW CONTRIBUTORS**


      1. **Read this Charter** (you're here!)

      2. **Run task creation**:

         ```bash
         pnpm changelog:new --slug my-feature --tier feature
         ```

      3. **Write North-Star test** in `tests/acceptance/my-feature.spec.ts`
      (must fail initially)

      4. **Execute preflight guards**:

         ```bash
         pnpm oversight:vibe-check --goal "my-feature" --plan "step1, step2, ..." --session $(uuidgen)
         pnpm models:health && pnpm models:smoke
         ```

      5. **Create first arc** (‚â§ 7 steps):

         ```bash
         pnpm arc:new --slug my-feature --title "Arc 1: Core API"
         ```

      6. **TDD loop**: Write failing test ‚Üí make it pass ‚Üí refactor (‚â§ 20 min
      per loop)

      7. **Session reset** at 50-minute mark:

         ```bash
         pnpm session:reset --slug my-feature
         ```

      8. **Before PR**: Attach Evidence Triplet + preflight logs + narrated diff

      9. **Review**: Complete code-review-checklist.md; ensure all BLOCKER items
      ‚òë PASS

      10. **Merge** only after CI passes and artifacts signed


      ---


      ## üìú **VERSION HISTORY**


      ### v2.0.0 (2025-10-20)


      - **MAJOR**: Added 4 new guardrails (#7 Arc Protocol, #8 North-Star Test,
      #9 Preflight Guards, #10 Session Hygiene)

      - Updated enforcement matrix with new CI checks

      - Added glossary and quickstart section

      - Added grepable rule IDs (AGENTS-XXX-NNN format)

      - Reconciled recap threshold (‚â§ 500 tokens consistently)

      - Added workflow integration notes

      - Expanded deviation policy with waiver template


      ### v1.0.0 (2025-09-01)


      - Initial release with 6 core guardrails

      - Basic enforcement matrix

      - Quick reference commands


      ---


      **Document Hash (for audit trail):**


      ```bash

      shasum -a 256 .cortex/rules/AGENT_CHARTER.md

      # 6b158d91437c302c14bf167eb52477c6e90e2604d88bf6e20a8698952feddb2e
      (matches CHARTER_FRAGMENT.md)

      ```


      **Effective Date:** Upon maintainer approval (pending)  

      **Review Cycle:** Quarterly or upon major workflow changes
  - id: charter_fragment
    file: .cortex/rules/00-core/CHARTER_FRAGMENT.md
    sha: e766755420bf5b0466a83722340de170e487d6d055b1172cf9686add88c5e1d3
    url: https://governance.cortex-os.local/docs/00-core/CHARTER_FRAGMENT.md
    full_text: |
      # brAInwav ArcTDD Charter (Canonical Fragment)

      **Status:** MANDATORY - Must be included in ALL agent instruction files  
      **Enforcement:** CI validates presence via SHA-256 checksum  
      **Last Updated:** 2025-10-29
      **Version:** 2.1.1

      ---

      ## ‚ö° **OPERATIVE GUARDRAILS** (Non-Negotiable)

      All agents executing workstreams within Cortex-OS MUST obey these rules:

      ### 1Ô∏è‚É£ **Step Budget ‚â§ 7**

      - Each execution arc MUST complete within **seven discrete plan/act iterations**
      - Larger efforts MUST be split into multiple arcs
      - **Enforcement**: `run-manifest.json` validation blocks merge if `arc.plan_steps.length > 7`
      - **Runtime Check**: Phase machine rejects arcs exceeding budget

      ### 2Ô∏è‚É£ **Ask-First ‚â§ 3**

      - Agents MAY ask at most **three clarifying questions** before writing code
      - Each question MUST enumerate **concrete options and consequences**
      - **Format**: "Choice: (A) option1 [consequence]; (B) option2 [consequence]; (C) option3 [consequence]"
      - **Enforcement**: Interaction counter logs violations; coordinator blocks 4th question

      ### 3Ô∏è‚É£ **Explain-While-Doing**

      - Narrate intent alongside actions in commits, diffs, and task logs
      - Enable reviewers to audit rationale without context-switching
      - **Enforcement**: Narrated diffs required in PR body (CI checks for presence)

      ### 4Ô∏è‚É£ **Proof Required**

      - Every behavioral change MUST ship with **executable proof**:
        - ‚úÖ Failing test first (red)
        - ‚úÖ Passing test after (green)
        - ‚úÖ Mutation or property evidence when applicable
      - **Evidence Triplet** mandatory per arc:
        1. Milestone test path (red‚Üígreen proof)
        2. Contract snapshot (types/schema/route)
        3. Reviewer JSON pointer
      - **Enforcement**: CI blocks merge if Evidence Triplet incomplete

      ### 5Ô∏è‚É£ **Recap in ‚â§ 500 Tokens**

      - Close each arc with structured recap:
        - Scope, decisions, tests, follow-ups
        - Written to `evidence/recaps.log`
      - **Enforcement**: Token counter validates; excess triggers warning

      ### 6Ô∏è‚É£ **Brand Logs**

      - Runtime and workflow logs MUST include both a **human-readable prefix** and a **structured JSON log** per line:
        - Text prefix: `[brAInwav]`
        - JSON fields:  
          `brand:"brAInwav"`, ISO-8601 timestamp with timezone, `trace_id` (32 lowercase hex), and the **HTTP `traceparent`** value captured at ingress/egress.
      - OPA/Conftest policies enforce the following tokens in every charter-governed log line:
        - `MODELS:LIVE:OK` when model health passes
        - Latency markers (e.g., `LATENCY:123ms` or structured JSON `latency_ms` field)
        - ISO-8601 timestamps with timezone offset
        - `NORTH_STAR:RED_FIRST` for the initial failing acceptance execution
        - `NORTH_STAR:GREEN_AFTER` once the acceptance turns green
      - First failing acceptance must log `marker:"NORTH_STAR:RED_FIRST"`, passing acceptance `marker:"NORTH_STAR:GREEN_AFTER"`.
      - Emit `model_status:"MODELS:LIVE:OK"` **only** after live health checks succeed.
      - **Enforcement**: Grep validation in CI; missing brand fails build

      **Example JSON log**

      ```json
      {
        "timestamp":"2025-11-10T19:22:11.402-07:00",
        "brand":"brAInwav",
        "trace_id":"3f0a2dbe4c2a4f71a7c1c3b50d1a0c9e",
        "traceparent":"00-3f0a2dbe4c2a4f71a7c1c3b50d1a0c9e-9a1c7b2d3e4f5678-01",
        "marker":"NORTH_STAR:RED_FIRST",
        "model_status":"MODELS:LIVE:OK",
        "latency_ms":742,
        "message":"Acceptance failed as expected"
      }
      ```

      ```text
      [brAInwav] 2025-10-28T19:22:11.402-07:00 LATENCY:742ms MODELS:LIVE:OK NORTH_STAR:RED_FIRST Acceptance failed as expected
      ```

      Swap to `NORTH_STAR:GREEN_AFTER` once the acceptance passes; never emit `MODELS:LIVE:OK` unless model health succeeded.

      **Failure Response**: Misconfigured wrappers or partial rollouts must be rolled back; incident hotfixes require waivers capped at 24 hours to restore instrumentation. Monitor CI Conftest output and observability counters for missing `NORTH_STAR:` or `LATENCY:` tokens.

      ### 7Ô∏è‚É£ **Arc Protocol**

      - Implementations MUST be organized into discrete **arcs** (vertical slices)
      - Each arc MUST:
        - Deliver ‚â§ 7 steps (see Guardrail #1)
        - Span 2‚Äì5 commits and 45‚Äì120 minutes end-to-end
        - Produce a **milestone test** (red ‚Üí green proof)
        - Freeze its contract (types/schema/route) before implementation
        - Include a contract snapshot in `design/contracts/`
      - **Enforcement**: `run-manifest.json` schema validates arc structure; CI blocks merge if arc lacks milestone test or contract snapshot

      ### 8Ô∏è‚É£ **North-Star Acceptance Test**

      - Every task MUST define a **North-Star acceptance test** before implementation begins
      - Test MUST:
        - Prove the feature is real (Gherkin, HTTP contract, or executable spec)
        - Be written in `tests/acceptance/<slug>.spec.[ts|js|py|http]`
        - Fail initially, pass upon task completion
      - **Enforcement**: `run-manifest.json` requires `north_star.acceptance_test_path`; CI blocks merge if path missing or test not executable

      ### 9Ô∏è‚É£ **Preflight Guards**

      - Before any file writes, network calls, or long executions, agents MUST execute **preflight guards**:
        1. **Cortex Aegis Check (Oversight)** ‚Äì `pnpm oversight:vibe-check` (Cortex Aegis MCP) or JSON-RPC to `${VIBE_CHECK_HTTP_URL}`; log saved to `logs/vibe-check/<task>.json`
        2. **Hybrid Model Health** ‚Äì `pnpm models:health && pnpm models:smoke` with live MLX/Ollama/Frontier engines (no stubs)
        3. **Knowledge Connector Health** ‚Äì Verify `${WIKIDATA_MCP_URL}/healthz` and `${ARXIV_MCP_URL}/healthz`; log to `research/connectors-health.log`
        4. **Trace Context Verification** ‚Äì `pnpm tsx scripts/ci/verify-trace-context.ts <logfile>` ensures W3C `trace_id` and `traceparent` in all logs
        5. **Supply-Chain Evidence** ‚Äì `pnpm sbom:generate` (CycloneDX **1.7**) ‚Üí `pnpm attest:sign` (SLSA **v1.1**) ‚Üí `pnpm verify:attest` (Cosign **v3 bundle**); store in `sbom/`
        6. **Identity Gate** ‚Äì CI/services MUST use GitHub Actions OIDC/WIF (no static credentials)
        7. **Feature Flags** ‚Äì OpenFeature only; ad-hoc toggles prohibited
        8. **HTTP Cancellation** ‚Äì All HTTP/tool calls must support `AbortSignal` or SDK equivalent
      - **Run Manifest Requirements**: `run-manifest.json` MUST include JSON pointers for each attached log artifact **and** persist the raw text submitted to policy helpers so OPA/Conftest inputs remain reproducible.
      - **Enforcement**: PR MUST attach preflight logs (vibe-check, model health, connector health, trace verification with `traceparent`, SBOM attestation); missing logs block merge

      **Manifest Pointers**

      ```json
      {"log_evidence":[{"pointer":"/preflight/logs/0","artifact_path":"logs/vibe-check/arc-17.json","raw_text":"[brAInwav] 2025-10-28T19:22:11.402-07:00 LATENCY:742ms MODELS:LIVE:OK NORTH_STAR:RED_FIRST Acceptance failed as expected"}]}
      ```

      Every entry MUST include `pointer`, `artifact_path`, and byte-identical `raw_text`; include hashes when practical. Validate with Conftest + a manifest script (`pnpm policy:validate`) in CI and locally.

      ### üîü **Session Hygiene**

      - Agents MUST reset session context periodically to prevent drift:
        - **Cadence**: 50 minutes build / 10 minutes reset
        - **Context Diet**: Last 2 plan bullets + current failing test + current file + manifest summary only
        - **Hard Reset Triggers**:
          - 2 off-spec suggestions in a row
          - ‚â• 3 speculative edits without tests
          - Proposes renaming core interfaces mid-arc
      - Session resets MUST be logged in `run-manifest.json` with ISO-8601 timestamps
      - **Enforcement**: CI warns if `session_resets` array empty and task duration > 60 minutes; reviewers verify reset discipline

      ---

      ## üîí **ENFORCEMENT MECHANISMS**

      | Guardrail | Detection | Prevention | Recovery |
      |-----------|-----------|------------|----------|
      | Step Budget | `validate-run-manifest.ts` | Phase machine rejects | Split into new arc |
      | Ask-First | Interaction logs | Coordinator blocks 4th Q | Document assumption |
      | Explain-While-Doing | `narrated-diff.ts` check | PR template requires | Request amendment |
      | Proof Required | CI Evidence Triplet check | Template scaffolds tests | Add retroactive proof |
      | Recap Rule | Token counter | Template auto-generates | Trim to ‚â§500 tokens |
      | Brand Logs | `grep -r 'brand.*brAInwav'` | Logger wrapper | Patch log calls |
      | Arc Protocol | `validate-run-manifest.ts` (arc structure, milestone test, contract snapshot) | Task scaffolding enforces arc template | Add missing arc artifacts |
      | North-Star Test | `validate-run-manifest.ts` (`north_star.acceptance_test_path` required) | `pnpm changelog:new` generates acceptance test scaffold | Write missing north-star test |
      | Preflight Guards | CI checks for `logs/vibe-check/*.json`, model health logs, trace context, SBOM | PR template checklist requires preflight evidence | Execute missing guards and attach logs |
      | Session Hygiene | `run-manifest.json` `session_resets` timestamps; reviewer audit | 10-minute reset hook calls `pnpm session:reset` | Log retrospective resets with justification |

      ---

      ## üìã **QUICK REFERENCE**

      **Before starting any task:**

      ```bash
      pnpm changelog:new --slug my-feature --tier feature  # Scaffolds charter-compliant structure + north-star test
      pnpm oversight:vibe-check --goal "<task>" --plan "<steps>" --session <id>  # Preflight guard
      pnpm models:health && pnpm models:smoke  # Verify live model engines
      ```

      **During implementation:**

      ```bash
      pnpm arc:new --slug my-feature --title "Arc 1: API boundary"  # Max 7 steps enforced
      pnpm session:reset --slug my-feature  # At 50-minute mark
      ```

      **Before committing:**

      ```bash
      pnpm charter:validate  # Runs all charter compliance checks
      pnpm tsx scripts/ci/verify-trace-context.ts logs/dev.log  # Verify W3C trace_id
      pnpm sbom:generate && pnpm attest:sign && pnpm verify:attest  # Supply-chain evidence
      ```

      **In PR:**

      - Attach Evidence Triplet links (milestone test, contract snapshot, reviewer JSON)
      - Include narrated diff in body
      - Attach preflight logs: `logs/vibe-check/*.json`, model health output, connector health log, SBOM attestation
      - Reference `CHARTER_SHA256: 1c8cbc194209f690ae9fd015c04223a1c619853190d6302a5ccfea6769ceac5f` in description

      ---

      ## üîó **CANONICAL REFERENCE**

      This fragment is authoritative. Any conflicts defer to:

      1. `/.cortex/rules/AGENT_CHARTER.md` (full specification)
      2. `/.cortex/rules/agentic-coding-workflow.md` (workflow integration and task lifecycle)
      3. `/.cortex/rules/code-review-checklist.md` (verification)

      **Workflow Integration Notes:**

      - The full task lifecycle (gates G0‚ÄìG10) is governed by `agentic-coding-workflow.md`
      - Workflow MAY define task tiers (fix/feature/refactor) with differentiated gate requirements, provided all tiers enforce these core guardrails
      - Waivers policy detailed in lines 115‚Äì124 below

      **Fragment SHA-256:** `f0887531...`  <!-- Updated to match governance-index.json -->
      **Fragment Path:** `/.cortex/rules/CHARTER_FRAGMENT.md`

      ---

      **‚ö†Ô∏è DEVIATION POLICY**

      Waivers require **Maintainer approval** under `/.cortex/waivers/`. All deviations must:

      - Document justification with evidence
      - Specify compensation controls
      - Set expiration date (max 30 days)
      - Link to remediation plan
      - **Waiver Activation Rule:** A charter waiver is valid only after the `charter-enforce / danger` job posts ‚úÖ with a link to the `Apply Waiver` workflow run that recorded Maintainer approval.
      - **Emergency Waiver Sync:** If `charter-enforce / danger` or Apply Waiver automation is unavailable, mark the waiver **provisional**, document manual Maintainer approval + compensating controls in `/.cortex/waivers/<id>.md`, and pause merges unless escalation is documented. Once automation is restored, re-run the Apply Waiver workflow, re-trigger Danger until the comment links to that run, and add a post-incident note referencing the workflow URL and recovery timestamp.

      **Reviewer Guidance:**

      - "Red first" waivers (Guardrail #4) are acceptable only when a production incident blocks execution of a failing acceptance test. Waivers MUST capture validated reproduction evidence and include a follow-up task restoring the red-first proof within 24 hours.
      - Connector freshness waivers (Preflight Guard #3) MAY be approved during documented upstream outages when cached telemetry and timestamps are attached. These waivers expire within 72 hours and require explicit reviewer sign-off on compensating controls.

      Unapproved deviations are **constitutional violations** and will block merge.

      **Connector Freshness Waiver (Sample)**

      ```yaml
      waiver_id: WAIVER-2025-10-28-connector-outage
      rule_ids: [AGENTS-PRV-009]
      approver: @maintainer-handle
      requested_by: @oncall-engineer
      expiry: 2025-10-30T19:00:00Z
      reason: Wikidata outage blocked live freshness probes; serving cached data timestamped 2025-10-28T18:55:00Z.
      compensation_controls:
        - Validated cache checksum (sha256:3b5d5c3712955042212316173ccf37be)
        - Read-only feature flag `connectors.wikidata.read_only`
      evidence_required:
        - research/connectors/wikidata-cache-2025-10-28.json
        - docs/incidents/INC-4721-status-page.pdf
        - json/run-manifest.json#/log_evidence/2
      remediation_plan:
        tasks:
          - task_slug: restore-wikidata-freshness
            deadline: 2025-10-29T19:00:00Z
      ```
  - id: rules_of_ai
    file: .cortex/rules/00-core/RULES_OF_AI.md
    sha: ""
    url: https://governance.cortex-os.local/docs/00-core/RULES_OF_AI.md
    full_text: >
      ---

      trigger: always_on

      alwaysApply: true

      ---

      # brAInwav Cortex-OS: Rules of AI ‚Üí AGENT_CHARTER.md


      **Status**: CONSOLIDATED (stub only; not in governance precedence) -
      Content moved to canonical location

      **New Location**: `/.cortex/rules/00-core/AGENT_CHARTER.md` ¬ß AI
      Behavioral Rules  

      **Last Updated**: 2025-11-22


      ---


      ## üìã Document Consolidated


      All AI behavioral rules, production standards, and normative requirements
      have been **merged into** the Agent Charter for single source of truth:


      üëâ **See**: `/.cortex/rules/00-core/AGENT_CHARTER.md` ¬ß "AI BEHAVIORAL
      RULES"


      This consolidation eliminates duplication between charter and rules while
      maintaining all original content.


      ### Governance Pack Files (mandatory reading)


      - **[Vision](/.cortex/rules/00-core/vision.md)**

      - **[Agentic Coding
      Workflow](/.cortex/rules/10-flow/agentic-coding-workflow.md)**

      - **[Cortex-Aegis](/.cortex/rules/10-flow/cortex-aegis.md)**

      - **[Task Folder
      Structure](/.cortex/rules/10-flow/TASK_FOLDER_STRUCTURE.md)**

      - **[Code Review
      Checklist](/.cortex/rules/20-checklists/code-review-checklist.md)**

      - **[CI Review
      Checklist](/.cortex/rules/20-checklists/CHECKLIST.cortex-os.md)**

      - **[Constitution](/.cortex/rules/00-core/constitution.md)**

      - **[Governance Standards
      Mapping](/docs/governance/standards-mapping.md)**

      - **[EU AI Act Timeline](/docs/governance/eu-ai-act-dates.md)**


      ---


      ## üß≠ Governance & Structure Standards


      **Root-level files policy**


      - **Allowed at root**: AGENTS.md, CODESTYLE.md, README.md, CHANGELOG.md,
      model guides.

      - **Governance enforcement**: Structure Guard validates root entries
      against `allowedRootEntries`.

      - **Branding**: All root docs include brAInwav branding.


      **Agent responsibility**: Place specialized rules/config under the correct
      subdirs (`.cortex/rules/`, `config/`, `docs/`, etc.).


      ---


      ## üö® Truthfulness & Production Bars


      ### Rule 1 ‚Äî No false implementation claims


      Never claim "production-ready/complete/operational" if any prod path
      contains:


      - `Math.random()`-fabricated data, hardcoded mocks, placeholder adapters
      ("will be wired later")

      - `TODO/FIXME/HACK`, `console.warn("not implemented")`

      - Fake metrics/telemetry


      ### Rule 2 ‚Äî brAInwav truthfulness standard


      - Verify claims against actual code & passing gates.

      - Distinguish test scaffolding from production.

      - Include brAInwav branding in outputs/errors.

      - Do not inflate readiness/completion metrics.


      ### Rule 3 ‚Äî Production validation requirements


      - [ ] Placeholders eliminated  

      - [ ] Real integrations in place (no fake data)  

      - [ ] Errors/logs branded `[brAInwav]` / `brand:"brAInwav"`  

      - [ ] Docs match code  

      - [ ] Tests validate real functionality


      ### Rule 4 ‚Äî Documentation accuracy


      - Status/percentages based on real metrics.

      - READMEs reflect current implementation.


      ### Rule 5 ‚Äî Commit message standards


      - Accurate, evidence-backed messages.

      - Add `Co-authored-by: brAInwav Development Team` when appropriate.


      ---


      ## üîÑ Mandatory Agentic Workflow (summary)


      All agents follow the **7-phase** workflow. Full details:
      **`/.cortex/rules/agentic-coding-workflow.md`** and **AGENTS.md**.


      **Task folder (mandatory)** ‚Äî **`~/{tasks}/[feature]/`** per
      **`/.cortex/rules/TASK_FOLDER_STRUCTURE.md`**.  

      **Memory parity (mandatory)** ‚Äî Persist decisions to
      `.github/instructions/memories.instructions.md` **and** via Local Memory
      **MCP/REST dual-mode**; reviewers confirm entries exist.


      ---


      ## üß™ Phase Machine & HITL (constitutional)


      **State machine**: **R ‚Üí G ‚Üí F ‚Üí REVIEW**  


      - **HITL only at REVIEW**. Any `human_input` before REVIEW is a
      violation.  

      - Agents must persist `.cortex/run.yaml` with:
        - `phase: "R"|"G"|"F"|"REVIEW"`
        - `agents_sha: <nearest AGENTS.md git-sha>`
        - `task_id`, `run_id`, `started_at`

      **Evidence tokens (CI scans logs for):**


      - `AGENTS_MD_SHA:<sha>`  

      - `PHASE_TRANSITION:<from>-><to>`  

      - `brAInwav-vibe-check`  

      - `MODELS:LIVE:OK engine=<mlx|ollama|frontier>`


      **AGENTS.md acknowledgement & Vibe-check**


      - At session start: load nearest `AGENTS.md`, compute `agents_sha`, log
      `AGENTS_MD_SHA:<sha>`.

      - After planning and **before** file writes/network calls/long runs: call
      **Vibe Check MCP** `vibe_check`; include `"brAInwav-vibe-check"` in logs.


      ---


      ## üß± Integration Surfaces & Auth


      **Allowed** (from **vision.md**):


      1. **MCP** over HTTP/SSE/optional STDIO: `/mcp`, `/sse`, `/health`,
      `/metrics`  
         - API key required by default (dev may set `NO_AUTH=true`)  
         - Tools/Resources/Prompts are registered (not embedded)  
         - **Single MCP hub** ‚Äî no duplicate MCPs per package
      2. **A2A** hub (topics/intents) ‚Äî no direct cross-domain imports

      3. **REST API** ‚Äî authenticated, rate-limited, policy-guarded

      4. **Frontier adapters** (OpenAI/Anthropic/Google/etc.)


      **MCP OAuth (optional)** ‚Äî Auth0 scopes: `search.read docs.write
      memory.read memory.write memory.delete`; RBAC + "Add Permissions in Access
      Token" enabled.


      **Port registry (must align with `.well-known/mcp.json`)**


      - `3024` MCP, `3026` Local Memory MCP, `3002` Memory API, `39300` Pieces
      OS


      ---


      ## üß© Agent Toolkit (mandatory)


      Use `packages/agent-toolkit` instead of ad-hoc `rg/grep/sed/awk`.


      ```ts

      import { createAgentToolkit } from '@cortex-os/agent-toolkit';

      const tk = createAgentToolkit();

      await tk.multiSearch('pattern', './src');

      await tk.validateProject(['*.ts','*.py','*.rs']);

      ```


      Deterministic output; attach logs as evidence.


      ---


      ## üíæ Hybrid Model Solution ‚Äî Live-Only (CONSTITUTIONAL)


      **Hard rule**: Embeddings, rerankers, generations must use **live**
      engines:


      - **MLX** (local on-device)

      - **Ollama** (local server)  

      - **Frontier APIs** (OpenAI/Anthropic/Google/etc.)


      **Forbidden**: Stubs/recordings/`dry_run` for models. No cached "golden"
      vectors. No echo rerankers.


      **Evidence before merge**: `pnpm models:health && pnpm models:smoke`;
      attach logs (engine, model IDs, vector norms/shape, latency).


      **Fallback chain**: MLX ‚Üí Ollama ‚Üí Frontier (if live). If unavailable,
      mark task **blocked**; escalate per Constitution.


      ---


      ## ‚ôø Accessibility (WCAG 2.2 AA ¬∑ ISO/IEC 40500:2025)


      **Non-negotiable**:


      - Semantic HTML, correct ARIA roles, keyboard-complete, target ‚â• 44√ó44 CSS
      px

      - Screen-reader testing via `jest-axe`/axe

      - No color-only signaling; consistent focus order

      - CLI/TUI: support `--plain` output + high-contrast mode


      Include brAInwav branding in a11y announcements where appropriate.


      ---


      ## üõ°Ô∏è Security & Supply Chain


      **Scanners (blocking)**:


      - **Semgrep** ‚Äî block on ERROR  

      - **gitleaks** ‚Äî block on ANY secret detection  

      - **OSV/audit** ‚Äî clean lockfiles  

      - **SBOM** ‚Äî CycloneDX 1.6 (ECMA-424) generated for all artifacts


      **Environment/config**:


      - Use shared loader (`scripts/utils/dotenv-loader.mjs` or
      `@cortex-os/utils`)

      - **Never call `dotenv.config()` directly**

      - No hardcoded secrets; env/secret managers only; retrieve API keys, SSH
      keys, and tokens via the 1Password CLI (`op`) at runtime


      **Containers**: Minimal base, pinned digests, non-root user, read-only FS,
      dropped capabilities.

      **Provenance**: Target SLSA v1.1 (Approved 2025-04-21); evaluate Source
      track from SLSA v1.2 RC1 once promoted to GA.

      **Signing**: Cosign v3 bundle verification is the default; align release
      tooling and PolicyController policies accordingly.


      ---


      ## üìè Code Standards (prod paths)


      - **Named exports only** (no `export default`)

      - **‚â§ 40 lines per function** (compose via guard clauses)

      - **No `any` in TypeScript** (except tests/justified compat shims)

      - **No cross-domain imports** ‚Äî use A2A topics/MCP tools/declared
      contracts

      - **async/await + AbortSignal** ‚Äî no `.then()` chains

      - **Structured logging** ‚Äî `brand:"brAInwav"`, request/run IDs, OTel
      traces


      ---


      ## üß™ Quality Gates


      **Coverage & mutation**:


      - **‚â• 90% global coverage**

      - **‚â• 95% changed lines**

      - **‚â• 90% mutation** (where enabled)


      **Tests**: TDD (Red-Green-Refactor); co-locate tests; property-based for
      critical paths.


      **Performance**: Bundle budgets, latency thresholds enforced in CI.


      ## ‚ö° Performance Standards (constitutional)


      **Performance components must meet these non-negotiable standards**:


      ### Rule 1 ‚Äî Performance Component Standards


      - **No performance regressions**: All performance components must improve
      or maintain existing performance metrics

      - **Real metrics only**: No fake or simulated performance data in
      production code

      - **Comprehensive monitoring**: Every performance component must include
      structured metrics and health checks

      - **Graceful degradation**: Performance failures must not crash the system


      ### Rule 2 ‚Äî Auto-Scaling Standards


      - **ML model validation**: Auto-scaling ML models must be trained on real
      data with proven accuracy (>80%)

      - **Cost optimization**: Scaling decisions must consider cost implications
      and optimize for efficiency

      - **Emergency handling**: Auto-scaling must include emergency response
      protocols for critical load conditions

      - **Predictive accuracy**: Load forecasting must achieve minimum accuracy
      thresholds


      ### Rule 3 ‚Äî Resource Management Standards


      - **Memory efficiency**: GPU and memory management must minimize waste and
      prevent leaks

      - **Fair scheduling**: Resource allocation must be fair and prevent
      starvation

      - **Capacity planning**: Resource management must include forward-looking
      capacity analysis

      - **Resource isolation**: Performance components must not impact core
      system functionality


      ### Rule 4 ‚Äî Monitoring Standards


      - **Real-time metrics**: All performance components must emit real-time
      metrics

      - **Alert thresholds**: Performance alerts must have meaningful thresholds
      with clear escalation paths

      - **Performance baselines**: Every component must establish and maintain
      performance baselines

      - **Anomaly detection**: Performance monitoring must include automated
      anomaly detection


      ### Rule 5 ‚Äî Integration Standards


      - **Event-driven communication**: Performance components must use A2A
      events for inter-component communication

      - **Circuit breaker patterns**: All external dependencies must include
      circuit breaker protection

      - **Backward compatibility**: Performance improvements must not break
      existing integrations

      - **Configuration-driven**: Performance behavior must be configurable
      without code changes


      ---


      ## üìö Memory Management & Persistence


      **Local Memory (mandatory)**: Store context, decisions, rationale via:


      1. **MCP mode**: Local Memory MCP server  

      2. **REST mode**: Memory API (dual-mode for parity)  

      3. **Oversight log**: `.github/instructions/memories.instructions.md`


      **Task artifacts**: `~/tasks/[feature]/` (research, plans, logs, evidence)
      per **Task Folder Structure**.


      ---


      ## üîç Code Review (constitutional enforcement)


      **Human reviewer (non-author)** completes
      `/.cortex/rules/code-review-checklist.md`:


      - Paste filled checklist as top-level PR comment

      - **BLOCKER** items must be PASS

      - **MAJOR** items need fixes or Constitution waiver

      - **MINOR** items need follow-up task


      **Evidence requirements**: file paths+lines, trace IDs, screenshots, URLs.


      ---


      ## üåê Observability & Telemetry


      **Structured logs** ‚Äî include:


      - `brand:"brAInwav"`

      - `component:"<package-name>"`

      - `trace_id`, `request_id`, `run_id`

      - `level`, `msg`, `timestamp` (ISO-8601)


      **Metrics/traces**: OpenTelemetry for services; Prometheus `/metrics`; no
      fake telemetry.


      ---


      ## üîß Development Environment


      **Smart targets** (affected-only):


      ```bash

      pnpm build:smart && pnpm test:smart && pnpm lint:smart

      ```


      **Pre-merge gates**:


      ```bash

      pnpm structure:validate && pnpm security:scan && pnpm models:health

      ```


      **Repo boundaries**: Nx/ESLint enforce dependency graph; no circular deps.


      ---


      ## üìù Evidence & Documentation


      **PR requirements**:


      - Evidence tokens in logs (`AGENTS_MD_SHA`, `brAInwav-vibe-check`,
      `MODELS:LIVE:OK`)

      - TDD plan + coverage reports attached

      - a11y validation (axe reports)

      - Security scan results (clean)

      - Live model smoke test logs


      **Task documentation**: Complete context under `~/tasks/[feature]/` for
      reproducibility.


      **brAInwav attribution**: `Co-authored-by: brAInwav Development Team` in
      commits where applicable.


      ---


      ## ‚öñÔ∏è Constitutional Compliance


      This document is **immutable ethics** (highest precedence in Governance
      Pack).


      **Violations**: Policy violations trigger incident review per
      Constitution.


      **Amendment**: Core principles (truthfulness, branding, accessibility,
      security) cannot be weakened.


      ---


      **Maintained by**: brAInwav Development Team  

      **Co-authored-by**: brAInwav Development Team
  - id: agentic_coding_workflow
    file: .cortex/rules/10-flow/agentic-coding-workflow.md
    sha: 7ea61989105a13f64ec81c46cb018b5655b54268bcd8831f4212eec819c72c76
    url: https://governance.cortex-os.local/docs/10-flow/agentic-coding-workflow.md
    full_text: |
      <!-- .cortex/rules/10-flow/agentic-coding-workflow.md -->

      # Agentic Coding Workflow (Cortex-OS)

      > Canonical, enforceable workflow for humans + agents across feature, research, fix, refactor, and review flows.

      ---

      ## 0. Document Metadata

      - **Doc ID**: `agentic-coding-workflow`
      - **Version**: `2025.11.0`
      - **Status**: `active`
      - **Owner**: `Governance & Reliability (GovOps)`
      - **Last Updated**: `2025-11-22`

      > Governance: This document is normative. CI, humans, and agents MUST treat this as the source of truth for coding flows. Violations block the `charter-enforce` pipeline and require waivers recorded under `.cortex/waivers/`.

      ---

      ## 1. Purpose & Scope

      - **Purpose**  
        Provide a single operational specification that connects ArcTDD gates, task folders, and Cortex-Aegis oversight so that humans and agents can execute Cortex-OS work consistently and audibly. This workflow is referenced by `governance-quickstart.md`, `/.cortex/rules/00-core/constitution.md`, and `/.cortex/rules/00-core/AGENT_CHARTER.md`.

      - **In Scope**  
        - Agentic workflows for: Feature implementation, Research/Spike, Fix (bug/incident), Refactor/Cleanup, and Code Review.  
        - ArcTDD gates **G0‚ÄìG10**.  
        - Mandatory evidence (task folders, Aegis logs, Evidence Triplet, SBOM/provenance data).  
        - Tooling hooks (vibe check ‚Üí Cortex-Aegis, Local Memory parity, knowledge connectors, MCP usage, OpenFeature requirement).

      - **Out of Scope**  
        - People management, HR, or roadmap governance (see `/.cortex/rules/vision.md`).  
        - Product/portfolio intake (handled by Strategy Council).  
        - Non-code business processes (finance, vendor, HR).

      - **Upstream References**  
        - `.cortex/rules/00-core/constitution.md`
        - `.cortex/rules/00-core/AGENT_CHARTER.md`
        - `.cortex/rules/10-flow/governance-quickstart.md` (front door)
        - `.cortex/rules/10-flow/cortex-aegis.md`
        - `.cortex/rules/20-checklists/checklists.cortex-os.md`

      ---

      ## 2. Task Types & Canonical Flows

      > Map every piece of work to ONE of the supported flows before entering G0. This choice drives required artefacts, Cortex-Aegis policy, and CI gating.

      ### 2.1 Task Classification

      - **Feature** ‚Äì Introduces a new capability, contract, or user-facing behaviour. Requires North-Star acceptance criteria and full ArcTDD coverage.
      - **Research / Spike** ‚Äì Exploration or feasibility work. Produces validated research and recommendations rather than code changes.
      - **Fix** ‚Äì Bug, incident, or regression work with a reproducible failing case and a minimal corrective change.
      - **Refactor / Cleanup** ‚Äì Internal quality improvements intended to preserve external behaviour while improving design/operability.
      - **Code Review** ‚Äì Dedicated review-only efforts (e.g., Reviewer Neuron runs, HITL review). Produces dispositions, not code.

      ### 2.2 Flow Selection Matrix

      | Work item type         | Primary flow        | Typical ArcTDD gates            | Notes |
      |------------------------|---------------------|---------------------------------|-------|
      | New feature / story    | Feature             | G0‚ÄìG7 (extend to G8‚ÄìG10 for rollout/monitoring) | Requires North-Star test + Cortex-Aegis at G2 and G5. |
      | Research / feasibility | Research / Spike    | G0‚ÄìG3 ‚Üí G10                      | Produces decision memo; code optional; Aegis validates sources/time freshness. |
      | Bug / incident         | Fix                 | G0‚ÄìG7 (extend to G8‚ÄìG10 for hotfix rollout) | Needs reproducer, failing test, and postmortem if SEV ‚â• 2. |
      | Refactor / cleanup     | Refactor            | G0‚ÄìG7 ‚Üí G10                      | Behaviour-preserving; emphasise invariants + perf baselines. |
      | Review-only work       | Code Review         | G5‚ÄìG7 ‚Üí G10                      | No authoring; consumes Evidence Triplet + manifests. |

      ---

      ## 3. Standard Task Folder Layout

      > Every flow operates inside a task folder. Humans and agents MUST use this layout so that automation, audits, and Cortex-Aegis can reason about work. Task folders live under the single root `tasks/<task-slug>/`.

      ### 3.1 Location & Naming

      - Root pattern: `[REPO_ROOT]/tasks/<task-slug>/` (kebab-case).
        Examples: `tasks/feat-user-profile-page/`, `tasks/fix-api-timeout-500/`.

      ### 3.2 Directory & File Structure

      ```text
      tasks/<task-slug>/
        meta/
          task.json                # id, tier (fix/feature/refactor), owners, links
          tags.json                # domains, risk levels, feature flags, ArcTDD tier
        context/
          research.md              # repo scan, RAID, academic evidence, connector health log
          requirements.md          # story, bug report, acceptance criteria
          design.md                # diagrams, API contracts, state charts
        plan/
          PLAN.md                  # ‚â§7-step arc plan, references reuse candidates
          risk-register.md         # identified risks + mitigations
          tdd-plan.md              # Milestone test plan, BDD specs
        work/
          implementation-log.md    # chronological decisions + evidence links
          patches/                 # optional saved diff bundles
        evidence/
          tests.md                 # what ran, coverage, mutation, perf, a11y, security
          test-results/            # raw logs, screenshots, junit xml
          review.json              # AI reviewer neuron output
          review-notes.md          # human reviewer dispositions + checklist summary
          aegis-report.json        # Cortex-Aegis verdict(s)
          recaps.log               # session recaps (‚â§500 tokens) per Charter ¬ß5
        ops/
          rollout-plan.md          # deploy steps, flags, migrations
          rollback-plan.md         # triggers + procedures
          postmortem.md            # required for Fix/incident flows
      ```

      > **Governance hooks**: `research/connectors-health.log`, `logs/vibe-check/*.json`, and `run-manifest.json` MUST be present whenever connectors, vibe check, or Arc manifests are invoked.
      > **MCP session tracking**: After each MCP connection (RepoPrompt, Cortex-Aegis, academic connectors), append an entry to `run-manifest.json.mcp_sessions` via `just mcp-session-manifest <slug> <server> <transport> <endpoint> <session_log> <evidence_log>`.

      ### 3.3 Minimum Required Artefacts by Flow

      | Flow      | Required artefacts (minimum) |
      |-----------|------------------------------|
      | Feature   | `meta/task.json`, `context/requirements.md`, `context/research.md`, `plan/PLAN.md`, `plan/tdd-plan.md`, `evidence/tests.md`, `evidence/aegis-report.json`, `work/implementation-log.md`, `run-manifest.json` pointer to Evidence Triplet. |
      | Research  | `meta/task.json`, `context/research.md`, `plan/PLAN.md` (research plan), `evidence/aegis-report.json` (if Aegis run), `research/connectors-health.log` for Lifelines. |
      | Fix       | `meta/task.json`, `context/requirements.md` (bug description + repro), failing + passing tests recorded in `evidence/tests.md`, `ops/postmortem.md` for SEV ‚â§ 2+, `evidence/aegis-report.json` when risk tags ‚â† low. |
      | Refactor  | `meta/task.json`, `context/research.md` (current behaviour + invariants), `plan/PLAN.md`, baseline & post-change data in `evidence/tests.md`, perf deltas in `evidence/test-results/`. |
      | Review    | `meta/task.json`, `evidence/review.json`, `evidence/review-notes.md`, `checklists.cortex-os.md` excerpt attached to PR/comment. |

      ---

      ## 4. ArcTDD Gate Policy (G0‚ÄìG10)

      > Every gate defines objectives, inputs, required artefacts, and exit criteria. Automation inspects `run-manifest.json`, `quality-report.json`, and the task folder to confirm compliance.

      ### 4.0 Repo Prompt Integration

      **Repo Prompt** is the default repo-aware MCP server for context building, planning, and minimal edits in Cortex-OS. It provides:

      - **Context Builder**: Assembles bounded context with codemaps and API overviews
      - **Plan Preset**: Generates architectural plans grounded in existing code
      - **Pro Edit (XML)**: Produces minimal, reviewable diffs for targeted changes
      - **MCP Pair**: Orchestrates multi-step implementations with repo awareness

      **MCP Configuration** (example for `~/.config/Code/User/globalStorage/saoudrizwan.claude-dev/settings/cline_mcp_settings.json`):

      ```json
      {
        "mcpServers": {
          "RepoPrompt": {
            "command": "/path/to/repoprompt_cli",
            "args": [],
            "env": {},
            "toolOutputTokenLimit": 25000,
            "toolTimeoutSec": 1000
          }
        }
      }
      ```

      **Integration Points by Gate**:

      - **G1 (Discover)**: MUST use Context Builder for tasks above size threshold to assemble repo context
      - **G2 (Plan)**: SHOULD use Plan preset for medium+ tasks to produce PLAN.md grounded in existing code
      - **G3-G4 (Scaffold/Implement)**: SHOULD use Pro Edit for small/medium changes; MCP Pair for complex multi-step work
      - **G5 (Verify)**: MAY use Repo Prompt to find additional test coverage gaps via codemaps
      - **G6 (Review)**: MAY use Context Builder to provide reviewers with architectural context

      **Division of Responsibility**:

      - **Repo Prompt**: Repo-local context engine and edit applier (stays within codebase boundaries)
      - **Cortex-Aegis**: Governance + external evidence + risk assessment (validates against policies and freshness)

      ### 4.1 Gate Overview

      | Gate | Name                | Description |
      |------|---------------------|-------------|
      | G0   | Initialize          | Classify task, create folder, capture metadata + tier. |
      | G1   | Discover / Research | Understand existing behaviour, dependencies, academic context. |
      | G2   | Plan / Design       | Produce PLAN.md, risk register, and cortex-aegis validated approach. |
      | G3   | Scaffold            | Establish failing tests, feature flags, contracts, and wiring. |
      | G4   | Implement           | Execute plan (‚â§7 steps per arc) with TDD micro-loops. |
      | G5   | Verify              | Run tests, security/a11y/perf checks, gather Evidence Triplet. |
      | G6   | Review              | AI reviewer + human reviewer dispositions, waiver handling. |
      | G7   | Document            | Update docs, changelog, runbooks, arc manifests. |
      | G8   | Ship                | Deploy & flag management with rollback paths. |
      | G9   | Monitor             | Observe telemetry, model health, error budgets. |
      | G10  | Archive             | Preserve artefacts, update memory, close task. |

      ### 4.2 Gate Templates

      #### G0 ‚Äì Initialize

      - **Objective** ‚Äì Declare task type/tier, create folder, and anchor time freshness.  
      - **Inputs** ‚Äì Work request (ticket, incident, roadmap item).  
      - **Required artefacts** ‚Äì `meta/task.json`, `meta/tags.json`, initial `run-manifest.json`.  
      - **Checks** ‚Äì Confirm tier selection (fix/feature/refactor), connectors accessible, <7 clarifying questions (Charter ¬ß2).  
      - **Exit criteria** ‚Äì Task folder exists; owner + reviewer assigned; `time-freshness` entry logged.

      #### G1 ‚Äì Discover / Research

      - **Objective** ‚Äì Build context through repo scans, Local Memory recall, and academic sources.  
      - **Repo Prompt Usage** ‚Äì For tasks above size threshold, MUST run **Context Builder** to:
        - Identify relevant files, symbols, and modules
        - Generate **codemaps** for key areas (APIs, types, call graphs)
        - Produce **handoff prompt** summarizing repo-aware context
        - Save Context Builder output summary to `context/research.md`
      - **Required artefacts** ‚Äì `context/research.md` (including Repo Prompt context summary), `research/connectors-health.log`, `analysis/reuse-evaluation.md` (if reuse study already started).  
      - **Checks** ‚Äì Agents call `/recall` commands, verify Wikidata + arXiv MCP endpoints, fetch academic research via MCP connectors, log license status, run Repo Prompt Context Builder for non-trivial tasks.  
      - **Exit criteria** ‚Äì RAID + feasibility documented; North-Star acceptance test path recorded; reuse candidates enumerated; repo context available for G2.

      #### G2 ‚Äì Plan / Design

      - **Objective** ‚Äì Produce executable plan ‚â§7 steps per Arc; define tests, contracts, mitigations.  
      - **Repo Prompt Usage** ‚Äì For medium+ complexity tasks, SHOULD use **Plan preset** to:
        - Generate plan using Context Builder handoff from G1
        - Propose architecture changes and touchpoints grounded in existing code
        - Outline test strategy and risk areas with repo awareness
        - Save Repo Prompt-generated plan to `plan/PLAN.md`
      - **Required artefacts** ‚Äì `plan/PLAN.md` (Repo Prompt Plan or equivalent), `plan/tdd-plan.md`, `plan/risk-register.md`, updated `run-manifest.json`.  
      - **Cortex-Aegis usage** ‚Äì Mandatory for Feature, Fix, and any Refactor touching contracts or security-critical code. Provide plan summary (including Repo Prompt context), research citations, risk tags, and tool health evidence.  
      - **Checks** ‚Äì Plan references reuse candidates; connectors health still green; Cortex-Aegis JSON stored in `evidence/aegis-report.json`; Repo Prompt plan artifacts present.  
      - **Exit criteria** ‚Äì Plan approved (no Aegis `block`), tests identified, quality gates defined, plan grounded in repo realities.

      #### G3 ‚Äì Scaffold

      - **Objective** ‚Äì Create failing milestone tests, feature flags (OpenFeature only), wiring, and contract snapshots.  
      - **Repo Prompt Usage** ‚Äì SHOULD use **Codemaps + search** to:
        - Confirm where scaffolding should attach (entrypoints, DI boundaries)
        - Verify new modules integrate with existing types and call graphs
        - Validate wiring against architectural patterns shown in codemaps
      - **Required artefacts** ‚Äì Failing tests recorded in `run-manifest.json.reuseEvidence.failingTest`, `design/contracts/<timestamp>-before.json`.  
      - **Checks** ‚Äì No placeholder adapters; scaffolds compile; cancellation tokens wired for HTTP/tooling; Repo Prompt codemap confirms proper integration.  
      - **Exit criteria** ‚Äì Repo builds; failing tests prove gap; feature flag default = off; scaffolding properly wired.

      #### G4 ‚Äì Implement

      - **Objective** ‚Äì Execute micro TDD loops (‚â§20 min) to satisfy plan.  
      - **Repo Prompt Usage**:
        - **For small/medium changes**: SHOULD use **Pro Edit (XML)** workflow to generate minimal diffs per file
        - **For complex multi-step changes**: SHOULD use **MCP Pair** workflow where:
          - Orchestrating agent steps through PLAN.md
          - Delegates repo edits to Repo Prompt via MCP
          - Maintains repo context across implementation steps
        - Reference Repo Prompt sessions in `work/implementation-log.md` where useful
      - **Required artefacts** ‚Äì Code + tests, `work/implementation-log.md` (including Repo Prompt session references), `logs/models/*` for live model usage, named exports only.  
      - **Checks** ‚Äì Named exports, ‚â§40-line functions, typed boundaries, no `Math.random()`, no TODO/FIXME/HACK, cancellation enforced, `OpenFeature` for flags, connectors logged, Local Memory updates appended.  
      - **Exit criteria** ‚Äì Tests now pass locally; Evidence Triplet outline captured (test path, contract snapshot, reviewer pointer); implementation matches plan or deviations documented.

      #### G5 ‚Äì Verify

      - **Objective** ‚Äì Provide hard evidence for change correctness, safety, and compliance.  
      - **Required artefacts** ‚Äì `evidence/tests.md`, `evidence/test-results/*`, `verification/coverage-results.json`, `verification/mutation-results.json`, `evidence/aegis-report.json` (if rerun), `implementation-plan.md#reuse-ledger`.  
      - **Checks** ‚Äì Coverage ‚â• 90% global / 95% changed; mutation ‚â• 90%; Semgrep/gitleaks/OSV clean; structure + Axe/jest-axe for UI/CLI; SBOM (CycloneDX 1.7) + SLSA v1.1 provenance + Cosign v3 bundle; model health logs; Evidence Triplet complete.  
      - **Exit criteria** ‚Äì All gates satisfied; `run-manifest.json.reuseEvidence` populated (`plan`, `failingTest`, `passingTest`, `reviewComment`).

      #### G6 ‚Äì Review

      - **Objective** ‚Äì Run AI reviewer neuron + human reviewer with unified checklist.  
      - **Required artefacts** ‚Äì `evidence/review.json`, `evidence/review-notes.md`, filled checklist pasted into PR referencing evidence anchors, reviewer acknowledgements appended to `work/implementation-log.md` or `decisions.md`.  
      - **Checks** ‚Äì All findings dispositioned; waivers recorded + approved; TDD plan reuse ledger link present; narrated diff acknowledged.  
      - **Exit criteria** ‚Äì Human reviewer approves; CI `danger` job green; waivers (if any) show Maintainer approval + expiry ‚â§30 days.

      #### G7 ‚Äì Document

      - **Objective** ‚Äì Align documentation, runbooks, changelog, and governance artefacts with the merged change.  
      - **Required artefacts** ‚Äì Updated READMEs/API docs/runbooks; changelog entry; `work/implementation-log.md` links to doc PRs; `ops/rollout-plan.md` completed.  
      - **Exit criteria** ‚Äì Documentation matches implementation; release notes ready; governance indexes updated.

      #### G8 ‚Äì Ship

      - **Objective** ‚Äì Execute rollout with feature flags, migrations, and telemetry hooks.  
      - **Required artefacts** ‚Äì `ops/rollout-plan.md`, `ops/rollback-plan.md`, deployment logs, Cosign bundle references.  
      - **Exit criteria** ‚Äì Release complete, feature flag strategy documented, rollback guardrails tested.

      #### G9 ‚Äì Monitor

      - **Objective** ‚Äì Observe impact, log trace context, track reuse telemetry, maintain error budgets.  
      - **Required artefacts** ‚Äì Monitoring dashboards, `logs/models/*`, `ops/observability/*`, alerts/resolution notes.  
      - **Exit criteria** ‚Äì No unresolved high-severity issues; telemetry stable; follow-ups filed if needed.

      #### G10 ‚Äì Archive

      - **Objective** ‚Äì Close the loop; persist artefacts for audits and Local Memory.  
      - **Required artefacts** ‚Äì `SUMMARY.md`, `archive.json`, review checklist snapshot in `.cortex/audit/reviews/<PR>-<sha>.md`, Local Memory entry IDs recorded in `json/memory-ids.json`.  
      - **Exit criteria** ‚Äì Task folder archived; Evidence Triplet + TDD plan reuse ledger indexed; `.github/instructions/memories.instructions.md` updated.

      ---

      ## 5. Canonical Flows

      > Each flow specifies its gate path, highlights, and mandatory artefacts.

      ### 5.1 Feature Implementation Flow

      - **Gate Path** ‚Äì G0 ‚Üí G1 ‚Üí G2 ‚Üí G3 ‚Üí G4 ‚Üí G5 ‚Üí G6 ‚Üí G7 ‚Üí (G8/G9/G10 as needed).
      - **Key Activities**  
        1. Classify task, set tier, create folder.  
        2. Run repo scan + academic research; log connectors health.  
        3. Draft PLAN.md (‚â§7 steps), TDD plan, risk register; run Cortex-Aegis.  
        4. Scaffold failing Milestone test, feature flags, contract snapshots.  
        5. Implement via TDD micro-loops with JEDI rules.  
        6. Run verification suite, SBOM/provenance, Aegis follow-up.  
        7. Perform AI + human review (checklist + Evidence Triplet).  
        8. Update docs/runbooks/changelog, then ship & monitor if applicable.
      - **Mandatory Artefacts** ‚Äì All items listed in ¬ß3.3 for Feature plus `implementation-plan.md#reuse-ledger`, `logs/vibe-check/*.json`, `research/connectors-health.log` entries.

      ### 5.2 Research / Spike Flow

      - **Gate Path** ‚Äì G0 ‚Üí G1 ‚Üí G2 ‚Üí (optional G3/G5 for prototypes) ‚Üí G10.  
      - **Key Activities** ‚Äì Context sweep, academic research (citations + license checks), hypothesis statement, evaluation criteria, and recommendation memo. Cortex-Aegis validates research parity/time freshness.  
      - **Outputs** ‚Äì Updated `context/research.md`, `plan/PLAN.md` (research-only), `evidence/aegis-report.json`, decision memo added to `SUMMARY.md`.  
      - **Exit** ‚Äì Recommendation accepted/rejected, follow-on task filed.

      ### 5.3 Fix Implementation Flow

      - **Gate Path** ‚Äì G0 ‚Üí G1 ‚Üí G2 ‚Üí G3 ‚Üí G4 ‚Üí G5 ‚Üí G6 ‚Üí G7 ‚Üí (G8/G9/G10).  
      - **Key Activities** ‚Äì Capture reproducer; add failing regression test; small plan; implement minimal fix; rerun tests + security checks; produce postmortem for incidents; ensure rollback ready.  
      - **Mandatory Artefacts** ‚Äì `context/requirements.md` (bug + repro), failing ‚Üí passing test logs, `ops/postmortem.md` (if severity warrants), `evidence/aegis-report.json` for non-trivial risk tags.

      ### 5.4 Refactor / Cleanup Flow

      - **Gate Path** ‚Äì G0 ‚Üí G1 ‚Üí G2 ‚Üí G3/G4 ‚Üí G5 ‚Üí G6 ‚Üí G7 ‚Üí G10.  
      - **Key Activities** ‚Äì Document invariants + baselines; plan safe sequence; implement behind feature flags if needed; prove behaviour unchanged via tests/perf metrics; record cleanup notes.  
      - **Mandatory Artefacts** ‚Äì Baseline/perf data, invariants summary, PLAN.md with guardrails, test evidence showing no regression.

      ### 5.5 Code Review Flow

      - **Gate Path** ‚Äì G5 ‚Üí G6 ‚Üí G7 ‚Üí G10 (consumes artefacts produced by authoring flows).  
      - **Key Activities** ‚Äì Pull Evidence Triplet + plan reuse ledger; run Reviewer Neuron; fill checklist referencing evidence anchors; disposition findings; log reviewer acknowledgements.  
      - **Mandatory Artefacts** ‚Äì `evidence/review.json`, `evidence/review-notes.md`, checklist excerpt stored in task folder + PR, pointer to TDD plan reuse ledger.

      ---

      ## 6. JEDI Coding Rules & Agent Defaults

      - **Patch-first** ‚Äì Always edit via diffs (git apply / apply_patch). No wholesale rewrites.  
      - **Test-first mindset** ‚Äì Define/extend tests during G2‚ÄìG4; enforce failing ‚Üí passing evidence before refactor.  
      - **Deterministic outputs** ‚Äì Structured JSON responses for tools, no hidden scratchpads.  
      - **Structured logs** ‚Äì Include `[brAInwav]`, `brand:"brAInwav"`, `component`, and `trace_id` per log line; propagate W3C `traceparent`.  
      - **OpenFeature only** ‚Äì All feature flags must use OpenFeature APIs/providers.  
      - **Cancellation mandatory** ‚Äì Every HTTP/MCP/tool call must respect `AbortSignal` or equivalent.  
      - **No stubs in prod** ‚Äì No fake ML outputs, placeholder adapters, `Math.random()` data, TODO/FIXME/HACK tags, or console stubs.  
      - **Named exports + ‚â§40 line functions** ‚Äì Enforced via ESLint + Semgrep.  
      - **Live model evidence** ‚Äì Log model IDs, vector shapes, latency metrics; store under `logs/models/`.  
      - **Secrets discipline** ‚Äì Fetch secrets via `op` CLI only; never commit credentials or long-lived env vars.  
      - **Agent startup checklist** ‚Äì On every session start, agents MUST: (1) read `governance-quickstart.md`; (2) read this workflow; (3) classify task + flow; (4) locate task folder + gate; (5) honour Cortex-Aegis policy; (6) log recap cadence.

      ---

      ## 7. Integration with Cortex-Aegis

      - **When to call**  
        - **Mandatory**: Feature, Fix, and Refactor flows at **G2** (plan approval).  
        - **Mandatory**: Feature and Fix flows at **G5** (evidence validation) when risk tags include security, privacy, a11y, or data-class ‚â• restricted.  
        - **Recommended**: Research flow before publishing recommendation; Code Review flow when reviewers dispute Aegis warnings.  
      - **Inputs** ‚Äì Task summary, ‚â§7-step plan, research citations (with license status), connector health logs, risk tags, tier, and time-freshness anchor.  
      - **Outputs** ‚Äì JSON verdict (`pass|warn|block`), required follow-ups, evidence references. Store raw output in `evidence/aegis-report.json` and link inside `run-manifest.json`.  
      - **Policy** ‚Äì `block` halts the gate until addressed; `warn` requires documented mitigation + reviewer acknowledgement. Missing logs = automatic CI failure.  
      - **Toolchain** ‚Äì Use the `vibe_check` MCP endpoint per `cortex-aegis.md`, keeping plan step budget ‚â§7 and logging responses under `logs/vibe-check/`.

      ---

      ## 8. References & Change Process

      - **Related governance docs** ‚Äì Constitution, AGENT_CHARTER (Rules of AI consolidated), Cortex-Aegis (Time Freshness Policy), unified checklists, TASK_FOLDER_STRUCTURE.
      - **Change authority** ‚Äì Updates require approval from GovOps maintainers plus at least one product-line representative. Every change must: (1) update this doc; (2) update `90-infra/governance-index.json` + `structure-guard.json`; (3) refresh `export-freeze.snapshot.json` and `GOVERNANCE_HASH_UPDATE.md`; (4) document delta in `changelog/<slug>/`.  
      - **Changelog** ‚Äì Append entries in `changelog/` using `pnpm changelog:new --slug <slug> --tier <fix|feature|refactor>` (or successor script). Example: `[2025-11-22] v2025.11.0 ‚Äì Moved workflow to 10-flow/, aligned with quickstart, embedded Cortex-Aegis + reuse ledger requirements.`

      ---

      **End of document.**
  - id: agentic_phase_policy
    file: .cortex/rules/10-flow/agentic-phase-policy.md
    sha: 753b47a9eaab75105e2da743980280cd5b5f16e63eb29ad003d7b4217e8663e0
    url: https://governance.cortex-os.local/docs/10-flow/agentic-phase-policy.md
    full_text: >
      # Agentic Phase Policy (R‚ÜíG‚ÜíF‚ÜíREVIEW) ‚Äî ArcTDD-Compatible


      **Goal:** Agents auto-progress through phases with zero HITL until
      **REVIEW**.  

      **Binding:** ArcTDD v2025.11 (G0‚ÄìG7), Charter Guardrails (#1‚Äì#10)


      ---


      ## Phase machine


      ### R (Red) ‚Äî write failing tests; plan minimal pass


      **Allowed**


      - Planning & test authoring; minimal scaffold code

      - Time Freshness Guard normalization

      - Academic research enhancement via MCP/HTTP connectors

      - Vibe Check (Oversight) after research, before any writes/long runs

      - Local Memory parity updates


      **Forbidden**


      - `human_input` (except Ask-First ‚â§3 clarifications in **G0/G1**)

      - Production deploys, merges


      **Auto-advance ‚Üí G when**


      - New acceptance/unit tests **fail first**, then **pass** on the next
      commit

      - `TIME_FRESHNESS:OK tz=<IANA> today=<YYYY-MM-DD>` token present

      - Oversight log (`brAInwav-vibe-check`) stored in `logs/vibe-check/`


      ---


      ### G (Green) ‚Äî implement to pass


      **Allowed**


      - Code to satisfy tests; refactor strictly to green

      - Live model probes: `pnpm models:health && pnpm models:smoke`
      (Frontier/MLX/Ollama)

      - Security scanners (Semgrep, OSV) and secret scans (gitleaks)

      - **Structured outputs required** for any machine-consumed LLM result
      (JSON-Schema or tool/function calling)


      **Forbidden**


      - `human_input` (Ask-First clarifications remain confined to G0/G1)


      **Auto-advance ‚Üí F when**


      - `pnpm test` **passes**

      - Coverage ‚â• **90%** global & **95%** changed lines

      - Mutation ‚â• **90%** (where enabled)

      - Latest model-health log includes engine, model IDs, vector dims/norms,
      P95 latency


      ---


      ### F (Finished) ‚Äî refactor, docs, a11y, supply-chain, structure


      **Allowed**


      - Non-behavioral refactors; documentation

      - A11y audits (axe/jest-axe/Playwright)

      - SBOM & provenance: **CycloneDX 1.7** + **SLSA v1.1**; **Cosign v3
      bundle** verify

      - Structure/contract guard, Observability checks


      **Forbidden**


      - `human_input` (Ask-First allowance does not apply here)


      **Auto-advance ‚Üí REVIEW when**


      - A11y reports attached

      - Security scanners: Semgrep (blockers), OSV clean, gitleaks zero secrets

      - `pnpm structure:validate` **passes**

      - `pnpm models:health && pnpm models:smoke` evidence attached (**live**
      only)

      - Local Memory parity entry appended (decisions/refactors)


      ---


      ### REVIEW ‚Äî human-in-the-loop only here


      **Allowed**


      - `human_input` (HITL), reviewer checklist, approvals/waivers per
      Constitution

      - Merge only when **all BLOCKERs** pass and evidence pointers resolve


      **Merge gate requires**


      - Evidence Triplet (milestone red‚Üígreen proof, contract snapshot, reviewer
      JSON pointer)

      - Trace Context proof (every governed log has `traceparent` + 32-hex
      `trace_id`)

      - SBOM (CycloneDX 1.7), SLSA v1.1 provenance, Cosign v3 **bundle** verify
      logs

      - A11y/security artifacts

      - Reuse Ledger pointer


      ---


      ## Hard rules (normative)


      1. **Ask-First ‚â§3 (G0/G1 only).** Each question must enumerate options +
      consequences. All Ask-First events are logged as `human_input:ask_first`.

      2. **No HITL before REVIEW.** Any other `human_input` pre-REVIEW is a
      violation unless a time-boxed waiver exists.

      3. **Structured outputs required.** Any model output that drives
      tools/files/network **must** be function/tool-calling or conform to a
      JSON-Schema, with validation on receipt.

      4. **Observability.** All charter-governed logs carry `[brAInwav]`,
      `brand:"brAInwav"`, ISO-8601 timestamp, `trace_id` (32 lower-hex), and
      **HTTP `traceparent`** for correlation. Missing fields fail gates.

      5. **Supply-chain.** Generate **CycloneDX 1.7** SBOM; produce **SLSA
      v1.1** provenance; sign/verify with **Cosign v3 bundle**.

      6. **Identity & secrets.** CI authenticates to cloud via **OIDC/WIF**
      only. Secrets are fetched at runtime using the **1Password CLI** (`op`);
      never persisted.

      7. **Hybrid models ‚Äî live only.** No stubs/recordings/dry-runs for
      embeddings/rerankers/generation. Frontier/MLX/Ollama health logs required.

      8. **A11y baseline.** WCAG 2.2 AA (ISO/IEC 40500:2025).


      ---


      ## Evidence tokens (CI scans logs for these)


      - `AGENTS_MD_SHA:<sha>`  

      - `PHASE_TRANSITION:<from>-><to>`  

      - `brAInwav-vibe-check`  

      - `TIME_FRESHNESS:OK tz=<tz> today=<yyyy-mm-dd>`  

      - `MODELS:LIVE:OK engine=<mlx|ollama|frontier> model=<id> dims=<n>
      norm‚âà<v> latency_ms=<n>`  

      - `A11Y_REPORT:OK`  

      - `STRUCTURE_GUARD:OK`  

      - `COVERAGE:OK CHANGED_LINES:OK MUTATION:OK`  

      - `MEMORY_PARITY:OK`  

      - `TRACE_CONTEXT:OK`  

      - `SUPPLY_CHAIN:OK sbom=cyclonedx@1.7 slsa=1.1 cosign=bundle`  


      > **Phase rollback:** Requires a waiver; emit `PHASE_OVERRIDE:<from>-><to>
      link=<waiver-url>`
  - id: cortex_aegis
    file: .cortex/rules/10-flow/cortex-aegis.md
    sha: cddf030cc8be93055bbd2493f90de926c28f58fd1859d99b416ff95fb1da22cd
    url: https://governance.cortex-os.local/docs/10-flow/cortex-aegis.md
    full_text: >
      # Cortex-Aegis: Assurance System for Agentic Workflows


      > The autonomous quality and governance assurance system for AI-native
      software development.


      ---


      ## 1. What is Cortex-Aegis?


      **Cortex-Aegis** is the automated assurance system that validates agentic
      development workflows against governance, security, and quality
      requirements. It serves as the "guardrail" for AI agents and humans,
      ensuring that plans, implementations, and changes align with Cortex-OS
      principles and compliance requirements.


      **Key Capabilities**:


      - Plan validation against governance frameworks

      - Risk assessment and mitigation recommendations  

      - Evidence verification and audit trail generation

      - Time-freshness validation for research and external sources

      - Compliance checking for security, privacy, and accessibility standards


      ---


      ## 2. Time Freshness Policy


      > **Consolidated from _time-freshness.md for unified assurance
      documentation**


      ### 2.1 Context Anchoring


      The user's timezone is {{USER_TIMEZONE}}. Today's date is {{TODAY}}.


      Treat dates before this as past and after this as future. When asked for
      "latest", "most recent", "today's", etc., do not assume knowledge is
      current; verify freshness or ask the user.


      ### 2.2 Secret Handling


      Retrieve all API keys, SSH credentials, and tokens at runtime via the
      1Password CLI (`op`) and never cache them in files or long-lived
      environment variables.


      ### 2.3 Freshness Validation in Aegis


      Cortex-Aegis MUST validate time-freshness for:


      - External research sources and citations

      - API documentation references

      - Security vulnerability databases

      - Dependency version checks

      - Compliance standard updates


      ---


      ## 3. When to Call Cortex-Aegis


      ### 2.1 Mandatory Invocation


      - **Feature Implementation (G2 + G5)**: All feature flows must call Aegis
      at plan validation (G2) and verification (G5) stages

      - **High-Risk Changes**: Any modification with risk tags ‚â• `medium` or
      touching security/privacy boundaries

      - **Contract Changes**: API modifications, schema updates, or interface
      changes

      - **Research Validation**: Academic source verification and time-freshness
      checks

      - **Compliance Requirements**: When WCAG, security, or regulatory
      compliance is involved


      ### 2.2 Optional but Recommended


      - Fix flows for non-trivial bugs or system-level issues

      - Refactoring that affects multiple packages or core abstractions

      - New tool/connector integrations in the MCP ecosystem

      - Experimental or prototype implementations


      ---


      ## 3. Academic Research Integration (Mandatory)


      ### 3.1 Available Academic MCP Providers


      Before running Cortex-Aegis validation, all implementation plans MUST be
      enhanced with academic research using the built-in MCP providers:


      - **Wikidata MCP** (Port 3029): Vector search for entities, properties,
      and relationships via `mcp_wikidata_*` tools

      - **arXiv MCP** (Port 3041): Semantic search for recent papers and
      technical approaches via `mcp_arxiv_*` tools

      - **Semantic Scholar API**: Identify proven solutions and highly-cited
      approaches

      - **OpenAlex API**: Discover broad research patterns and collaborations

      - **Context7 MCP**: Access domain-specific knowledge and best practices
      via `mcp_context7_*` tools


      ### 3.2 Research Workflow


      ```typescript

      // Example: Query academic sources via MCP

      await mcpClient.callTool('mcp_wikidata_vector_search', { query:
      '<concept>' });

      await mcpClient.callTool('mcp_arxiv_search', { query: '<research topic>'
      });

      await mcpClient.callTool('mcp_context7_get-library-docs', {
      context7CompatibleLibraryID: '<lib>' });


      // Store findings for Aegis consumption

      fs.writeFileSync(
        'tasks/<slug>/logs/academic-research/findings.json',
        JSON.stringify(researchResults, null, 2)
      );

      ```


      ### 3.3 License Validation Requirements


      - **License Risk Assessment**: Classify all academic sources by risk level
      (SAFE/REVIEW/RESTRICTED/PROHIBITED)

      - **Content Filtering**: Only include SAFE and REVIEW content in
      implementation plans

      - **Attribution Compliance**: Ensure proper citation and attribution for
      all used content

      - **Documentation**: Store license validation results alongside research
      findings


      ---


      ## 4. Implementation Guidelines


      ### 4.1 MCP Tool Invocation


      ```typescript

      // Call cortex-aegis MCP tool (replaces legacy vibe_check)

      const response = await mcpClient.callTool('cortex_aegis_validate', {
        goal: '<task summary>',
        plan: '1. Step one. 2. Step two. ... (max 7 steps)',
        sessionId: '<task-slug>-<timestamp>',
        gate: 'G2|G5|other',
        riskTags: ['security', 'privacy', 'compliance']
      });


      // Save response to evidence

      fs.writeFileSync(
        'tasks/<slug>/evidence/aegis-report.json',
        JSON.stringify(response, null, 2)
      );

      ```


      ### 4.2 Response Handling


      - **BLOCK verdicts** halt workflow progression until resolved

      - **WARN verdicts** require human review and disposition in
      `evidence/review-notes.md`

      - **PASS verdicts** enable automatic gate progression


      ### 4.3 Output Schema


      **Primary Response** (`evidence/aegis-report.json`):


      ```json

      {
        "verdict": "PASS|WARN|BLOCK",
        "timestamp": "ISO-8601-timestamp",
        "version": "aegis-framework-version",
        "validations": [...],
        "recommendations": [...],
        "requiredActions": [...],
        "auditTrail": {...}
      }

      ```


      **Audit Logs** (`logs/vibe-check/*.json`):


      - Detailed validation traces for compliance auditing

      - Evidence collection and verification logs  

      - Time-stamped decision rationale


      ---


      ## 5. Configuration & Integration


      ### 5.1 Server Configuration


      **Default Endpoint**: `${CORTEX_AEGIS_HTTP_URL:-http://127.0.0.1:2001}`


      **Required Environment Variables**:


      - `CORTEX_AEGIS_HTTP_URL`: Aegis service endpoint

      - `ACADEMIC_RESEARCH_ENABLED`: Enable/disable research integration

      - `AEGIS_COMPLIANCE_FRAMEWORKS`: Active compliance frameworks


      ### 5.2 Task Integration Points


      **Required Files**:


      - `evidence/aegis-report.json`: Primary validation results

      - `logs/vibe-check/*.json`: Audit trail (legacy naming for compatibility)

      - `run-manifest.json.evidence.aegisReport`: Relative path reference


      **Gate Dependencies**:


      - G2 (Plan): Mandatory for feature flows, recommended for others

      - G5 (Verify): Mandatory for feature flows and high-risk changes

      - Ad-hoc: Available for any validation requirements


      ---


      ## 6. Legacy Compatibility


      ### 6.1 Vibe Check Migration


      **Transition Period**: 2025-11-22 through 2025-12-31


      - Legacy `vibe_check` tool calls redirect to `cortex_aegis_validate`

      - Existing log paths (`logs/vibe-check/`) maintained for compatibility

      - Gradual migration of references from "vibe check" to "Cortex-Aegis"


      **Breaking Changes After 2025-12-31**:


      - `vibe_check` tool will be deprecated

      - New log structure under `logs/aegis/`

      - Updated tool names and parameters


      ### 6.2 Connector Outage Protocol


      **Fallback Behavior**:


      - Academic research requirements become optional during connector outages

      - Validation proceeds with available data and explicit uncertainty markers

      - Manual review requirements increase for plans developed during outages


      ---


      ## 7. Related Documentation


      **Core Governance**:


      - [Constitution](../00-core/constitution.md) - Foundational principles

      - [Agent Charter](../00-core/AGENT_CHARTER.md) - Agent behavior
      requirements

      - [Time Freshness Policy](./cortex-aegis.md#time-freshness-policy) -
      Source validation rules


      **Workflow Integration**:


      - [Governance Quickstart](../10-flow/governance-quickstart.md) - Overview
      and flow mapping

      - [Agentic Workflow](../10-flow/agentic-coding-workflow.md) - Detailed
      gate specifications

      - [Unified Checklists](../20-checklists/checklists.cortex-os.md) - Section
      7 Aegis requirements


      - When any academic MCP connector is unavailable, check connector health
      via `/health` endpoints:
        - Wikidata MCP: `curl ${WIKIDATA_MCP_URL:-http://127.0.0.1:3029}/health`
        - arXiv MCP: `curl ${ARXIV_MCP_URL:-http://127.0.0.1:3041}/health`
        - Cortex Vibe MCP: `curl ${CORTEX_VIBE_HTTP_URL:-http://127.0.0.1:2001}/health`
      - Document the outage in a waiver JSON at
      `logs/academic-research/<slug>-<timestamp>-waiver.json` with `[brAInwav]`
      branding

      - Record the waiver pointer in `run-manifest.json` and schedule a
      follow-up check within 72 hours

      - Plans submitted to Oversight must surface outstanding uncertainties
      (e.g., connector uptime, attestation tooling) so reviewers can challenge
      mitigations early


      **Enhanced Plan Format with Research Integration:**


      ```

      Plan for: "Implement API rate limiting"

      1. Research rate limiting patterns and best practices (Research-backed:
      arXiv:2301.12345, Semantic Scholar citations: 156)

      2. Design token bucket algorithm based on academic standards
      (Research-backed: Context7 patterns)

      3. Implement Redis-based rate limiter with wikidata-validated algorithm
      properties (Research-backed: Wikidata Q1860)

      4. Add comprehensive testing based on peer-reviewed validation methods
      (Research-backed: OpenAlex research patterns)

      5. Create monitoring dashboards using academically-proven metrics
      (Research-backed: Semantic Scholar highly-cited approaches)

      6. Document with academic references and proven methodologies

      7. Deploy with gradual rollout based on research-backed deployment
      strategies

      ```


      **Academic Research Enhancement Process:**


      1. **Automatic Query Generation**: Extract key concepts from the plan and
      generate academic search queries

      2. **Multi-Source Research**: Execute searches across all academic
      databases simultaneously

      3. **License Validation**: Assess risk levels and filter content by usage
      rights

      4. **Evidence Integration**: Incorporate license-compliant findings into
      plan steps with proper citations

      5. **Validation**: Cross-reference approaches across multiple academic
      sources

      6. **Documentation**: Store research evidence and license validation
      alongside vibe-check responses


      ### 3.2 Server Setup


      The Vibe Check MCP server is now included in the Cortex-OS monorepo:


      ```bash

      # Local development setup

      cd packages/vibe-check-mcp-server

      pnpm install

      pnpm build


      # Start the server

      pnpm start --port 2001


      # Or use launchd service

      launchctl load ~/Library/LaunchAgents/com.brainwav.cortex-vibe.plist

      ```


      **Server Configuration:**


      - **Default URL**: `http://127.0.0.1:2001` (configurable via
      `CORTEX_VIBE_HTTP_URL`)

      - **Health Check**: `GET /health`

      - **MCP Endpoint**: `POST /mcp` (JSON-RPC 2.0)

      - **Tools Available**:
        - `vibe_check` - Oversight with clarifying questions and alignment validation
        - `vibe_learn` - Optional logging of mistakes and successes for review

      **Supported LLM Providers**:


      - OpenAI (GPT models)

      - Anthropic (Claude models)

      - Google (Gemini models)

      - OpenRouter (various models)


      ### 3.3 JSON-RPC Fallback


      POST to `${CORTEX_VIBE_HTTP_URL:-http://127.0.0.1:2001}/mcp` with:


      ```json

      {
        "jsonrpc": "2.0",
        "id": "<uuid>",
        "method": "tools/call",
        "params": {
          "name": "vibe_check",
          "arguments": {
            "goal": "<task summary>",
            "plan": "1. Step one. 2. Step two.",
            "sessionId": "<session-id>"
          }
        }
      }

      ```


      - Include headers: `Content-Type: application/json` and `Accept:
      application/json, text/event-stream`.

      - Save the raw response to `logs/vibe-check/<slug>.json` (pretty or
      compact JSON allowed).


      ---


      ## 4. Evidence Package (merge gate)


      To satisfy CI and review:


      1. Commit the JSON response at `logs/vibe-check/<slug>.json` inside the
      task folder.

      2. Record the command (or HTTP POST) with timestamp and session ID in
      `~/tasks/<slug>/notes.md` or `decisions.md`.

      3. Reference the artifact in the PR description and attach the same path
      in review evidence (Code Review Checklist).

      4. Map each finding or mitigation to the applicable OWASP LLM Top 10
      control ID(s) listed in `/.cortex/rules/llm-threat-controls.md`; include
      the mapping in the PR evidence comment.

      5. Capture the proposed edit envelope: directories, allowed file globs,
      max files, and max total LOC. Store alongside the JSON response (e.g.,
      `edit-envelope.json`) so CI can enforce the declared patch budget.

      6. Ensure all oversight-related logs contain `[brAInwav]` and
      `brand:"brAInwav"` for audit search.


      Failure to meet any item keeps the PR in a blocked state (`agents-guard`
      job).


      ---


      ## 5. Error Handling and Escalation


      - **Server unreachable / health check fails:** stop work, mark the task
      blocked, and escalate per the Constitution. Do **not** bypass the gate
      without a formally recorded waiver under `/.cortex/waivers/`.

      - **HTTP 406 or schema errors:** verify headers and ensure the plan
      contains numbered steps ‚â§ 7. Correct and retry.

      - **Timeouts:** retry once after confirming server health; repeated
      timeouts require escalation.

      - **Session resets:** if a `pnpm session:reset` run occurs, perform a new
      vibe check before resuming implementation.


      ---


      ## 6. Related Resources


      - Runbook with troubleshooting scripts: `docs/runbooks/vibe-check.md`

      - Governance reference: `/.cortex/rules/agentic-coding-workflow.md` ¬ß0.1
      and ¬ßG5

      - CLI helper source: `scripts/oversight/vibe-check-call.mjs`

      - Oversight evidence index: `.cortex/audit/`


      ---
  - id: time_freshness
    file: .cortex/rules/10-flow/_time-freshness.md
    sha: ""
    url: https://governance.cortex-os.local/docs/10-flow/_time-freshness.md
    full_text: >
      # Time Freshness Policy ‚Üí cortex-aegis.md


      **Status**: CONSOLIDATED (stub only; not in governance precedence) -
      Content moved to canonical location

      **New Location**: `/.cortex/rules/10-flow/cortex-aegis.md` ¬ß Time
      Freshness Policy  

      **Last Updated**: 2025-11-22


      ---


      ## üìã Policy Consolidated


      Time freshness rules and context anchoring requirements have been **merged
      into** Cortex-Aegis for unified assurance:


      üëâ **See**: `/.cortex/rules/10-flow/cortex-aegis.md` ¬ß "Time Freshness
      Policy"


      This consolidation ensures time-freshness validation is integrated with
      all governance and quality assurance workflows.
  - id: checklists
    file: .cortex/rules/20-checklists/checklists.cortex-os.md
    sha: ab1a82f3f5d7b52a4c7bc590596207b336c80186b173c7e648d1b5c2ed3eb144
    url: https://governance.cortex-os.local/docs/20-checklists/checklists.cortex-os.md
    full_text: >
      <!-- .cortex/rules/20-checklists/checklists.cortex-os.md -->


      # Cortex-OS Checklists


      > Canonical, enforceable checklists for local work, agent runs, PR
      authors, reviewers, and CI.  

      > This file is normative; all other checklist fragments must alias or
      embed these sections.


      ---


      ## 0. Document Metadata


      - **Doc ID**: `checklists.cortex-os`

      - **Version**: `2025.11.0`

      - **Status**: `active`

      - **Owner**: `Governance & Reliability (GovOps)`

      - **Last Updated**: `2025-11-22`


      ---


      ## 1. How to Use This File


      - **Humans** use this file before committing, opening PRs, or approving
      reviews. Reference section numbers in PR templates and review notes.

      - **Agents** load this file at session start, select the relevant flow
      (Feature/Research/Fix/Refactor/Review), and follow the gate checklist for
      the current ArcTDD stage.

      - **CI** jobs reference section numbers via `CHECKLIST_SECTION`
      annotations (e.g. `CI:G5`), and upload artefacts named after these
      sections.


      > Related governance: `.cortex/rules/10-flow/governance-quickstart.md`,
      `10-flow/agentic-coding-workflow.md`, `10-flow/cortex-aegis.md` (Time
      Freshness Policy), `.cortex/rules/00-core/constitution.md`,
      `.cortex/rules/00-core/AGENT_CHARTER.md`.


      ---


      ## 2. Local Dev & Agent Run Checklist


      > Run before you commit or ask an agent to change files.


      ### 2.1 General Local Sanity


      - [ ] Dependencies install cleanly: `pnpm install` (or `pnpm install
      --frozen-lockfile`).

      - [ ] Lint passes for affected projects: `pnpm nx affected -t lint`
      (fallback `pnpm lint`).

      - [ ] Typecheck passes: `pnpm nx affected -t typecheck` (fallback `pnpm
      typecheck`).

      - [ ] Build/dev target succeeds for touched surface: `pnpm nx affected -t
      build` or the package-specific `pnpm --filter <pkg> build`.


      ### 2.2 Agent Session Startup


      - [ ] Agent read `.cortex/rules/10-flow/governance-quickstart.md` and
      `10-flow/agentic-coding-workflow.md` this session.

      - [ ] Task type + flow selected; task folder located; current gate
      (G0‚ÄìG10) identified in `run-manifest.json`.

      - [ ] Agent configured for:
        - [ ] Patch-first diffs (no whole-file rewrites).
        - [ ] Structured outputs / JSON schemas where required.
        - [ ] JEDI rules (named exports, ‚â§40-line functions, no TODO/FIXME/HACK, cancellation support for HTTP/tool calls).

      ### 2.3 Local Quality Checks (Developer)


      - [ ] Every new/changed code path has at least one automated test.

      - [ ] Breaking contracts (API/event/schema) documented in
      `context/requirements.md` and target docs/ADR.

      - [ ] Feature flags/config defaults are safe/off by default and described
      in `ops/rollout-plan.md`.

      - [ ] Secrets pulled via `op` (1Password CLI); no secrets committed or
      persisted.


      ---


      ## 3. PR Author Checklist


      > Complete before opening or updating a PR. Attach evidence links where
      possible.


      ### 3.1 Metadata & Scope


      - [ ] PR description links to `tasks/<task-slug>/` (or
      `Changelog/<slug>/`).

      - [ ] PR states task type + flow and highest gate completed (e.g. "Feature
      flow through G6").

      - [ ] `run-manifest.json` committed/updated with tier, gates, Evidence
      Triplet pointers, and `reuseEvidence` entries.


      ### 3.2 Evidence Triplet


      - [ ] **Tests**: cite failing test path/log pre-change and passing
      evidence post-change (`evidence/tests.md`, `evidence/test-results/*`).

      - [ ] **Plan**: `plan/PLAN.md` (‚â§7 steps) matches implemented work;
      include link/anchor.

      - [ ] **Review**: Reviewer neuron scheduled; human reviewer requested;
      `evidence/review.json` & `review-notes.md` placeholders present.


      ### 3.3 Artefact Presence by Flow


      #### Feature


      - [ ] `meta/task.json`, `context/requirements.md` (North-Star),
      `context/research.md`, `plan/PLAN.md`, `plan/tdd-plan.md`,
      `work/implementation-log.md`.

      - [ ] `evidence/aegis-report.json` uploaded (Cortex-Aegis G2/G5 verdicts)
      + `logs/vibe-check/*.json`.

      - [ ] `implementation-plan.md#reuse-ledger` updated;
      `run-manifest.json.reuseEvidence.*` filled.


      #### Research / Spike


      - [ ] `meta/task.json` type=Research; `context/research.md` with queries +
      citations; license checks logged in `research/connectors-health.log`.

      - [ ] Recommendation recorded in `plan/PLAN.md` and `SUMMARY.md`; code
      changes flagged as experimental if any.


      #### Fix


      - [ ] Reproducer documented in `context/requirements.md` + failing
      regression test attached.

      - [ ] `ops/postmortem.md` for SEV‚â§2+ incidents; roll-forward/back strategy
      in `ops/rollout-plan.md`/`rollback-plan.md`.

      - [ ] `evidence/aegis-report.json` (risk ‚â• medium) and connectors health
      log updated.


      #### Refactor


      - [ ] Baseline invariants + perf metrics captured in
      `context/research.md`.

      - [ ] `plan/PLAN.md` clarifies boundaries + success metrics (no behaviour
      change).

      - [ ] `evidence/tests.md` shows before/after parity (tests, perf,
      mutation).


      #### Review-only


      - [ ] `meta/task.json` type=Review; `evidence/review.json` +
      `review-notes.md` populated; checklist pasted as PR comment.


      ### 3.4 Documentation & Ops


      - [ ] READMEs/API docs/runbooks updated (cite files/links).

      - [ ] `ops/rollout-plan.md` + `ops/rollback-plan.md` committed when
      rollout/flags apply.

      - [ ] Changelog entry created (`pnpm changelog:new --slug <slug> --tier
      <type>` or successor tooling) and referenced in PR.


      ---


      ## 4. Code Review Checklist (Human + AI)


      > Applies at G6; AI reviewer consumes this list, human reviewer references
      the same items.


      ### 4.1 Governance & Scope


      - [ ] Scope appropriate; no unrelated changes.

      - [ ] Constitution + AGENT_CHARTER requirements satisfied (branding,
      secrets, reality filter, no fake telemetry).

      - [ ] Task folder + `run-manifest.json` present and current.

      - [ ] Reuse-first artefacts (analysis/reuse-evaluation.md + PLAN reuse
      ledger) reviewed; helper diffs cite evidence.


      ### 4.2 Correctness & Tests


      - [ ] Tests cover new behaviour, edge cases, and failure modes; regression
      tests prove fixes.

      - [ ] Evidence Triplet verified (failing‚Üípassing tests, plan anchor,
      reviewer proof).

      - [ ] Coverage ‚â•90% global / 95% changed lines; mutation ‚â•90% where
      enabled.


      ### 4.3 Accessibility & UX


      - [ ] UI/CLI changes meet WCAG 2.2 AA (axe/jest-axe evidence) and support
      keyboard-only + screen readers.

      - [ ] No color-only signalling; focus order + labels verified; mention "no
      UI impact" if not applicable.


      ### 4.4 Security & Privacy


      - [ ] No secrets or keys committed; 1Password CLI usage documented.

      - [ ] New inputs validated; outputs encoded; threat model touched if risk
      tags include security/privacy.

      - [ ] Semgrep, gitleaks, OSV, `pnpm security:scan`, SBOM (CycloneDX 1.7),
      and SLSA v1.1 attestations referenced.


      ### 4.5 Performance & Reliability


      - [ ] Hot path changes reviewed for allocations + complexity; long-running
      operations cancellable.

      - [ ] Observability: logs/metrics/traces include `brand:"brAInwav"`,
      `trace_id`, `traceparent`.

      - [ ] Rollback plan realistic; feature flags guard risky features.


      ### 4.6 AI / MCP Specific


      - [ ] Live model usage only; `logs/models/*` show health/smoke runs with
      IDs + latency.

      - [ ] Prompt/schema changes versioned + tested; MCP connectors documented
      + healthy.

      - [ ] Reviewer notes include disposition for each AI finding
      (Accept/Reject/Follow-up) in `evidence/review-notes.md`.


      ---


      ## 5. CI Job Checklist (Pipeline Mapping)


      | Section | Responsible Job (default) | Required Evidence |

      |---------|---------------------------|-------------------|

      | `CI:lint-type` | `pnpm nx run-many -t lint,typecheck` or package CI task
      | Lint/type logs attached; fails on warning-as-error. |

      | `CI:test` | `pnpm nx affected -t test --coverage` (or package test cmd)
      | `coverage-results.json`, HTML diff; ‚â•90% global / 95% changed lines. |

      | `CI:mutation` | `pnpm exec tsx scripts/ci/mutation.sh` |
      `mutation-results.json`, `reports/mutation/`. Threshold ‚â•90%. |

      | `CI:a11y` | `pnpm test:a11y` / Playwright axe run | axe/jest-axe
      reports; fails on critical issues. |

      | `CI:security` | `pnpm security:scan` + Semgrep/gitleaks/OSV | Scanner
      SARIF/JSON; SBOM (`sbom/*.cdx.json`), `pnpm sbom:generate`, `pnpm
      attest:sign` bundles. |

      | `CI:structure` | `pnpm structure:validate` + governance hash check |
      `structure-guard.json` output, `governance-index.json` hash,
      `export-freeze.snapshot.json` digest update per
      `GOVERNANCE_HASH_UPDATE.md`. |

      | `CI:charter` | `charter-enforce` workflow | `quality-report.json`,
      narrated diff, trace-context log, evidence of
      `run-manifest.json.reuseEvidence` pointers. |


      CI jobs must fail closed; waivers recorded in `.cortex/waivers/` with
      expiry ‚â§30 days and linked in PR/quality report.


      ---


      ## 6. Gate-Specific Checklists (ArcTDD G0‚ÄìG10)


      > Use alongside `10-flow/agentic-coding-workflow.md`. Each gate must
      satisfy its checklist before advancing.


      ### G0 ‚Äì Initialize


      - [ ] Task folder created; `meta/task.json` + `meta/tags.json` populated
      (type, tier, owners, risk tags, feature flags).

      - [ ] Flow selected and logged in `run-manifest.json`.

      - [ ] Time freshness anchor noted per `cortex-aegis.md`.


      ### G1 ‚Äì Discover / Research


      - [ ] Repo/project scan + Local Memory `/recall` executed; findings logged
      in `context/research.md`.

      - [ ] Academic connectors (Wikidata 3029, arXiv 3041, Semantic Scholar,
      OpenAlex, Context7) health-checked; log under
      `research/connectors-health.log`.

      - [ ] RAIDs/assumptions documented; North-Star acceptance test path
      recorded.


      ### G2 ‚Äì Plan / Design


      - [ ] `plan/PLAN.md`, `plan/tdd-plan.md`, `plan/risk-register.md` updated
      (‚â§7 steps per arc).

      - [ ] Cortex-Aegis executed when required (see ¬ß7);
      `evidence/aegis-report.json` stored.

      - [ ] Feature flags + quality gates defined; reuse ledger entries planned.


      ### G3 ‚Äì Scaffold


      - [ ] Failing milestone tests implemented and logged
      (`run-manifest.json.reuseEvidence.failingTest`).

      - [ ] Feature flags default-off via OpenFeature; contract snapshots
      stored.

      - [ ] No placeholder adapters or TODO/FIXME/HACK in production paths.


      ### G4 ‚Äì Implement


      - [ ] Implementation aligned with PLAN.md; deviations noted in
      `work/implementation-log.md`.

      - [ ] Tests updated alongside code; micro TDD loops observed.

      - [ ] Observability + cancellation wired; models logged live-only.


      ### G5 ‚Äì Verify


      - [ ] Test suites + `pnpm test:coverage`/`pnpm exec tsx
      scripts/ci/summarize-coverage.mjs` run; coverage/mutation thresholds met.

      - [ ] Security (`pnpm security:scan`, Semgrep, gitleaks, OSV), a11y (`pnpm
      test:a11y`), performance (bench/perf reports) executed.

      - [ ] SBOM (CycloneDX 1.7) + SLSA v1.1 provenance + Cosign v3 bundle
      produced; Evidence Triplet complete;
      `run-manifest.json.reuseEvidence.passingTest` populated.


      ### G6 ‚Äì Review


      - [ ] AI reviewer (Reviewer Neuron) run; `evidence/review.json` captured.

      - [ ] Human reviewer completes Section 4 checklist; dispositions logged in
      `evidence/review-notes.md`.

      - [ ] Narrated diff acknowledged; waivers (if any) approved and stored.


      ### G7 ‚Äì Document


      - [ ] READMEs/API docs/runbooks updated; changelog entry linked.

      - [ ] `ops/rollout-plan.md` + `rollback-plan.md` finalized;
      `work/implementation-log.md` references docs.


      ### G8 ‚Äì Ship


      - [ ] Deployment executed per rollout plan; feature flags managed; Cosign
      bundles referenced.

      - [ ] Validation logs stored under `validation/` or `ops/`.


      ### G9 ‚Äì Monitor


      - [ ] Logs/metrics/traces monitored; alert tuning documented;
      `logs/models/*` updated if models changed.

      - [ ] Reuse telemetry + tier escalation metrics pushed to
      `ops/observability/*` dashboards.


      ### G10 ‚Äì Archive


      - [ ] `SUMMARY.md`, `lessons-learned.md`, `archive.json` completed; Local
      Memory entries recorded (`json/memory-ids.json`).

      - [ ] Review checklist snapshot mirrored to
      `.cortex/audit/reviews/<PR>-<sha>.md`.


      ---


      ## 7. Cortex-Aegis Checklists


      > Assurance system hooking plan/evidence validation.


      ### 7.1 When Aegis MUST Run


      - [ ] Feature flows at G2 (plan) and again at G5 (verification) for any
      risk tag ‚â• `medium` or touching user-facing / contract surfaces.

      - [ ] Fix flows impacting security, privacy, data protection, or critical
      infrastructure.

      - [ ] Refactor flows when contracts, storage schemas, or security
      boundaries change.

      - [ ] Any task introducing a new MCP tool, connector, or ML model
      integration.


      ### 7.2 Inputs Required


      - [ ] `plan/PLAN.md` (‚â§7 steps) + `plan/tdd-plan.md` summarised in the
      Aegis request (`steps` field, ‚â§7 items).

      - [ ] `context/research.md` citations + connector health log references.

      - [ ] Risk tags + tier from `meta/task.json` / `meta/tags.json`.

      - [ ] Time freshness note (ISO date) referencing `cortex-aegis.md`.


      ### 7.3 Outputs & Policy


      - [ ] Raw response saved to `evidence/aegis-report.json`;
      `logs/vibe-check/*.json` for audit.

      - [ ] `block` verdict halts the gate until resolved; attach mitigation
      evidence before retrying.

      - [ ] `warn` verdict requires human disposition in
      `evidence/review-notes.md`.

      - [ ] `run-manifest.json.evidence.aegisReport` pointer added (relative
      path).


      ---


      ## 8. Accessibility & Inclusive UX Checklist (Global)


      - [ ] Keyboard-only path works; focus order logical and visible.

      - [ ] Screen readers announce controls/errors; ARIA labels/roles present.

      - [ ] No color-only signalling; icons/text used; contrast meets WCAG 2.2
      AA.

      - [ ] Respects reduced-motion preferences; animations limited.

      - [ ] A11y report (axe/jest-axe or equivalent) attached in
      `evidence/test-results/`.


      ---


      ## 9. Change Management for This File


      - [ ] Updates reviewed/approved by GovOps maintainers.

      - [ ] `governance-index.json`, `structure-guard.json`, and
      `export-freeze.snapshot.json` updated to reference new sections; follow
      `GOVERNANCE_HASH_UPDATE.md`.

      - [ ] CI jobs referencing legacy checklist names updated to point here
      (`CHECKLIST_SECTION` tags).

      - [ ] Redundant checklist files (`CHECKLIST.cortex-os.md`,
      `ci-review-checklists.md`, `code-review-checklist.md`) either migrate
      content here or become stubs referencing this file.


      ### 9.1 Changelog


      - `[2025-11-22] v2025.11.0 ‚Äì Consolidated local, PR, review, CI, gate, and
      Aegis checklists into a single canonical source under 20-checklists/.`
  - id: structure_guard
    file: .cortex/rules/90-infra/structure-guard.json
    sha: ""
    url: https://governance.cortex-os.local/docs/structure-guard.json
    full_text: |
      {
      	"$schema": "http://json-schema.org/draft-07/schema#",
      	"title": "Structure Guard Rules",
      	"description": "Import boundary enforcement for Cortex-OS packages",
      	"type": "object",
      	"properties": {
      		"version": {
      			"type": "string",
      			"const": "1.0"
      		},
      		"rules": {
      			"type": "object",
      			"properties": {
      				"forbidden_cross_package_imports": {
      					"type": "array",
      					"description": "Block direct imports between feature packages",
      					"items": {
      						"type": "object",
      						"properties": {
      							"from": {
      								"type": "string",
      								"description": "Source package pattern"
      							},
      							"to": {
      								"type": "string",
      								"description": "Target package pattern"
      							},
      							"message": {
      								"type": "string"
      							}
      						},
      						"required": ["from", "to", "message"]
      					}
      				},
      				"allowed_imports": {
      					"type": "array",
      					"description": "Explicit allowlist for cross-package imports",
      					"items": {
      						"type": "object",
      						"properties": {
      							"from": {
      								"type": "string"
      							},
      							"to": {
      								"type": "string"
      							},
      							"reason": {
      								"type": "string"
      							}
      						},
      						"required": ["from", "to", "reason"]
      					}
      				},
      				"path_restrictions": {
      					"type": "array",
      					"description": "Prevent path escapes and unsafe file operations",
      					"items": {
      						"type": "object",
      						"properties": {
      							"pattern": {
      								"type": "string",
      								"description": "Regex pattern to match"
      							},
      							"severity": {
      								"type": "string",
      								"enum": ["error", "warning"]
      							},
      							"message": {
      								"type": "string"
      							}
      						},
      						"required": ["pattern", "severity", "message"]
      					}
      				}
      			},
      			"required": ["forbidden_cross_package_imports"]
      		}
      	},
      	"required": ["version", "rules"],
      	"example": {
      		"version": "1.0",
      		"rules": {
      			"forbidden_cross_package_imports": [
      				{
      					"from": "packages/agents/**",
      					"to": "packages/memories/**",
      					"message": "Agents must use A2A events to access memories"
      				},
      				{
      					"from": "packages/rag/**",
      					"to": "packages/model-gateway/**",
      					"message": "RAG must use model-gateway HTTP API, not direct imports"
      				}
      			],
      			"allowed_imports": [
      				{
      					"from": "packages/agents/**",
      					"to": "packages/observability/**",
      					"reason": "Agents need OTEL tracing and logging"
      				},
      				{
      					"from": "**",
      					"to": "packages/kernel/**",
      					"reason": "Kernel provides core primitives for all packages"
      				}
      			],
      			"path_restrictions": [
      				{
      					"pattern": "\\.\\./\\.\\./",
      					"severity": "error",
      					"message": "Path escape detected - use absolute imports"
      				},
      				{
      					"pattern": "process\\.cwd\\(\\)",
      					"severity": "warning",
      					"message": "Avoid process.cwd() - use __dirname or import.meta.url"
      				}
      			]
      		}
      	}
      }
  - id: export_freeze_snapshot
    file: .cortex/rules/90-infra/export-freeze.snapshot.json
    sha: ""
    url: https://governance.cortex-os.local/docs/export-freeze.snapshot.json
    full_text: >
      {
        "brand": "brAInwav",
        "version": "1.0.0",
        "modules": [
          {
            "file": "packages/utils/src/index.ts",
            "exports": ["LogContext", "__private__", "error", "info", "log", "warn", "withContext"]
          }
        ]
      }
  - id: governance_index
    file: .cortex/rules/governance-index.json
    sha: ""
    url: https://governance.cortex-os.local/docs/governance-index.json
    full_text: >
      {
          "precedence": [
              "00-core/constitution.md",
              "00-core/AGENT_CHARTER.md",
              "10-flow/governance-quickstart.md",
              "10-flow/agentic-coding-workflow.md",
              "10-flow/cortex-aegis.md",
              "20-checklists/checklists.cortex-os.md",
              "00-core/CHARTER_FRAGMENT.md",
              "00-core/vision.md",
              "00-core/llm-threat-controls.md",
              "00-core/skills-system-governance.md",
              "10-flow/agentic-phase-policy.md",
              "10-flow/TASK_FOLDER_STRUCTURE.md",
              "CODESTYLE.md",
              "SECURITY.md"
          ],
          "docs": {
              "CHARTER_FRAGMENT.md": {
                  "path": "/.cortex/rules/00-core/CHARTER_FRAGMENT.md",
                  "sha256": "8fdd538b1acc51035b66dd3ac9481464c341b657a841ed2d6ed0ba696fb46e0e",
                  "required_tokens": [
                      "Step Budget ‚â§ 7",
                      "Ask-First ‚â§ 3",
                      "Evidence Triplet"
                  ]
              },
              "AGENTIC_WORKFLOWS.cortex-os.md": {
                  "path": "/.cortex/rules/AGENTIC_WORKFLOWS.cortex-os.md",
                  "sha256": "f8aaf5fe1cfa9d700601dca4988a1fb87d58ee5724c58eee9b8494e734140f57",
                  "required_tokens": [
                      "Agentic Workflows",
                      "Cortex Aegis MCP"
                  ]
              },
              "AGENT_CHARTER.md": {
                  "path": "/.cortex/rules/00-core/AGENT_CHARTER.md",
                  "sha256": "d9a9ef1575b4e1c4555a36f8e63ef5e0b8cc124c79e5b78de62b2ba7d8723968",
                  "required_tokens": [
                      "[brAInwav]",
                      "MODELS:LIVE:OK",
                      "NORTH_STAR:RED_FIRST"
                  ]
              },
              "agentic-coding-workflow.md": {
                  "path": "/.cortex/rules/10-flow/agentic-coding-workflow.md",
                  "sha256": "7ea61989105a13f64ec81c46cb018b5655b54268bcd8831f4212eec819c72c76",
                  "required_tokens": [
                      "G0 Initialize",
                      "Evidence Triplet"
                  ]
              },
              "cortex-aegis.md": {
                  "path": "/.cortex/rules/10-flow/cortex-aegis.md",
                  "sha256": "cddf030cc8be93055bbd2493f90de926c28f58fd1859d99b416ff95fb1da22cd",
                  "required_tokens": [
                      "Cortex Aegis",
                      "Time Freshness"
                  ]
              },
              "governance-maintainers.md": {
                  "path": "/.cortex/rules/90-infra/governance-maintainers.md",
                  "sha256": "fb9f42aea48e79fe65bf5429d52b99295e02fc8803cc0d5e245eb3108f83a904",
                  "required_tokens": [
                      "hash sync",
                      "maintainer"
                  ]
              },
              "governance-quickstart.md": {
                  "path": "/.cortex/rules/10-flow/governance-quickstart.md",
                  "sha256": "1795f44dd28df68f335d00d2add94d6617f43ea0fbe92fb743394f8387a6ced3",
                  "required_tokens": [
                      "governance quickstart",
                      "workflow selection"
                  ]
              },
              "checklists.cortex-os.md": {
                  "path": "/.cortex/rules/20-checklists/checklists.cortex-os.md",
                  "sha256": "ab1a82f3f5d7b52a4c7bc590596207b336c80186b173c7e648d1b5c2ed3eb144",
                  "required_tokens": [
                      "checklist",
                      "quality gates"
                  ]
              },
              "constitution.md": {
                  "path": "/.cortex/rules/00-core/constitution.md",
                  "sha256": "47b0df7a7aafcb7cc3fb512290a7c2b2d0688b780ea73520fb1a40185531e5b9",
                  "required_tokens": [
                      "Cortex-OS Constitution",
                      "Core Principles"
                  ]
              },
              "llm-threat-controls.md": {
                  "path": "/.cortex/rules/00-core/llm-threat-controls.md",
                  "sha256": "75bb7f77caa566add4489259f97512eed84e52a0718eb0b2e3de4f426687fbf1",
                  "required_tokens": [
                      "LLM01",
                      "LLM06",
                      "LLM-S0"
                  ]
              },
              "skills-system-governance.md": {
                  "path": "/.cortex/rules/00-core/skills-system-governance.md",
                  "sha256": "f3fbbca5b4516d71139d66610c992bd461a4fdc85c45b840fedc2fe3fb7ce64f",
                  "required_tokens": [
                      "Skills governance",
                      "Structured outputs"
                  ]
              },
              "agentic-phase-policy.md": {
                  "path": "/.cortex/rules/10-flow/agentic-phase-policy.md",
                  "sha256": "753b47a9eaab75105e2da743980280cd5b5f16e63eb29ad003d7b4217e8663e0",
                  "required_tokens": [
                      "PHASE_TRANSITION",
                      "No HITL before REVIEW"
                  ]
              },
              "README.md": {
                  "path": "/.cortex/rules/README.md",
                  "sha256": "ca16ef169da6935ff861a406ca5041ad9d1dbac957bace28a3f49fcb1f73e571",
                  "required_tokens": [
                      "governance",
                      "structure"
                  ]
              },
              "vision.md": {
                  "path": "/.cortex/rules/00-core/vision.md",
                  "sha256": "ee5cbbf7592b3c00ef92e310682bb8ce289aa78e2cd56de173bcb77cc76a492f",
                  "required_tokens": [
                      "Cortex-OS Vision",
                      "North Star"
                  ]
              },
              "TASK_FOLDER_STRUCTURE.md": {
                  "path": "/.cortex/rules/10-flow/TASK_FOLDER_STRUCTURE.md",
                  "sha256": "0fad52db274b60f4f35ed785ef7696c511662fe931024dce5de371d7d4f59ed4",
                  "required_tokens": [
                      "task folder",
                      "structure"
                  ]
              },
              "CODESTYLE.md": {
                  "path": "/CODESTYLE.md",
                  "sha256": "f10d53cd89ad9ff279129c4e357b27c3c9216ffe98055b3b539ce6055de1def2",
                  "required_tokens": [
                      "named exports only",
                      "<= 40 lines per function",
                      "guard clauses"
                  ]
              },
              "SECURITY.md": {
                  "path": "/SECURITY.md",
                  "sha256": "e42c9934307326c19ef9b6483d3742be7522df4b6ae712a1cc5c0c2d2e79177d",
                  "required_tokens": [
                      "Semgrep",
                      "gitleaks",
                      "OSV scan"
                  ]
              }
          }
      }
  - id: governance_maintainers
    file: .cortex/rules/90-infra/governance-maintainers.md
    sha: 91ace01d09b10d30e9607c41b1e55ce1fe0bee0aa2fadb929aa7e5583f465590
    url: https://governance.cortex-os.local/docs/governance-maintainers.md
    full_text: >
      # Governance Maintainers Guide

      **Note:** `/.cortex/rules/90-infra/GOVERNANCE_HASH_UPDATE.md` is retained
      only as a stub pointer back to this guide for compatibility.


      **Status:** Authoritative maintainer documentation  

      **Audience:** Core maintainers updating governance infrastructure  

      **Last Updated:** 2025-11-22


      ---


      ## Purpose


      This document consolidates all governance infrastructure maintenance
      procedures, file purposes, and update workflows for `.cortex/rules/`
      governance system.


      ## Infrastructure Files Overview


      ### governance-index.json


      **Purpose**: Canonical registry of all governance documents with SHA-256
      content hashes


      **Structure**:


      ```json

      {
        "precedence": [
          "/.cortex/rules/00-core/constitution.md",
          "/.cortex/rules/00-core/AGENT_CHARTER.md"
        ],
        "documents": {
          "constitution": {
            "path": "/.cortex/rules/00-core/constitution.md",
            "sha256": "<hash>",
            "lastUpdated": "2025-11-22"
          }
        }
      }

      ```


      ### index.json


      **Purpose**: Legacy global rules index (if different from
      governance-index.json)


      **When to Update**: Maintained for backward compatibility; prefer
      governance-index.json for new references


      ### structure-guard.json


      **Purpose**: File system structure validation rules


      **Contains**:


      - Allowed root entries

      - Required package structure

      - Forbidden patterns


      **When to Update**: When adding new package types or changing repo
      structure


      ### export-freeze.snapshot.json


      **Purpose**: Dependency graph snapshot for import/export validation


      **When to Update**: After significant architectural changes or new package
      additions


      ### dependency-cruiser-memory.cjs


      **Purpose**: Dependency cruiser configuration for memory-related packages


      **When to Update**: When adding new memory/storage packages or changing
      dependency rules


      ## Hash Update Procedure


      ### Quick Start


      ```bash

      # Sync all governance hashes automatically

      pnpm governance:sync-hashes


      # Preview changes without modifying files

      pnpm governance:sync-hashes:dry-run

      ```


      ### What Gets Updated


      The `governance:sync-hashes` script automatically updates:


      1. **`.cortex/rules/governance-index.json`** - Recomputes SHA-256 for all
      documents listed

      2. **`AGENTS.md`** - Updates CHARTER_FRAGMENT SHA reference

      3. **`CLAUDE.md`** - Same updates as AGENTS.md


      ### Manual Hash Generation


      If automation fails:


      ```bash

      # Generate SHA-256 for a specific file

      shasum -a 256 /.cortex/rules/00-core/constitution.md


      # Update governance-index.json manually

      vim .cortex/rules/governance-index.json

      ```


      ### When to Run Hash Sync


      Run `pnpm governance:sync-hashes` after:


      - ‚úÖ Editing any file in `.cortex/rules/`

      - ‚úÖ Adding a new governance document to the index

      - ‚úÖ Moving governance files between directories

      - ‚úÖ Consolidating governance documents


      ### CI Integration


      The `agents-governance.yml` workflow validates:


      - Hash consistency between files and registry

      - Document existence at declared paths

      - Schema compliance for JSON infrastructure files


      ### Troubleshooting


      **Hash Mismatch Errors**:


      1. Check if file was recently edited

      2. Run `pnpm governance:sync-hashes`

      3. Verify no uncommitted changes

      4. Check file encoding (must be UTF-8)


      **Runtime Failures in governance/loader.ts**:


      1. Ensure all paths in governance-index.json are absolute

      2. Verify files exist at declared locations

      3. Check JSON syntax validity


      **Missing CHARTER_FRAGMENT References**:


      1. Ensure AGENTS.md includes SHA-256 reference

      2. Run hash sync to update references

      3. Verify charter waiver workflow if intentionally skipping


      ## Document Lifecycle


      ### Adding New Governance Documents


      1. Create document in appropriate directory (00-core, 10-flow,
      20-checklists, 90-infra)

      2. Add entry to `governance-index.json` precedence array if normative

      3. Run `pnpm governance:sync-hashes`

      4. Update references in related documents

      5. Test CI validation


      ### Consolidating Documents


      1. Merge content into target document

      2. Convert source document to stub with pointer

      3. Update all references to point to new location

      4. Run hash sync

      5. Update documentation and README files


      ### Deprecating Documents


      1. Mark document as deprecated in frontmatter

      2. Add deprecation notice with replacement location

      3. Update governance-index.json to reflect status

      4. Plan removal timeline (minimum 1 release cycle)


      ## Emergency Procedures


      ### Governance System Failure


      If governance validation blocks critical fixes:


      1. Check if waiver workflow is available

      2. Create emergency waiver under `/.cortex/waivers/`

      3. Document incident and resolution plan

      4. Schedule governance fix in next sprint


      ### Hash Corruption


      If hashes become systematically corrupted:


      1. Stop all governance-dependent CI jobs

      2. Regenerate all hashes from source files

      3. Validate against git history

      4. Update governance-index.json atomically

      5. Resume CI after validation


      ## Related Resources


      - **Main Documentation**:
      `/.cortex/rules/10-flow/governance-quickstart.md`

      - **Structure Reference**: `/.cortex/rules/README.md`

      - **CI Workflows**: `.github/workflows/agents-governance.yml`

      - **Hash Sync Script**: `scripts/governance/sync-hashes.js`
  - id: governance_hash_update
    file: .cortex/rules/90-infra/GOVERNANCE_HASH_UPDATE.md
    sha: ""
    url: https://governance.cortex-os.local/docs/GOVERNANCE_HASH_UPDATE.md
    full_text: >
      # Governance Hash Updates ‚Üí governance-maintainers.md


      **Status**: CONSOLIDATED - Content moved to comprehensive maintainer
      guide  

      **New Location**: `/.cortex/rules/90-infra/governance-maintainers.md`  

      **Last Updated**: 2025-11-22


      ---


      ## üìã Documentation Consolidated


      Governance hash update procedures and all infrastructure file management
      have been **merged into** the comprehensive maintainers guide:


      üëâ **See**: `/.cortex/rules/90-infra/governance-maintainers.md`


      This consolidation provides:


      - Complete hash sync procedures

      - Infrastructure file purposes and usage

      - Emergency procedures and troubleshooting

      - Document lifecycle management

      - CI integration guidance

      - ‚úÖ Before committing governance changes

      - ‚úÖ When CI `agents-governance` job fails with hash mismatch errors


      ### Workflow Example


      ```bash

      # 1. Make changes to governance docs

      vim .cortex/rules/CHARTER_FRAGMENT.md


      # 2. Sync hashes

      pnpm governance:sync-hashes


      # Output:

      # [brAInwav] Starting governance hash sync...

      # [brAInwav] Step 1: Updating governance-index.json...

      # [brAInwav] Updating CHARTER_FRAGMENT.md:

      #   Old: b1aad74cf8492c371bb4795e4720496facdbd06f4b6aa23b9a8c3483516c8d87

      #   New: f0887531e0d402b29460c945de4e34c9ee39dbe9a688bcd71646f4a763265bb3

      # [brAInwav] ‚úÖ Updated
      /home/user/Cortex-OS/.cortex/rules/governance-index.json

      # ...

      # [brAInwav] ‚úÖ Governance hash sync complete!


      # 3. Verify hashes are stable (should show "is current")

      pnpm governance:sync-hashes


      # 4. Commit changes

      git add .cortex/rules/ AGENTS.md CLAUDE.md

      git commit -m "docs: update CHARTER_FRAGMENT and sync governance hashes"

      ```


      ## Implementation Details


      ### Script Location


      `scripts/governance/sync-hashes.mjs`


      ### Algorithm


      1. Read `.cortex/rules/governance-index.json`

      2. For each document in the index:
         - Compute actual SHA-256 of the file
         - Compare with hash in index
         - Update index if mismatch found
      3. Extract CHARTER_FRAGMENT hash from updated index

      4. Update `AGENTS.md` with correct hash

      5. Update `CLAUDE.md` with correct hash


      ### Idempotency


      The script is idempotent - running it multiple times with no changes
      produces:


      ```

      [brAInwav] ‚úì CHARTER_FRAGMENT.md hash is current

      [brAInwav] ‚úì agentic-coding-workflow.md hash is current

      ...

      [brAInwav] ‚úì AGENTS.md is current

      [brAInwav] ‚úì CLAUDE.md is current

      ```


      ## Adding New Governance Documents


      ### Step 1: Create the Document


      ```bash

      touch .cortex/rules/my-new-policy.md

      # ... edit the file ...

      ```


      ### Step 2: Add to Governance Index


      Edit `.cortex/rules/governance-index.json`:


      ```json

      {
        "precedence": [
          "CHARTER_FRAGMENT.md",
          "my-new-policy.md",  // Add to precedence list
          ...
        ],
        "docs": {
          ...
          "my-new-policy.md": {
            "path": "/.cortex/rules/my-new-policy.md",
            "sha256": "PLACEHOLDER_WILL_BE_COMPUTED",
            "required_tokens": [
              "policy keyword",
              "required phrase"
            ]
          }
        }
      }

      ```


      ### Step 3: Sync Hashes


      ```bash

      pnpm governance:sync-hashes

      ```


      The script will compute the correct SHA-256 and replace the placeholder.


      ## Troubleshooting


      ### Error: Hash mismatch for CHARTER_FRAGMENT.md


      **Cause:** The file was edited but hashes weren't updated.


      **Solution:**


      ```bash

      pnpm governance:sync-hashes

      ```


      ### Error: Circular dependency in CHARTER_FRAGMENT self-reference


      **Note:** The CHARTER_FRAGMENT.md file contains a self-referencing hash.
      This is **informational only** and is NOT auto-updated to avoid circular
      dependencies. The authoritative hash is in `governance-index.json`.


      ### CI failure: `agents-governance` job


      **Cause:** Committed governance docs without syncing hashes.


      **Solution:**


      ```bash

      pnpm governance:sync-hashes

      git add .cortex/rules/governance-index.json AGENTS.md CLAUDE.md

      git commit --amend --no-edit

      git push --force-with-lease

      ```


      ## Pre-Commit Hook (Recommended)


      Add to `.husky/pre-commit` or use lefthook:


      ```bash

      #!/bin/sh


      # Check if any governance files changed

      if git diff --cached --name-only | grep -q "^.cortex/rules/"; then
        echo "Governance files changed, syncing hashes..."
        pnpm governance:sync-hashes

        # Stage updated files
        git add .cortex/rules/governance-index.json AGENTS.md CLAUDE.md
      fi

      ```


      ## Related Documentation


      - **Governance Index Schema:** `.cortex/rules/governance-index.json`

      - **Loader Implementation:** `packages/agents/src/governance/loader.ts`

      - **CI Enforcement:** `.github/workflows/agents-governance.yml`

      - **Charter Fragment:** `.cortex/rules/CHARTER_FRAGMENT.md`


      ## FAQ


      **Q: Why not just use content without hashes?**

      A: Hashes provide tamper detection and ensures CI validates the exact
      governance rules that agents execute against.


      **Q: Can I manually update hashes?**

      A: Yes, but use `pnpm governance:sync-hashes` - it's faster and
      error-proof.


      **Q: What if `governance-index.json` is missing a document?**

      A: Add the document entry (see "Adding New Governance Documents" above)
      then run the sync script.


      **Q: Does this work with CLAUDE.md?**

      A: Yes! CLAUDE.md is automatically updated alongside AGENTS.md.


      ---


      **Maintainer:** brAInwav Development Team

      **Script:** `scripts/governance/sync-hashes.mjs`

      **Package Script:** `pnpm governance:sync-hashes`
  - id: code_style
    file: CODESTYLE.md
    sha: f10d53cd89ad9ff279129c4e357b27c3c9216ffe98055b3b539ce6055de1def2
    url: https://governance.cortex-os.local/docs/CODESTYLE.md
    full_text: |
      # CODESTYLE.md

      ## Purpose

      This document defines **mandatory coding standards** for the Cortex-OS monorepo.  
      All contributors and automation agents must follow these rules. CI enforces them via Nx targets and checks (Biome, ESLint **v9 flat config**, Ruff, Pyright, Clippy, pytest, mutation testing, Semgrep, supply-chain scanners).  
      **Baselines**: Node **24 Active LTS** (see [ADR 004](./docs/architecture/decisions/004-node-24-active-lts.md)), React **19**, Next.js **15**, Rust **2024 edition** (rustc ‚â• **1.85**).

      ---

      ## 0. brAInwav Production Standards (Hard Prohibitions)

      **ABSOLUTE PROHIBITION** ‚Äî It is a policy violation to ship or describe anything as ‚Äúproduction-ready‚Äù, ‚Äúcomplete‚Äù, ‚Äúoperational‚Äù, or ‚Äúfully implemented‚Äù if any of the following exist anywhere in a production code path:

      - `Math.random()` (or equivalent) used to fabricate data
      - Hard-coded mock responses (e.g., ‚ÄúMock adapter response‚Äù)
      - `TODO`/`FIXME`/`HACK` comments in production paths
      - Placeholder stubs (e.g., ‚Äúwill be wired later‚Äù)
      - Disabled features signaling gaps (e.g., `console.warn("not implemented")`)
      - Fake metrics or synthetic telemetry presented as real

      **Branding & truthfulness**

      - **Apps/binaries/infrastructure services** must include **brAInwav** branding in outputs, **error messages**, and **logs**.  
      - **Shared libraries** SHOULD avoid hard-coded branding; when emitting logs, prefer a structured field `{ brand: "brAInwav" }` passed/injected by the caller.
      - Status claims in UIs, logs, or docs must be **evidence-backed by code** and passing checks.
      - The file `.cortex/rules/RULES_OF_AI.md` is normative; this document complements it.

      **Detection**

      - Pattern guards, AST-Grep, Semgrep, and CI checks fail on violations.
      - Any new exception requires an ADR and a temporary, time-boxed allowlist entry.

      ---

      ## 1. General Principles

      - **Functional-first**: Prefer pure, composable functions. Minimize hidden state and side effects.
      - **Classes**: Only when required by a framework (e.g., React ErrorBoundary) or to encapsulate unavoidable state.
      - **Functions**: ‚â§ 40 lines; split if readability suffers. Prefer guard clauses over deep nesting.
      - **Exports**: Named exports only. No `export default`.
      - **ESM everywhere**: JS/TS packages use `"type": "module"`. Avoid CJS.
      - **Determinism**: No ambient randomness/time in core logic; inject seeds/clocks.
      - **DRY**: Shared logic lives in:
        - `src/lib/` (TypeScript)
        - `apps/cortex-py/lib/` (Python)
        - `crates/common/` (Rust)

      ---

      ## 2. Monorepo Task Orchestration (Nx ‚ÄúSmart‚Äù Mode)

      - Use **smart wrappers** instead of blanket `nx run-many`:
        - `pnpm build:smart`, `pnpm test:smart`, `pnpm lint:smart`, `pnpm typecheck:smart`
        - Dry-run: `--dry-run` prints affected summary and exits.
      - **Non-interactive by default**: `NX_INTERACTIVE=false` (and `CI=true` if unset). Do not forward `--no-interactive` to child tools.
      - Affected detection via `NX_BASE`/`NX_HEAD` or previous commit fallback. If diff cannot be resolved, wrappers explicitly warn and fall back to full run.
      - Emit consistent diagnostics lines:  
        `[nx-smart] target=<t> base=<sha> head=<sha> changed=<n> strategy=affected|all`.

      ---

      ## 3. JavaScript / TypeScript

      **Type discipline**

      - Explicit types at **all public API boundaries** (functions, modules, React props).
      - `strict: true` with `noUncheckedIndexedAccess` and `exactOptionalPropertyTypes`.
      - Prefer `unknown` over `any`. Use `satisfies` for object literal constraint checking.

      **Modules & imports**

      - **ESM only** (`"type": "module"`, `module: "NodeNext"`, `moduleResolution: "NodeNext"`).
      - **JSON imports** use **import attributes** (Node standard):

        ```ts
        import data from "./foo.json" with { type: "json" };
        ```

      - TS compiler options MUST include:
        - `"verbatimModuleSyntax": true` (preserve type-only imports/exports)
        - `"moduleDetection": "force"` (treat files as modules unless proven otherwise)

      **Async & cancellation**

      - Prefer `async/await`. Avoid deep `.then()` chains.
      - Support **cancellation** via `AbortSignal` for all I/O and long-running operations.

      **Errors**

      - Guard-clause style; propagate context-rich errors (include operation, inputs, correlation id).
      - Never swallow errors; route to the logging layer (see ¬ß12).

      **Style & linting**

      - **Biome** is the **formatter** and the default for everyday linting. Do **not** use Prettier.
      - **ESLint ‚â• 9 (flat config)** is required for **policy/architecture/security** rules (e.g., boundaries, security plugins).  
        Maintain a single `eslint.config.js` per package; avoid duplicate rule coverage with Biome.
      - Migrate any legacy `.eslintrc*` to flat config.

      **Testing**

      - Co-located tests in `__tests__` or `*.test.ts`.
      - **Vitest** is the default for browser/RSC/client-side and rich mocking.
      - The **Node.js built-in test runner** is allowed for small, pure Node libs (no browser/RSC).
      - Snapshots only for intentionally stable serialized outputs (avoid DOM tree snapshots).

      **Security**

      - No `eval`/dynamic Function. No unpinned remote code. Validate/sanitize all external inputs.

      **MLX rule**

      - All MLX integrations must be real; no mocks/placeholders in production code.

      ---

      ## 3.1. TypeScript Project Configuration (brAInwav Standards)

      **Purpose**: Standardized TypeScript configuration across all packages to ensure build consistency, enable incremental compilation, and support project references.

      **Templates**: Available in `.cortex/templates/tsconfig/`

      - `tsconfig.lib.json` - Standard library configuration
      - `tsconfig.spec.json` - Test configuration  
      - `README.md` - Complete usage documentation

      ### Required Configuration Fields

      All buildable TypeScript packages MUST have:

      ```json
      {
        "extends": "../../tsconfig.base.json",
        "compilerOptions": {
          "composite": true,
          "outDir": "dist",
          "noEmit": false,
          "module": "NodeNext",
          "moduleResolution": "NodeNext",
          "verbatimModuleSyntax": true,
          "moduleDetection": "force",
          "noUncheckedIndexedAccess": true,
          "exactOptionalPropertyTypes": true
        },
        "include": ["src/**/*"],
        "exclude": [
          "dist",
          "node_modules",
          "**/*.test.ts",
          "**/*.spec.ts",
          "tests/**/*"
        ]
      }
      ```

      ### Test Configuration Separation

      Packages with test files SHOULD use separate `tsconfig.spec.json`:

      ```json
      {
        "extends": "./tsconfig.json",
        "compilerOptions": {
          "outDir": "dist-spec",
          "composite": false,
          "noEmit": true,
          "types": ["vitest/globals", "node"]
        },
        "include": [
          "tests/**/*",
          "src/**/*.test.ts",
          "src/**/*.spec.ts"
        ]
      }
      ```

      ### rootDir Guidelines

      - **Default**: Omit `rootDir` - TypeScript infers correctly.
      - **Use ONLY when**: Output structure must match specific entry point expectations.
        - Example: `"start": "node dist/server.js"` requires `"rootDir": "src"`.
      - **Never**: Set `rootDir` that conflicts with `include` patterns.

      ### Creating New Packages

      ```bash
      # 1. Copy template
      cp .cortex/templates/tsconfig/tsconfig.lib.json packages/my-package/tsconfig.json

      # 2. Adjust extends path (match your package depth)
      # packages/my-package/ ‚Üí "../../tsconfig.base.json"
      # packages/services/my-package/ ‚Üí "../../../tsconfig.base.json"

      # 3. Add test config if needed
      cp .cortex/templates/tsconfig/tsconfig.spec.json packages/my-package/

      # 4. Verify
      cd packages/my-package
      pnpm build
      pnpm typecheck
      ```

      ### Migrating Existing Packages

      ```bash
      # Preview changes
      pnpm tsx scripts/migrate-tsconfig.ts --dry-run

      # Apply to all packages
      pnpm tsx scripts/migrate-tsconfig.ts --apply

      # Apply to single package
      pnpm tsx scripts/migrate-tsconfig.ts --apply --package packages/my-pkg
      ```

      ### Validation

      ```bash
      # Structure validation (includes tsconfig checks)
      pnpm structure:validate

      # Test Phase 2 compliance
      pnpm vitest run tests/scripts/typescript-templates.test.ts
      ```

      ### Common Errors & Solutions

      See `docs/troubleshooting/typescript-config.md` for:

      - TS6059: File not under rootDir
      - TS5056: File would be overwritten
      - TS6307: File not in project references
      - Missing composite flag issues

      ### Phase Implementation Status

      - ‚úÖ Phase 1: Local tsconfig correctness (Complete)
      - ‚úÖ Phase 2: Templates & migration (Complete)
      - ‚¨ú Phase 3: Project references (Future - enables cross-package compilation)

      ---

      ## 4. React / Next.js

      - **Baselines**: **React 19** and **Next.js 15**.
      - **Component roles**
        - Containers: fetch, state, mutations.
        - Presentational children: pure and stateless.
        - List containers separate from stateless items; use keys and virtualize when needed.
      - **React Server Components (RSC)**
        - Default to **Server Components**. Mark client code with `"use client"`.
        - Use `use server` for server actions. Keep client components thin.
      - **Async UI states**
        - Use **Suspense** and **Error Boundaries**. Every async surface must render: Loading, Error (with retry), Empty, Success.
      - **Accessibility**
        - WCAG **2.2 AA** baseline.
        - Proper roles/labels for all interactive elements.
        - Full keyboard navigation and visible focus. Never rely on color alone.

      ---

      ## 5. Python (uv-managed)

      - **Identifiers**: `snake_case` (funcs/vars), `PascalCase` (classes).
      - **Types**: Required on all public functions. Enforce with **Pyright** (`strict`).
      - **Lint/format**: **Ruff** (`ruff check --fix` + `ruff format`) is mandatory.
      - **Packaging**: Each app has `pyproject.toml` and `uv.lock`. Use `uv` for sync/run.
      - **Imports**: Absolute imports only.
      - **Testing**: `pytest` suite participates in repo quality gates (see ¬ß10). Aim for high branch coverage per package; release-readiness gates may require ‚â•95%.

      ---

      ## 6. Rust (TUI/CLI only)

      - **Edition**: Pin to **Rust 2024**.
      - **Minimum toolchain**: `rustc 1.85.0` (pin via `rust-toolchain.toml`).
      - **Style & lints**: `rustfmt` + `cargo clippy -- -D warnings` (CI fails on warnings).
      - **Errors**: CLI binaries use `anyhow::Result`; libraries expose structured enums (e.g., `thiserror`).
      - **UI**: `ratatui`/`crossterm`. Provide ASCII fallback; never color-only indicators.
      - **Modules**: < 500 LOC; extract shared logic into crates.
      - **Testing**: Unit tests alongside modules; integration tests under `tests/`.

      ---

      ## 7. Naming Conventions

      - **Directories & files**: `kebab-case`
      - **Variables & functions**: `camelCase` (JS/TS), `snake_case` (Python/Rust)
      - **Types & components**: `PascalCase`
      - **Constants**: `UPPER_SNAKE_CASE`

      ---

      ## 8. Commit, Releases, ADRs

      - **Commits**: Conventional Commits (`feat:`, `fix:`, `refactor:`, `chore:`, `test:`, etc.).
      - **Signing**: All commits/tags are signed (GPG/SSH or Sigstore **Gitsign** in CI).
      - **Releases**: SemVer; changelogs generated (Changesets/Nx release).
      - **ADRs**: Required for significant decisions; store under `docs/adr/` (MADR template).

      ---

      ## 9. Toolchain & Lockfiles

      - **Node**: **24 Active LTS** pinned in `.mise.toml` (see [ADR 004](./docs/architecture/decisions/004-node-24-active-lts.md)).
      - **Mise** (`.mise.toml`) pins Node, Python, uv, Rust, and other tool versions.
      - **Package manager**: **pnpm** (single repo-wide choice).
      - **Corepack** manages pnpm version; Bun is not used.
      - **Lockfiles**: Only **`pnpm-lock.yaml`** exists in the repo.
      - **Frozen installs**
        - Node: `pnpm install --frozen-lockfile`
        - Python: `uv sync --frozen`
        - Rust: `cargo build --locked`

      ---

      ## 10. Quality Gates: Coverage, Mutation, TDD

      **PR Merge Gate (must pass)**

      - Branch coverage ‚â• **65%** (`BRANCH_MIN` env override)
      - Mutation score ‚â• **75%** (`MUTATION_MIN` env override)

      **Aspirational baselines (Vitest config)**

      - Statements 90% ‚Ä¢ Branches 90% ‚Ä¢ Functions 90% ‚Ä¢ Lines 95%

      **Readiness workflows**

      - Package-level release readiness may enforce **‚â•95%** coverage (per workflow policy).

      **Mutation testing**

      - Use **Stryker** for JS/TS. Enforce `MUTATION_MIN` in CI; produce badges/metrics.

      **TDD enforcement**

      - Use the **TDD Coach** package:
        - Dev watch for feedback
        - Pre-commit validation for staged files
        - CI status check blocks non-compliant PRs

      ---

      ## 11. Automation & Agent-Toolkit (MANDATORY for agents)

      - Agents and automation **must** use `packages/agent-toolkit` for:
        - Code search (`multiSearch`) instead of raw `grep/rg`
        - Structural refactors/codemods
        - Cross-language validation and pre-commit checks
      - Shell ‚ÄúJust‚Äù recipes are canonical entry points:
        - `just scout "<pattern>" <path>`
        - `just codemod 'find(:[x])' 'replace(:[x])' <path>`
        - `just verify changed.txt`
      - Architecture: contract-first (Zod), event-driven, MCP compatible, layered design.

      ---

      ## 12. Security, Supply Chain & Compliance

      - **Dependencies**: Lockfile is the source of truth; no ad-hoc CI upgrades.
      - **Secrets**: Never hard-code. Use env injection/secret manager. Prevent client bundle leaks.
      - **Scanning per PR**
        - Vulnerabilities: OSV-Scanner, `pnpm audit`, `pip-audit`, `cargo audit`
        - Licenses: ScanCode/ORT (SPDX allowlist)
        - Static analysis: **Semgrep** (OWASP + LLM + project rules)
        - Structural policies: AST-Grep + pattern guard
      - **SBOMs**: Generate **CycloneDX** per artifact (containers, packages) at release.
      - **Provenance & signing**
        - Produce **SLSA 1.0** provenance (in-toto attestations) for build artifacts.
        - Sign/verify with **Sigstore Cosign**; enforce admission policy where applicable.
        - **GitHub Artifact Attestations** MUST be published and verified for release artifacts.
        - Commits/tags signed (see ¬ß8).
      - **Containers**
        - Minimal, pinned base images (distroless where possible), non-root, read-only FS, drop caps.

      ---

      ## 13. AI/ML Engineering

      - **Transparency**
        - Ship a **Model Card** and **Eval report** with each model.
        - Datasets require **Datasheets for Datasets** (lineage, consent, restrictions).

      - **Reproducibility**
        - Fixed seeds, hashed datasets, versioned configs, recorded training/inference params.

      - **Evaluations**
        - Maintain an eval harness: task metrics, safety/abuse tests, bias probes. Regressions block merges.

      - **Governance & compliance**
        - Maintain an AI risk register aligned with **NIST AI RMF** and **ISO/IEC 23894**.
        - Track **AI Management System** controls per **ISO/IEC 42001**.
        - Align with **EU AI Act** timelines (see Appendix A).

      - **Privacy**
        - No PII ingestion without legal basis/DPA. Apply minimization and irreversible de-identification where possible.

      ---

      ## 14. Governance Lint Policies (Semgrep + ESLint)

      | Rule ID | Source | Summary | Charter linkage |
      | --- | --- | --- | --- |
      | `no-dotenv-in-prod` | `semgrep/brAInwav.yml` | Blocks `dotenv.config()` in prod paths; require shared loader. | Guardrail #9 (preflight secrets) + G4 env discipline |
      | `no-console-in-prod` | `semgrep/brAInwav.yml` + ESLint `no-console` override | Forces `traceLogger.log()` with branded payload + `trace_id`. | Guardrail #6 (brand logs) + trace context |
      | `no-math-random-in-prod` | `semgrep/brAInwav.yml` | Prevents fabricated data/entropy. | Guardrail #6 & Proof integrity |
      | `require-brainwav-brand-in-logs` | `semgrep/brAInwav.yml` | Ensures `{ brand:"brAInwav" }` attached to logs. | Guardrail #6 |
      | `async-must-accept-abortsignal` | `semgrep/brAInwav.yml` | Exported async APIs require `AbortSignal`. | Guardrail #7 (Arc Protocol resilience) |
      | `strict-boundaries-no-any` | `semgrep/brAInwav.yml` + ESLint `@typescript-eslint/no-explicit-any` | No `any` at public boundaries. | Guardrail #4 (Proof) |
      | `max-lines-per-function` | ESLint `max-lines-per-function` | Functions ‚â§ 40 LOC; split arcs early. | Guardrail #7 |
      | `import/no-default-export` | ESLint | Enforces named exports only. | Guardrail #4 (Proof traceability) |
      | `no-restricted-imports` | ESLint | Blocks cross-domain imports; require interfaces. | Guardrail #7 |

      - **Local reproduction:** `pnpm lint:smart` (ESLint) and `pnpm dlx semgrep --config semgrep/brAInwav.yml`.
      - **Waivers:** Submit a Maintainer-approved waiver with rule ID, scope, expiry (‚â§7 days), and mitigation. Reference waiver in PR body and task manifest.
      - **Waiver Activation Rule:** A charter waiver is valid only after the `charter-enforce / danger` job posts ‚úÖ with a link to the `Apply Waiver` workflow run that recorded Maintainer approval.
      - **CI integration:** `charter-enforce` runs both tools; any ERROR result blocks merge and triggers `blocked:charter` until resolved.

      ---

      ## 14. Accessibility

      - **Baseline**: WCAG **2.2 AA**.
      - **Keyboard**: Full operation via keyboard; document shortcuts.
      - **Screen readers**: Semantic HTML first; ARIA only where necessary.
      - **CLI/TUI**: `--plain`/`--no-color` modes for AT compatibility.

      ---

      ## 15. Observability, Logging & Streaming

      - **OpenTelemetry**: Instrument services/CLIs to emit OTLP **traces, metrics, and logs** (Logs Data Model ‚Äústable‚Äù). Correlate request IDs end-to-end.
      - **brAInwav logging**
        - Structured logs SHOULD include `brand: "brAInwav"` at app/service boundaries; libraries inherit caller context.
        - Log levels: `error`, `warn`, `info`, `debug`, `trace` only.
      - **Performance budgets**: Define bundle/time/memory budgets per app. Fail CI if exceeded.
      - **Streaming modes (CLI)**
        - Default: token delta streaming to stdout.
        - `--aggregate` for aggregated final output.
        - Force token streaming: `--no-aggregate`.
        - JSON event streaming: `--json` or `--stream-json` (`delta`, `item`, `completed` events).
        - Precedence: **CLI flag > env (`CORTEX_STREAM_MODE`) > config > internal default**.

      ---

      ## 16. Resource Management & Memory Discipline

      - Respect active mitigations until baseline is declared stable:
        - pnpm: `childConcurrency: 2`, engine pinning, `engineStrict: true`
        - Nx: serialized heavy tasks (`parallel: 1`, `maxParallel: 1`)
        - `.nxignore` reduces watcher churn
      - Use `scripts/sample-memory.mjs` to record RSS/heap during heavy ops.
      - Before increasing parallelism, run comparative sampler sessions (before/after) and attach results to the PR.

      ---

      ## 17. Repository Scripts & Reports

      - **Codemap snapshots**
        - `pnpm codemap` runs `scripts/codemap.py` and emits `out/codemap.json` + `out/codemap.md` with **brAInwav-branded** output.
        - Optional tools (`lizard`, `madge`, `depcheck`) annotate results under `analysis` without failing if missing.
        - Scopes: `repo`, `package:<name>`, `app:<name>`, `path:<relative>`.
      - **Badges & metrics**
        - Coverage and mutation badges are static SVGs under `reports/badges/`.
        - Inline sparkline is injected between `BRANCH_TREND_INLINE_START/END` markers via `pnpm sparkline:inline`.
        - `reports/badges/metrics.json` carries composite metrics for GitHub Pages or API use.

      ---

      ## 18. MCP & External Tools

      - MCP adapters and developer helpers must not hard-code user-specific paths.
      - Use `tools/mcp/wrap_local_memory.sh` and `tools/mcp/check_mcp_paths.sh` for local reproducibility.
      - Expose MCP endpoints via the documented ports/tunnels; health checks must be scriptable.

      ---

      ## 19. Config References (Authoritative)

      - **Biome**: `.biome.json` (root; packages may extend)
      - **ESLint**: `eslint.config.js` (flat config) for policy/security/import-boundaries rules
      - **TSConfig**: `tsconfig.base.json` (project references enabled)
      - **Python**: `pyproject.toml` + `uv.lock` (Ruff/Pyright config)
      - **Rust**: `rustfmt.toml` + Clippy in CI; **rust-toolchain.toml** pins `channel = "1.85.0"`
      - **Mise**: `.mise.toml` pins tool versions (Node 24 Active LTS, Python, uv, Rust; per [ADR-004](./docs/architecture/decisions/004-node-24-active-lts.md))
      - **CI**: `.github/workflows/*.yml` enforce gates (quality, security, supply chain, badges)
      - **ADRs**: `docs/adr/` (MADR template)
      - **brAInwav Rules**: `.cortex/rules/RULES_OF_AI.md` (primary production standards)

      ---

      ## Appendix A ‚Äî EU AI Act (dates for governance)

      - **Act in force**: 1 Aug 2024
      - **GPAI/foundation-model obligations applicable**: **2 Aug 2025**
      - **Most provisions fully applicable**: 2 Aug 2026
      - **GPAI Code of Practice**: 10 Jul 2025 (voluntary; treated as best practice here)

      ---

      ## Appendix B ‚Äî Policy Automation (Semgrep & ESLint)

      - **Semgrep rule catalog**: See `semgrep/brAInwav.yml` (rules defined in [`security/semgrep/packs/brainwav-custom.yml`](security/semgrep/packs/brainwav-custom.yml)). These rules block `child_process.exec*` shell spawns, `NODE_TLS_REJECT_UNAUTHORIZED=0`, and AbortSignal gaps via `brainwav.async.fetch-missing-abort-signal`, `brainwav.async.fetch-options-missing-abort-signal`, `brainwav.async.axios-missing-cancellation`, and `brainwav.async.axios-options-missing-cancellation`.
      - **Testing/validation**: Regression tests live in [`security/semgrep/tests/abort-signal`](security/semgrep/tests/abort-signal) and run with `semgrep --test security/semgrep/packs/brainwav-custom.yml`.
      - **Exemption criteria**: Helper factories that already inject `signal` are exempt because the rules only match object literals.
      - **Waiver process**: Request waivers via `/.cortex/waivers/` with Maintainer approval.
      - **Legacy ESLint profile** ‚Äî [`.eslintrc.cjs`](./.eslintrc.cjs) enforces the 40-line ceiling (`max-lines-per-function`), naming conventions, and cross-domain import guards; overrides live in per-package `eslint.config.js` fragments and require a documented waiver before relaxing.
      - **Flat ESLint config** ‚Äî [`eslint.config.js`](./eslint.config.js) layers SonarJS + `typescript-eslint` async safety checks; together with the `AbortSignal` mandate in ¬ß3 and the `scripts/ensure-eslint-flat-config.mjs` guard (runs before `pnpm lint:smart` and emits `reports/policy/flat-config-guard.json`), this is how CI verifies cancellation-ready async boundaries. Adjustments also flow through the waiver process above.
  - id: security
    file: SECURITY.md
    sha: e42c9934307326c19ef9b6483d3742be7522df4b6ae712a1cc5c0c2d2e79177d
    url: https://governance.cortex-os.local/docs/SECURITY.md
    full_text: |
      <!--
      file_path: "SECURITY.md"
      description: "Cortex-OS security policy and vulnerability reporting guide"
      maintainer: "@jamiescottcraik"
      last_updated: "2025-11-18"
      version: "1.2.0"
      status: "governance"
      license: "Apache 2.0"
      -->

      # Security Policy

      [![Vulnerability Reporting](https://img.shields.io/badge/vulnerability-reporting-available-blue.svg)](#-reporting-vulnerabilities)

      **Security-First AI Agent Development Platform**
      _We take security seriously and appreciate responsible disclosure of vulnerabilities_

      ---

      ## üõ°Ô∏è Security Overview

      Cortex-OS is built with security as a fundamental principle. Our Autonomous Software Behavior Reasoning (ASBR) runtime implements
      comprehensive security measures to protect against common vulnerabilities and emerging AI/ML specific threats.

      ### Security Frameworks We Follow

      - **üîí OWASP Top-10 2021** - Web application security standards
      - **ü§ñ OWASP LLM Top-10** - AI/ML specific security guidelines
      - **üéØ MITRE ATLAS** - Adversarial Threat Landscape for Artificial-Intelligence Systems
      - **üåê NIST Cybersecurity Framework** - Risk management and security controls
      - **üîê SPIFFE/SPIRE** - Secure Production Identity Framework

      ### Supported Versions

      Only the latest Cortex-OS release branch (and the `main` branch that feeds it) receives security fixes. If you are running an
      older tag or fork, please upgrade before filing vulnerability reports so we can reproduce the issue in a supported build.

      ### Threat Model Focus Areas

      - **Prompt / Task Injection** ‚Äì Malicious prompts, manifests, or research notes could attempt to override guardrails. Core agents
        use immutable system prompts, phase gates, and schema validation to block unsanctioned mutations.
      - **Tool Misuse** ‚Äì Cortex-OS limits what executors can run by default (no shell access from oversight agents, tool allowlists,
        environment capability flags) and audits every tool call through Evidence Triplets.
      - **Data Leakage** ‚Äì When connectors or LLM providers are enabled, prompts may leave your environment. Do not send regulated data
        unless you control the upstream provider; disable `vibe_learn`/memory sync if logs must stay local.
      - **Package / Service Impersonation** ‚Äì Deploy only from this repository or the signed release artifacts. Verify tunnel
        configurations and LaunchAgents before loading external MCP servers.

      ### Prompt Security Controls

      Cortex-OS implements comprehensive prompt security through structured schemas and explicit boundaries:

      #### Determinism Controls

      All system prompts include determinism controls that ensure consistent, predictable agent behavior:

      - **Structured Output Schemas** ‚Äì Every prompt specifies output format (JSON/XML/Markdown), required fields, and sections
      - **Confidence Calibration** ‚Äì Thresholds for uncertainty (low: 0.3, high: 0.7) with explicit prefixes for low-confidence outputs
      - **Boundary Conditions** ‚Äì Explicit refuse/escalate/require_approval lists for each prompt
      - **Tool Affinity** ‚Äì Prompts declare which tools they commonly invoke, enabling validation

      ```typescript
      // Example: Prompt with security controls
      {
        id: 'sys.n0-master',
        outputSchema: {
          type: 'structured',
          format: 'xml',
          sections: ['reasoning', 'action', 'next_steps'],
        },
        boundaries: {
          refuse: ['operations outside allow-list', 'budget overruns'],
          escalate: ['security-sensitive operations', 'destructive actions'],
        },
        confidenceCalibration: {
          low_threshold: 0.3,
          high_threshold: 0.7,
          uncertainty_prefix: 'UNCERTAIN: ',
        },
      }
      ```

      #### Security Prompts

      Dedicated system prompts enforce security at multiple layers:

      | Prompt ID | Purpose | Security Function |
      |-----------|---------|-------------------|
      | `sys.governance.compliance-checker` | Pre-action compliance | Verifies Evidence Triplet, vibe-check, SBOM, license validation before execution |
      | `sys.router.tool-selection` | Tool routing | Decision tree prevents unauthorized tool access; requires 2+ alternatives considered |
      | `sys.resilience.error-recovery` | Error handling | Controlled fallback chains; prevents uncontrolled error propagation |
      | `sys.memory.contextualize` | Memory integration | Relevance scoring prevents irrelevant/stale context injection |
      | `sys.research.synthesizer` | Research synthesis | License validation (SAFE/REVIEW/BLOCKED); excludes blocked sources |

      #### Risk Classification

      All prompts are classified by risk level (L1-L4):

      - **L1 (Read-only)** ‚Äì Proceed without approval
      - **L2 (Write, internal)** ‚Äì Log and proceed
      - **L3 (External network)** ‚Äì Require explicit approval
      - **L4 (Destructive/irreversible)** ‚Äì Block and escalate

      #### Banned Phrases

      The prompt validation system automatically rejects templates containing:
      - `\bDAN\b` ‚Äì Jailbreak attempts
      - `ignore previous` ‚Äì Prompt injection attempts

      ## üö® Reporting Vulnerabilities

      ### How to Report

      **‚ö†Ô∏è CRITICAL: DO NOT create public GitHub issues for security vulnerabilities.**

      Instead, please report security vulnerabilities through our secure channels:

      #### Primary Contact

      - **Private advisory via GitHub**: [Submit a private report](https://github.com/cortex-os/cortex-os/security/advisories/new) (requires GitHub login; preferred).
      - **Email**: <security@cortex-os.dev>  
        Subject line: `[SECURITY] <short summary>`  
        Optional PGP: request the current key via email while the public key is being rotated.

      #### Alternative Contacts

      - **Security Team Lead**: <jscraik@brainwav.io>
      - **Emergency (24/7)**: Use the email contacts above with subject prefix `[URGENT]`. Voice hotlines are not currently operated for initial disclosure.

      ### What to Include in Your Report

      Please provide as much detail as possible:

      ```markdown
      ## Vulnerability Summary

      Brief description of the vulnerability and its potential impact.

      ## Affected Components

      - Package/module name and version
      - Specific files or functions affected
      - Operating system and environment details

      ## Vulnerability Details

      ### Type

      - [ ] SQL Injection
      - [ ] Cross-Site Scripting (XSS)
      - [ ] Cross-Site Request Forgery (CSRF)
      - [ ] Authentication Bypass
      - [ ] Authorization Issues
      - [ ] Information Disclosure
      - [ ] Prompt Injection (AI/ML specific)
      - [ ] Model Extraction (AI/ML specific)
      - [ ] Data Poisoning (AI/ML specific)
      - [ ] Other: ******\_\_\_******

      ### Severity Assessment

      - [ ] Critical (9.0-10.0 CVSS)
      - [ ] High (7.0-8.9 CVSS)
      - [ ] Medium (4.0-6.9 CVSS)
      - [ ] Low (0.1-3.9 CVSS)

      ### Proof of Concept

      Provide step-by-step reproduction instructions:

      1. Environment setup
      2. Steps to reproduce
      3. Expected vs actual behavior
      4. Screenshots or video (if applicable)

      ### Impact Assessment

      - Data at risk
      - Systems affected
      - Potential for escalation
      - Business impact

      ### Suggested Remediation

      If you have ideas for fixes, please include them.
      ```

      - **PGP Key**: We rotate keys annually. Request the active key via <security@cortex-os.dev> until the new public block is published in this document.

      ## ‚è±Ô∏è Response Timeline

      We are committed to responding promptly to security reports:

      | Timeline            | Action                                              |
      | ------------------- | --------------------------------------------------- |
      | **Within 72 hours** | Initial acknowledgment of your report               |
      | **Within 1 week**   | Preliminary assessment and severity classification  |
      | **Within 2 weeks**  | Detailed investigation results and remediation plan |
      | **Within 30 days**  | Fix implementation and testing (for most issues)    |
      | **Within 45 days**  | Public disclosure (coordinated with reporter)       |

      ## üîç Automated Dependency Scanning

      - **pnpm audit** ‚Äì Enforced in CI at the `high` threshold; moderate findings are logged for follow-up via `tools/security/triage-audit.mjs`.
      - **Snyk CLI** ‚Äì Optional step in `.github/workflows/security.yml` (requires `SNYK_TOKEN`) that runs `snyk test`/`snyk monitor` against `pnpm-lock.yaml` and stores JSON artifacts.
      - **Custom scanners** ‚Äì `tools/security/scan-tar-deps.mjs` inspects `pnpm-lock.yaml` for tar extractor usage and queries OSV for known vulnerabilities.

      Artifacts from these scanners are uploaded as `dependency-security-reports` for reviewers, and remediation expectations are defined in `docs/security/policies/dependency-vulnerability-management.md`.

      ### Critical Vulnerabilities

      For critical vulnerabilities (CVSS 9.0+), we aim to:

      - Acknowledge within 24 hours
      - Provide initial assessment within 48 hours
      - Deploy emergency fixes within 1 week

      ## üîí Supported Versions

      We provide security updates for the following versions:

      | Version | Supported              | End of Support |
      | ------- | ---------------------- | -------------- |
      | 2.x.x   | ‚úÖ Active              | TBD            |
      | 1.5.x   | ‚úÖ Active              | 2025-12-31     |
      | 1.4.x   | ‚ö†Ô∏è Limited             | 2025-06-30     |
      | < 1.4   | ‚ùå No longer supported | 2024-12-31     |

      ### Support Levels

      - **‚úÖ Active**: Full security updates and patches
      - **‚ö†Ô∏è Limited**: Critical security fixes only
      - **‚ùå Unsupported**: No security updates provided

      ## üõ°Ô∏è Security Architecture

      ### Core Security Principles

      #### 1. Defense in Depth

      - **Input Validation**: All inputs validated using Zod schemas
      - **Authentication**: Multi-factor authentication support
      - **Authorization**: Role-based access control (RBAC)
      - **Encryption**: End-to-end encryption for sensitive data
      - **Monitoring**: Comprehensive security event logging

      #### 2. Secure Development Lifecycle

      - **Static Analysis**: Automated security scanning with Semgrep
      - **Dynamic Analysis**: Runtime security monitoring
      - **Dependency Scanning**: Automated vulnerability detection in dependencies
      - **Allowlist Maintenance**: Follow the [npm audit allowlist process](docs/security/dependency-guidelines.md) for vetted exceptions
      - **Security Testing**: Dedicated security test suites
      - **Code Review**: Security-focused code reviews

      #### 3. AI/ML Security Specific

      - **Prompt Injection Prevention**: Input sanitization and validation
      - **Model Security**: Secure model loading and execution
      - **Data Privacy**: PII detection and anonymization
      - **Bias Detection**: Automated bias testing in AI outputs
      - **Rate Limiting**: Protection against model abuse

      ### Security Controls Implementation

      #### Authentication & Authorization

      ```typescript
      // Example: Secure authentication implementation
      const authConfig = {
        providers: ['oauth2', 'saml', 'oidc'],
        mfa: {
          required: true,
          methods: ['totp', 'sms', 'hardware-key'],
        },
        sessionManagement: {
          timeout: 3600, // 1 hour
          refreshToken: true,
          secureFlags: true,
        },
      };
      ```

      #### Input Validation

      ```typescript
      // Example: Comprehensive input validation
      const UserInputSchema = z.object({
        query: z
          .string()
          .min(1)
          .max(1000)
          .regex(/^[a-zA-Z0-9\s\-_.,!?]+$/, 'Invalid characters')
          .refine((val) => !containsSqlInjection(val), 'Potential SQL injection')
          .refine((val) => !containsScriptTags(val), 'Script tags not allowed'),

        options: z
          .object({
            format: z.enum(['json', 'xml', 'yaml']),
            maxResults: z.number().min(1).max(100),
          })
          .optional(),
      });
      ```

      #### Secure Communication

      ```typescript
      // Example: Secure A2A communication
      const secureTransport = createA2ATransport({
        type: 'https',
        endpoint: 'https://secure-endpoint.cortex-os.dev',
        tls: {
          minVersion: 'TLSv1.3',
          cipherSuites: ['TLS_AES_256_GCM_SHA384'],
          certificateValidation: 'strict',
        },
        authentication: {
          type: 'mTLS',
          clientCert: './certs/client.crt',
          clientKey: './certs/client.key',
          caCert: './certs/ca.crt',
        },
      });
      ```

      ## üîç Security Testing

      ### Automated Security Scanning

      We use multiple layers of automated security scanning:

      #### Static Application Security Testing (SAST)

      ```bash
      # Semgrep security scanning
      pnpm security:scan                  # OWASP precise rules
      pnpm security:scan:comprehensive    # All security rulesets
      pnpm security:scan:llm              # LLM-specific rules
      pnpm security:scan:atlas            # MITRE ATLAS rules
      ```

      #### Dynamic Application Security Testing (DAST)

      - Runtime security monitoring
      - Penetration testing (automated and manual)
      - API security testing
      - Container security scanning

      #### Dependency Scanning

      ```bash
      # Dependency vulnerability scanning
      pnpm audit
      pnpm deps:scan
      npm audit --audit-level=high
      ```

      #### AI/ML Security Testing

      ```bash
      # LLM-specific security testing
      pnpm test:llm-security
      pnpm test:prompt-injection
      pnpm test:model-extraction
      pnpm test:bias-detection
      ```

      ### Manual Security Testing

      Our security team conducts regular manual testing:

      - **Penetration Testing**: Quarterly external penetration tests
      - **Code Review**: Security-focused code reviews for all changes
      - **Architecture Review**: Security architecture assessments
      - **Red Team Exercises**: Simulated attack scenarios

      ## üõ°Ô∏è OWASP Compliance

      ### OWASP Top-10 2021 Compliance

      | Risk                                 | Status       | Implementation                                        |
      | ------------------------------------ | ------------ | ----------------------------------------------------- |
      | **A01: Broken Access Control**       | ‚úÖ Compliant | RBAC, session management, API authorization           |
      | **A02: Cryptographic Failures**      | ‚úÖ Compliant | Strong encryption, secure key management              |
      | **A03: Injection**                   | ‚úÖ Compliant | Input validation, parameterized queries, sanitization |
      | **A04: Insecure Design**             | ‚úÖ Compliant | Secure architecture, threat modeling                  |
      | **A05: Security Misconfiguration**   | ‚úÖ Compliant | Secure defaults, configuration management             |
      | **A06: Vulnerable Components**       | ‚úÖ Compliant | Dependency scanning, regular updates                  |
      | **A07: Authentication Failures**     | ‚úÖ Compliant | MFA, secure session management                        |
      | **A08: Software Integrity Failures** | ‚úÖ Compliant | CI/CD security, code signing                          |
      | **A09: Logging & Monitoring**        | ‚úÖ Compliant | Comprehensive audit logging                           |
      | **A10: Server-Side Request Forgery** | ‚úÖ Compliant | URL validation, network segmentation                  |

      ### OWASP LLM Top-10 Compliance

      | Risk                                        | Status       | Implementation                        |
      | ------------------------------------------- | ------------ | ------------------------------------- |
      | **LLM01: Prompt Injection**                 | ‚úÖ Compliant | Input sanitization, prompt validation |
      | **LLM02: Insecure Output Handling**         | ‚úÖ Compliant | Output validation, encoding           |
      | **LLM03: Training Data Poisoning**          | ‚úÖ Compliant | Data validation, provenance tracking  |
      | **LLM04: Model Denial of Service**          | ‚úÖ Compliant | Rate limiting, resource controls      |
      | **LLM05: Supply Chain Vulnerabilities**     | ‚úÖ Compliant | Model validation, dependency scanning |
      | **LLM06: Sensitive Information Disclosure** | ‚úÖ Compliant | PII detection, data anonymization     |
      | **LLM07: Insecure Plugin Design**           | ‚úÖ Compliant | Plugin sandboxing, validation         |
      | **LLM08: Excessive Agency**                 | ‚úÖ Compliant | Capability boundaries, authorization  |
      | **LLM09: Overreliance**                     | ‚úÖ Compliant | Human oversight, confidence scoring   |
      | **LLM10: Model Theft**                      | ‚úÖ Compliant | Access controls, model protection     |

      ### OWASP ASVS 4.0.3 Alignment

      | Verification Requirement                      | L1 | L2 | L3 | Implementation Highlights |
      | --------------------------------------------- | -- | -- | -- | ------------------------- |
      | **V1 Architecture & Threat Modeling**         | ‚úÖ | ‚úÖ | ‚ö†Ô∏è | Zero-trust reviews, MITRE ATLAS scenarios, design ADRs |
      | **V2 Authentication**                         | ‚úÖ | ‚úÖ | ‚úÖ | SPIFFE/SPIRE identity, mTLS mutual auth, MFA enforcement |
      | **V3 Session Management**                     | ‚úÖ | ‚úÖ | ‚ö†Ô∏è | OAuth 2.1 + PKCE, short-lived tokens, secure cookie flags |
      | **V4 Access Control**                         | ‚úÖ | ‚úÖ | ‚úÖ | RBAC/ABAC policies, policy-engine guardrails |
      | **V5 Validation, Sanitization & Encoding**    | ‚úÖ | ‚úÖ | ‚úÖ | Zod validation, safe serialization, output encoding |
      | **V6 Stored Cryptography**                    | ‚úÖ | ‚úÖ | ‚ö†Ô∏è | KMS secrets, envelope encryption, rotation runbooks |
      | **V7 Error Handling & Logging**               | ‚úÖ | ‚úÖ | ‚úÖ | Structured audit trails, privacy-aware logging |
      | **V8 Data Protection**                        | ‚úÖ | ‚úÖ | ‚ö†Ô∏è | Data classification, minimization, L3 encryption backlog |
      | **V9 Communications**                         | ‚úÖ | ‚úÖ | ‚úÖ | Enforce TLS 1.3 + mTLS everywhere; any exceptions must follow the Escalation & Exceptions process and be explicitly approved |
      | **V10 Malicious Code & Configuration**        | ‚úÖ | ‚úÖ | ‚úÖ | Semgrep OWASP/LLM, IaC policy scans, supply-chain attestations |
      | **V11 Business Logic**                        | ‚úÖ | ‚úÖ | ‚ö†Ô∏è | Abuse-case tests, workflow guardrails, manual approvals |
      | **V12 Files, Resources & APIs**               | ‚úÖ | ‚úÖ | ‚úÖ | CSP + sandboxing, contract schemas, resource isolation |
      | **V13 API & Web Service Security**            | ‚úÖ | ‚úÖ | ‚úÖ | OpenAPI linting, rate limiting, telemetry correlation |
      | **V14 Configuration**                         | ‚úÖ | ‚úÖ | ‚úÖ | GitOps baselines, drift detection, secret scanning |

      > **Legend:** ‚úÖ = implemented and continuously verified, ‚ö†Ô∏è Planned = tracked in roadmap with open stories, üöß = in progress.

      Our ASVS alignment work feeds into the MITRE ATLAS navigator to ensure adversarial ML coverage stays in lockstep with web and API controls. Roadmapped L3 capabilities are tracked in the Cortex-OS security program backlog, with quarterly reviews to close any remaining gaps.

      ## üìã Security Checklist for Contributors

      ### Code & Platform Security Checklist (ASVS Mapping)

      - [ ] **V1 Architecture & Threat Modeling (L1-L2)** ‚Äì Document threat models, update ADRs, and record MITRE ATLAS scenarios for new features.
      - [ ] **V2 Authentication (L1-L3)** ‚Äì Enforce SPIFFE/SPIRE identity, rotate credentials, and verify MFA or device attestation where applicable.
      - [ ] **V3 Session Management (L1-L2)** ‚Äì Use short-lived, server-side sessions with secure flags and implement token revocation workflows.
      - [ ] **V4 Access Control (L1-L3)** ‚Äì Apply least privilege RBAC/ABAC rules, add defense-in-depth policy checks, and test negative access paths.
      - [ ] **V5 Input Validation (L1-L3)** ‚Äì Validate all inbound data with schemas, reject on failure, and encode outputs for target contexts.
      - [ ] **V6 Cryptography (L1-L2)** ‚Äì Store secrets in approved KMS, enforce TLS 1.3+, and document rotation cadence.
      - [ ] **V7 Error Handling & Logging (L1-L3)** ‚Äì Emit structured, privacy-safe logs, scrub secrets, and enable tamper detection.
      - [ ] **V8 Data Protection (L1-L2)** ‚Äì Classify data, enforce retention policies, and ensure data minimization in AI prompts.
      - [ ] **V9 Communications (L1-L3)** ‚Äì Require mTLS for service mesh hops, enforce TLS for external clients, and monitor certificate health.
      - [ ] **V10 Malicious Code & Configuration (L1-L2)** ‚Äì Run Semgrep OWASP/LLM rules, IaC scanners, and dependency audits before merge.
      - [ ] **V11 Business Logic (L1-L2)** ‚Äì Write misuse/abuse tests for workflows, ensure fallback and escalation paths exist.
      - [ ] **V12 Files & Resources (L1-L3)** ‚Äì Restrict file access, scan uploads, and sandbox untrusted code execution paths.
      - [ ] **V13 API Security (L1-L3)** ‚Äì Version APIs, enforce schema-based validation, enable rate limits and telemetry correlations.
      - [ ] **V14 Configuration (L1-L3)** ‚Äì Manage configs via GitOps, lock defaults to secure values, and monitor drift across environments.

      ### AI/ML Security Checklist (OWASP LLM + ASVS Extensions)

      - [ ] Map each LLM integration to MITRE ATLAS techniques and associated detections.
      - [ ] Enforce prompt hygiene, output filtering, and evidence capture for critical flows.
      - [ ] Validate training and fine-tuning datasets for poisoning, lineage, and consent requirements.
      - [ ] Apply rate limiting, workload isolation, and cost guards against LLM DoS or resource abuse.
      - [ ] Restrict model and tool capabilities via explicit allowlists and contract enforcement.
      - [ ] Review fairness/bias dashboards and document mitigations for material risks.

      ### Infrastructure & Operations Checklist

      - [ ] Enforce TLS 1.3 + mTLS; any exceptions must follow the Escalation & Exceptions process and be explicitly approved. Ensure automated certificate rotation.
      - [ ] Confirm secret storage (Vault/KMS) policies and audit logs for administrative actions.
      - [ ] Run container and host vulnerability scans (CIS Benchmarks, Trivy, etc.) before promotion.
      - [ ] Validate network segmentation, egress policies, and zero-trust controls per ASVS V9 requirements.
      - [ ] Ensure monitoring, alerting, and incident runbooks cover ASVS V7/V10/V13 controls with MITRE ATLAS adversary playbooks.

      ## üÜò Security Incident Response

      ### Incident Classification

      #### Severity Levels

      - **P0 (Critical)**: Active exploitation, data breach, system compromise
      - **P1 (High)**: High risk vulnerability, potential for significant impact
      - **P2 (Medium)**: Moderate risk, limited impact
      - **P3 (Low)**: Low risk, minimal impact

      #### Response Teams

      - **Security Team**: Primary incident response
      - **Engineering Team**: Technical remediation
      - **Management Team**: Business decisions and communications
      - **Legal Team**: Compliance and legal requirements

      ### Incident Response Process

      1. **Detection & Analysis** (0-2 hours)
         - Incident identification and initial assessment
         - Severity classification
         - Team notification

      2. **Containment** (2-6 hours)
         - Isolate affected systems
         - Prevent further damage
         - Preserve evidence

      3. **Investigation** (6-24 hours)
         - Root cause analysis
         - Impact assessment
         - Evidence collection

      4. **Remediation** (24-72 hours)
         - Fix implementation
         - System restoration
         - Verification testing

      5. **Recovery** (72+ hours)
         - System monitoring
         - User communication
         - Lessons learned

      ## üìû Contact Information

      ### Security Team

      - **Primary**: <security@cortex-os.dev>
      - **Security Lead**: <security-lead@cortex-os.dev>
      - **Incident Response**: <incident-response@cortex-os.dev>

      ### Emergency Contacts

      - **Critical Vulnerabilities**: Available 24/7 via <security@cortex-os.dev>
      - **Security Incidents**: Include "URGENT" in subject line

      ### Legal and Compliance

      - **Privacy Officer**: <privacy@cortex-os.dev>
      - **Compliance Team**: <compliance@cortex-os.dev>
      - **Legal Team**: <legal@cortex-os.dev>

      ## üìú Security Policies

      ### Data Protection

      - **Data Classification**: Confidential, Internal, Public
      - **Data Retention**: Automated deletion based on classification
      - **Data Encryption**: At rest and in transit
      - **Access Controls**: Need-to-know basis

      ### Privacy Protection

      - **PII Handling**: Minimal collection, secure processing
      - **User Consent**: Explicit consent for data processing
      - **Data Subject Rights**: Right to access, modify, delete
      - **Cross-border Transfers**: GDPR compliant mechanisms

      ### Vendor Security

      - **Security Assessments**: Required for all vendors
      - **Data Processing Agreements**: Mandatory for data processors
      - **Regular Reviews**: Annual security posture reviews
      - **Incident Notification**: 24-hour notification requirement

      ## üîÑ Security Updates

      ### Update Notifications

      - **Security Advisories**: Published on GitHub Security tab
      - **Email Notifications**: Available for security-sensitive repositories
      - **RSS Feeds**: Security update feeds available
      - **API**: Programmatic access to security information

      ### Patch Management

      - **Critical Patches**: Released within 24-72 hours
      - **High Priority Patches**: Released within 1-2 weeks
      - **Regular Patches**: Included in monthly releases
      - **Emergency Patches**: Out-of-band releases for critical issues

      ---

      **Security is Everyone's Responsibility** üõ°Ô∏è
      _Help us keep Cortex-OS secure for everyone_

      [![Report Vulnerability](https://img.shields.io/badge/report-vulnerability-red.svg)](mailto:security@cortex-os.dev)

      **Last Updated**: November 18, 2025 | **Version**: 1.2.0
  - id: vision
    file: .cortex/rules/00-core/vision.md
    sha: ee5cbbf7592b3c00ef92e310682bb8ce289aa78e2cd56de173bcb77cc76a492f
    url: https://governance.cortex-os.local/docs/00-core/vision.md
    full_text: >-
      ---

      trigger: always_on

      alwaysApply: true

      ---

      <!-- filename: /.cortex/rules/vision.md -->


      # Cortex-OS Vision Document (v1.1, 2025-10-12)


      ## 0) North Star (End State)


      Cortex-OS is a self-contained, local-first **Agentic Second Brain Runtime
      (ASBR)** that:


      1) orchestrates agent workflows with **LangGraph** under strict phase
      gates,  

      2) persists knowledge via a **Memory Core** with MCP/REST **parity**,  

      3) exposes **only** controlled surfaces ‚Äî **MCP**, **A2A**, **REST**, and
      **frontier adapters** ‚Äî guarded by policy, and  

      4) ships an **A11y-first Ops Dashboard** for health, logs, metrics,
      traces, and manual controls.


      > **Governance is code.** The runtime acknowledges the nearest
      `AGENTS.md`, emits evidence tokens, runs a Vibe Check before acting, and
      treats **time freshness** as a first-class constraint.


      ---


      ## 1) Core Principles


      - **Local-first, vendor-neutral.** MLX + Ollama preferred; frontier APIs
      optional behind policy.

      - **Deterministic & evidence-backed.** Reproducible runs; artifacted logs,
      traces, SBOM/provenance.

      - **Single integration hub.** Exactly one MCP server;
      Tools/Resources/Prompts are **registered** (not embedded).

      - **Tight domain boundaries.** No cross-domain imports; communicate via
      A2A topics or declared contracts/schemas.

      - **Security, A11y, Observability by default.** API-key/OAuth, WCAG 2.2
      AA, structured logs + OTel; secrets retrieved on-demand via the 1Password
      CLI (`op`) with no long-lived copies.

      - **Small, shippable steps.** Quality gates: coverage/mutation, a11y,
      security, structure guard.

      - **Time Freshness Guard.** All dates anchored to harness "today";
      ISO-8601 surfaced to users.

      - **Hybrid Model ‚Äî Live Only.** Embeddings/rerankers/generation must hit
      **live** MLX/Ollama/frontier engines (no stubs/recordings/dry-runs).

      - **AGENTS.md + Vibe Check.** Load nearest `AGENTS.md` (persist SHA); call
      `vibe_check` before file writes/network calls/long runs.


      ---


      ## 2) System Boundaries (Allowed Interfaces)


      - **MCP (Model Context Protocol)** over **HTTP/SSE** (optional
      **STDIO**)  
        Paths: `/mcp`, `/sse`, `/health`, `/metrics`
      - **A2A** (Agent-to-Agent hub) for intra-runtime messaging (topics,
      intents, envelopes)

      - **REST API** for programmatic control & integrations

      - **Frontier Adapters**: OpenAI/Anthropic/Google, ChatGPT Connectors/Apps
      SDK, Perplexity SSE ‚Äî all policy-guarded


      > **Default ports (must match `.well-known/mcp.json`)**: `3024` MCP,
      `3026` Local Memory MCP, `3002` Memory API, `39300` Pieces OS.


      **Auth modes**

      - **API key** by default (dev may allow `NO_AUTH=true`).  

      - **OAuth2 (Auth0)** optional; scopes must include: `search.read
      docs.write memory.read memory.write memory.delete` (RBAC + "Add
      Permissions in Access Token").


      ---


      ## 3) Architecture Overview


      ### 3.1 ASBR Orchestrator (LangGraph)

      - Owns graphs, policies, **phase machine (R‚ÜíG‚ÜíF‚ÜíREVIEW)**, and run
      lifecycle.

      - Invokes MCP Tools/Resources/Prompts, A2A messages, Memory, RAG jobs.

      - Emits structured telemetry (traces/metrics/logs) with
      `brand:"brAInwav"`, run IDs, and phase transitions.


      ### 3.2 MCP (Single Hub)

      - **FastMCP v3** server exposing `/mcp`, `/sse`, `/health`, `/metrics`.

      - Loads registries for Tools/Resources/Prompts; no business logic in the
      server.

      - **Auth**: API-key or OAuth2; remote access via **Cloudflare Tunnel**.


      ### 3.3 A2A Hub

      - Central bus for topics/intents; policies for routing, retries/backoff,
      auditing.

      - **No direct cross-domain imports**; use envelopes/contracts only.


      ### 3.4 Memory Core

      - Single source of truth for memories (facts, episodes, embeddings,
      artifacts).

      - CRUD + search APIs; retention/expiry; export/import.

      - **Parity rule**: every write available via **MCP & REST**. Evidence
      persisted to `.github/instructions/memories.instructions.md`.


      ### 3.5 RAG Pipeline

      - Ingestion ‚Üí chunking ‚Üí **live** embedding ‚Üí indexing ‚Üí retrieval ‚Üí
      post-processing (rerankers are **live** only).

      - Deterministic pipelines with versioned configs, replayable jobs, and
      batch evaluation hooks.


      ### 3.6 Agents

      - Role-scoped (builder/reviewer/guardian) with explicit contracts and
      **evidence pointers**.

      - Obey **phase machine** and **HITL at REVIEW only**; blocked otherwise.


      ### 3.7 Connectors & Frontier Surfaces

      - **ChatGPT Connectors / Apps SDK** for bounded operation of Cortex-OS
      inside ChatGPT (OAuth protected-resource discovery, dynamic client
      registration).

      - **Perplexity SSE** via streaming adapter.

      - Rate-limits, audit, and error taxonomy standardized.


      ### 3.8 Ops Dashboard (React)

      - Health, logs viewer, trace explorer, metrics, queue/state monitors.

      - Manual controls: pause/resume, retry, drain, "run test flow".

      - **A11y**: keyboard navigation, semantic roles, no color-only signaling.


      ### 3.9 Observability & Security

      - **Metrics** (Prometheus), **Traces** (OpenTelemetry), **Logs**
      (structured/Pino-style).

      - Security: timing-safe API-key checks, Host/CORS validation, secret
      vaults.

      - **403 triage**: path, host/CORS, auth header, tunnel policy, dev no-auth
      alignment.


      ---


      ## 4) Packages: Vision & "Done Means"


      > Names indicative ‚Äî adapt to monorepo layout.


      ### 4.1 `packages/mcp-server`

      **Vision:** Minimal FastMCP v3 HTTP/SSE hub; loads registries; zero
      business logic.  

      **Done means:** `/health`, `/mcp`, `/sse`, `/metrics` green; API-key on;
      Cloudflare Tunnel tested; integration tests pass; **evidence tokens
      present** (`AGENTS_MD_SHA`, `brAInwav-vibe-check`).


      ### 4.2 `packages/mcp-core`

      **Vision:** Protocol utilities, schemas, adapters, error taxonomy.  

      **Done means:** Zod types for Tools/Resources/Prompts; stable client;
      exhaustive unit tests; import-boundary guards.


      ### 4.3 `packages/mcp-registry`

      **Vision:** Declarative registry with lazy loading.  

      **Done means:** Hot-reload in dev; list/read/register APIs; smoke test of
      discoverable & callable Tool/Resource/Prompt via MCP.


      ### 4.4 `packages/a2a`

      **Vision:** Central A2A hub (no per-package A2A).  

      **Done means:** Topics/intents; at-least-once delivery; retries/backoff;
      message audit; fan-out/error-path tests.


      ### 4.5 `packages/memory-core`

      **Vision:** Unified memory store (facts/episodes/embeddings/artifacts).  

      **Done means:** Deterministic IDs; retention/export; vector adapters; >90%
      test coverage; **parity tests** (MCP & REST).


      ### 4.6 `packages/rag`

      **Vision:** Deterministic ingestion/index/retrieval with **live**
      models.  

      **Done means:** Config-driven jobs; snapshotable outputs; retrieval
      quality smoke; perf budget; **models:health/smoke logs** attached (model
      IDs, dims/norms, latency).


      ### 4.7 `packages/agents`

      **Vision:** Role-scoped agents with policy gates; evidence-backed
      outputs.  

      **Done means:** JSON-schema I/O; blocking reviewer modes; trace
      correlation; E2E fixtures; **phase tokens** emitted.


      ### 4.8 `packages/orchestration`

      **Vision:** LangGraph graphs + policy enforcement (phase, HITL gates).  

      **Done means:** Golden path (ingest‚Üíindex‚Üíquery) and incident path;
      replayable runs; determinism checks; **HITL blocked pre-REVIEW**.


      ### 4.9 `packages/connectors`

      **Vision:** Adapters for ChatGPT Apps SDK, Perplexity SSE, frontier
      APIs.  

      **Done means:** Sample ChatGPT config; SSE demo; rate-limit & auth guards;
      403 playbook; protected-resource metadata publishing OAuth scopes.


      ### 4.10 `apps/chatgpt-dashboard`

      **Vision:** ChatGPT "glass" dashboard (React) rendered via the OpenAI
      **Apps SDK**, to monitor health, logs, traces, metrics, and control agents
      **from within ChatGPT**, under the same governance and auth as the MCP
      hub.  

      **Done means:** Keyboard-navigable UI; live metrics; log search; run
      controls; role-based access; axe/jest-axe reports; protected-resource
      discovery (`/.well-known/oauth-protected-resource`) wired; OAuth scopes
      published (`search.read docs.write memory.read memory.write
      memory.delete`); app manifest validated in ChatGPT; Cloudflare tunnel
      tested; structured logs include `brand:"brAInwav"`.


      ### 4.11 `apps/cortex-os` (ASBR host)

      **Vision:** Boots ASBR, mounts graphs, wires MCP/A2A/Memory/RAG, exposes
      REST.  

      **Done means:** One-command dev up; golden-path E2E; graceful shutdown;
      provenance artifacts saved; **structure guard** clean.


      ---


      ## 5) Non-Goals


      - Multiple MCP servers per package (duplication)  

      - Interfaces beyond MCP/A2A/REST/frontier adapters  

      - Opaque AI actions without evidence/logs


      ---


      ## 6) Success Metrics


      - **Reliability:** ‚â•99% success on golden-path E2E; zero data-loss on
      restart.  

      - **Quality:** CI gates all green; ‚â•90% unit coverage key packages; 95%
      span coverage in traces.  

      - **Security:** All external calls authenticated; happy-path free of 403s;
      no secrets logged.  

      - **A11y/UX:** Full keyboard coverage; no color-only indicators;
      screen-reader labels pass axe/jest-axe.  

      - **Governance Evidence:** PRs contain:
        - `AGENTS_MD_SHA:<sha>`, `brAInwav-vibe-check`, `PHASE_TRANSITION:*`  
        - `MODELS:LIVE:OK engine=<mlx|ollama|frontier>` with model IDs and dims/norms  
        - Top-level Code Review Checklist link to `/.cortex/rules/code-review-checklist.md`

      ---


      ## 7) Phase Machine & HITL Gating (Runtime Policy)


      - **R (Red):** Write failing tests; plan minimal pass ‚Üí auto-advance to
      **G** when failing ‚Üí passing committed.  

      - **G (Green):** Implement to pass; coverage gates ‚Üí **F** when 90/95%
      thresholds met.  

      - **F (Finished):** Refactor/docs/a11y/security/structure-guard + **live
      model** evidence ‚Üí **REVIEW**.  

      - **REVIEW:** HITL permitted; Code Review Checklist must PASS all
      BLOCKERs.


      > Any `human_input` before REVIEW is a policy violation.


      ---


      ## 8) Evidence Protocol (Emitted & Verified)


      - **AGENTS Acknowledgement:** `AGENTS_MD_SHA:<sha>` persisted in
      `.cortex/run.yaml` and first vibe-check log.

      - **Vibe Check:** `"brAInwav-vibe-check"` log required before act phases.

      - **Live-Only Models:** `pnpm models:health && pnpm models:smoke` output
      includes engine, model IDs, vector dims/norms, latency, and
      `MODELS:LIVE:OK`.

      - **Time Freshness:** All surfaced dates are ISO-8601; relative terms
      normalized.


      ---


      ## 9) Glossary


      - **MCP:** Model Context Protocol ‚Äî registry/invocation of
      Tools/Resources/Prompts.  

      - **ASBR:** Agentic Second Brain Runtime ‚Äî Cortex-OS orchestrator on
      LangGraph.  

      - **A2A:** Agent-to-Agent messaging hub.  

      - **Phase Machine:** R‚ÜíG‚ÜíF‚ÜíREVIEW gatekeeper of autonomy and HITL.
  - id: task_folder_structure
    file: .cortex/rules/10-flow/TASK_FOLDER_STRUCTURE.md
    sha: 0fad52db274b60f4f35ed785ef7696c511662fe931024dce5de371d7d4f59ed4
    url: https://governance.cortex-os.local/docs/10-flow/TASK_FOLDER_STRUCTURE.md
    full_text: >
      ---

      trigger: always_on

      alwaysApply: true

      ---

      # Task Folder Structure Guide


      **Authoritative Reference for Task Organization**


      All tasks must follow this standardized folder structure within
      `~/tasks/[feature-name]/`:


      ## Required Structure


      ```

      ~/tasks/

      ‚îî‚îÄ‚îÄ [feature-name]/              # Use descriptive slugs:
      copilot-enhancement, brainwav-integration
          ‚îú‚îÄ‚îÄ research.md              # Research findings, RAID analysis, feasibility studies
          ‚îú‚îÄ‚îÄ implementation-plan.md   # High-level implementation strategy
          ‚îú‚îÄ‚îÄ tdd-plan.md             # Test-Driven Development plan with BDD scenarios
          ‚îú‚îÄ‚îÄ implementation-checklist.md  # Actionable task breakdown with checkboxes
          ‚îú‚îÄ‚îÄ implementation-log.md    # Progress notes during implementation
          ‚îú‚îÄ‚îÄ analysis/               # Reuse-first evidence logs
          ‚îÇ   ‚îî‚îÄ‚îÄ reuse-evaluation.md # Filled from /.cortex/templates/reuse-evaluation-template.md
          ‚îú‚îÄ‚îÄ code-review.md          # Review comments and resolutions
          ‚îú‚îÄ‚îÄ lessons-learned.md      # Key insights and takeaways
          ‚îú‚îÄ‚îÄ SUMMARY.md              # Final comprehensive task summary (Archive phase)
          ‚îú‚îÄ‚îÄ HITL-feedback.md        # Human-in-the-loop decisions (if applicable)
          ‚îú‚îÄ‚îÄ design/                 # Design diagrams, wireframes, architecture
          ‚îÇ   ‚îî‚îÄ‚îÄ *.png, *.svg, *.drawio
          ‚îú‚îÄ‚îÄ test-logs/              # Test execution results
          ‚îÇ   ‚îî‚îÄ‚îÄ *.log, *.xml, *.json
          ‚îú‚îÄ‚îÄ verification/           # Quality gate results, coverage reports
          ‚îÇ   ‚îú‚îÄ‚îÄ coverage-report.html
          ‚îÇ   ‚îú‚îÄ‚îÄ security-scan.json
          ‚îÇ   ‚îî‚îÄ‚îÄ structure-validation.log
          ‚îú‚îÄ‚îÄ validation/             # CI/CD deployment validation reports
          ‚îÇ   ‚îî‚îÄ‚îÄ deployment-*.log
          ‚îú‚îÄ‚îÄ refactoring/            # Refactoring plans and summaries
          ‚îÇ   ‚îî‚îÄ‚îÄ refactor-*.md
          ‚îú‚îÄ‚îÄ monitoring/             # Production monitoring logs and metrics
          ‚îÇ   ‚îî‚îÄ‚îÄ monitoring-*.json
          ‚îú‚îÄ‚îÄ logs/                   # Governance and evidence logs
          ‚îÇ   ‚îú‚îÄ‚îÄ vibe-check/         # Vibe check oversight responses
          ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ initial.json     # Pre-implementation vibe check with research integration
          ‚îÇ   ‚îî‚îÄ‚îÄ academic-research/  # Academic research findings and evidence
          ‚îÇ       ‚îú‚îÄ‚îÄ findings.json   # Synthesized research from all academic sources
          ‚îÇ       ‚îî‚îÄ‚îÄ connectors-health.log  # Academic connector health status
          ‚îî‚îÄ‚îÄ json/                   # Structured evidence and metadata
              ‚îú‚îÄ‚îÄ memory-ids.json     # Local memory parity IDs for research decisions
              ‚îî‚îÄ‚îÄ research-evidence.json  # Academic citations and evidence mapping
      ```


      ## Phase-by-Phase File Creation


      ### Phase 0: Task Initialization


      1. Create task folder: `~/tasks/[feature-name]/`

      2. No files yet - just the directory structure


      ### Phase 1: Research


      **Required files:**


      - `research.md` - Complete research findings including:
        - RAID analysis (Risks, Assumptions, Issues, Dependencies)
        - Feasibility studies (PIECES assessments)
        - Technical spikes documentation
        - PoC evaluation results
        - **Academic research synthesis** (mandatory per vibe-check.md ¬ß2.1):
          - Wikidata vector search results and knowledge graph relationships
          - arXiv semantic search findings and recent technical approaches
          - Semantic Scholar proven solutions and highly-cited approaches
          - OpenAlex research patterns and domain consensus
          - Context7 domain knowledge and best practices (HTTP API client)
        - Security and accessibility requirements
        - Existing patterns and integration points

      ### Phase 2: Planning


      **Required files:**


      - `implementation-plan.md` - High-level strategy with:
        - SRS (Software Requirements Specification)
        - Architecture overview
        - Technology choices
        - Timeline and dependencies (MoSCoW prioritization)

        
      - `tdd-plan.md` - Test-Driven Development plan with:
        - BDD scenarios (Given-When-Then)
        - TDD unit test outlines
        - Test coverage goals

        
      - `implementation-checklist.md` - Actionable breakdown:
        - [ ] Task items with checkboxes
        - Module decomposition
        - Pseudocode examples

      - `analysis/reuse-evaluation.md` - Reuse-first investigation log
      (template: `/.cortex/templates/reuse-evaluation-template.md`) covering
      candidates assessed, decisions, evidence links, and mitigation tickets.


      **Optional subfolders:**


      - `design/` - Architecture diagrams, wireframes, integration maps


      ### Phase 3: Implementation


      **Required files:**


      - `implementation-log.md` - Real-time progress notes:
        - Completed checklist items
        - Challenges encountered
        - Decisions made
        - Deviations from plan

      **Required subfolders:**


      - `test-logs/` - Store test execution results as they're created


      ### Phase 4: Review, Testing, Validation & Monitoring


      **Required files:**


      - `code-review.md` - Review findings and resolutions

      - `HITL-feedback.md` - Human approval decisions (if applicable)


      **Required subfolders:**


      - `test-logs/` - Comprehensive test results (unit, integration, system,
      acceptance, a11y, security, performance)

      - `validation/` - CI/CD deployment validation reports

      - `refactoring/` - Refactoring plans and summaries


      ### Phase 5: Verification


      **Required files:**


      - `lessons-learned.md` - Key insights and takeaways


      **Required subfolders:**


      - `verification/` - Quality gate results:
        - Lint results
        - Test coverage reports
        - Security scan outputs
        - Structure validation logs
        - CI/CD pipeline evidence

      ### Phase 6: Archive


      **Required files:**


      - `SUMMARY.md` - Comprehensive final summary including:
        - Research findings and decisions
        - Implementation details and challenges
        - Review comments and resolutions
        - Test outcomes and coverage
        - HITL decisions and rationales
        - Refactoring notes
        - Verification results
        - Monitoring and iteration lessons

      **Action:** Flag entire `~/tasks/[feature-name]/` folder as archived


      ## Examples


      ### Example 1: Simple Bug Fix


      ```

      ~/tasks/fix-mcp-auth-bug/

      ‚îú‚îÄ‚îÄ research.md              # Investigation findings

      ‚îú‚îÄ‚îÄ implementation-plan.md   # Fix strategy

      ‚îú‚îÄ‚îÄ tdd-plan.md             # Test cases

      ‚îú‚îÄ‚îÄ implementation-checklist.md

      ‚îú‚îÄ‚îÄ implementation-log.md

      ‚îú‚îÄ‚îÄ code-review.md

      ‚îú‚îÄ‚îÄ test-logs/

      ‚îÇ   ‚îî‚îÄ‚îÄ auth-tests.log

      ‚îú‚îÄ‚îÄ verification/

      ‚îÇ   ‚îî‚îÄ‚îÄ security-scan.json

      ‚îú‚îÄ‚îÄ lessons-learned.md

      ‚îî‚îÄ‚îÄ SUMMARY.md

      ```


      ### Example 2: New Feature with UI


      ```

      ~/tasks/dashboard-metrics-widget/

      ‚îú‚îÄ‚îÄ research.md

      ‚îú‚îÄ‚îÄ implementation-plan.md

      ‚îú‚îÄ‚îÄ tdd-plan.md

      ‚îú‚îÄ‚îÄ implementation-checklist.md

      ‚îú‚îÄ‚îÄ implementation-log.md

      ‚îú‚îÄ‚îÄ code-review.md

      ‚îú‚îÄ‚îÄ HITL-feedback.md         # Design approval decisions

      ‚îú‚îÄ‚îÄ design/

      ‚îÇ   ‚îú‚îÄ‚îÄ wireframe.png

      ‚îÇ   ‚îú‚îÄ‚îÄ architecture.drawio

      ‚îÇ   ‚îî‚îÄ‚îÄ component-hierarchy.svg

      ‚îú‚îÄ‚îÄ test-logs/

      ‚îÇ   ‚îú‚îÄ‚îÄ unit-tests.xml

      ‚îÇ   ‚îú‚îÄ‚îÄ a11y-tests.json

      ‚îÇ   ‚îî‚îÄ‚îÄ integration-tests.log

      ‚îú‚îÄ‚îÄ verification/

      ‚îÇ   ‚îú‚îÄ‚îÄ coverage-report.html

      ‚îÇ   ‚îú‚îÄ‚îÄ wcag-validation.json

      ‚îÇ   ‚îî‚îÄ‚îÄ security-scan.json

      ‚îú‚îÄ‚îÄ refactoring/

      ‚îÇ   ‚îî‚îÄ‚îÄ component-split.md

      ‚îú‚îÄ‚îÄ lessons-learned.md

      ‚îî‚îÄ‚îÄ SUMMARY.md

      ```


      ## Agent Responsibilities


      ### When Starting a New Task


      1. Create `~/tasks/[feature-name]/` directory immediately

      2. Start with `research.md` in Phase 1

      3. Never skip phases or required files

      4. Follow the hierarchy of authority (see AGENTS.md)


      ### During Task Execution


      - Update files as you progress through phases

      - Fetch API keys, SSH keys, and tokens on-demand with the 1Password CLI
      (`op`); never embed secrets in task artifacts or long-lived env files.

      - Keep `implementation-log.md` current with real-time notes

      - Create subfolders as needed before adding files to them

      - Mark checklist items in `implementation-checklist.md` as completed


      ### Before Archiving


      - Ensure all required files exist and are complete

      - Create comprehensive `SUMMARY.md`

      - Verify all subfolders contain relevant artifacts

      - Flag task folder as archived in local memory


      ## Common Mistakes to Avoid


      ‚ùå **DON'T:**


      - Store task files in flat structure at `~/tasks/[feature].md`

      - Skip required files (research, plans, checklists, summary)

      - Mix multiple tasks in one folder

      - Store secrets or PII in task folders

      - Archive incomplete task folders


      ‚úÖ **DO:**


      - Create dedicated folder for each task

      - Follow phase-by-phase file creation

      - Use descriptive folder names (kebab-case slugs)

      - Keep folder structure organized

      - Document everything for reproducibility


      ## Integration with Local Memory


      After creating/updating task artifacts:


      1. Store key decisions in local memory MCP/REST API

      2. Tag with task name for retrieval

      3. Reference `LocalMemoryEntryId` in relevant task files

      4. Ensure persistence across agent sessions


      ## Compliance


      This structure is **mandatory** per:


      - `.cortex/rules/agentic-coding-workflow.md`

      - `.github/copilot-instructions.md`

      - `AGENTS.md` (root)


      Deviations require approval per Constitution governance.


      ---


      **Last Updated:** 2025-10-10  

      **Maintainer:** brAInwav Development Team
  - id: llm_threat_controls
    file: .cortex/rules/00-core/llm-threat-controls.md
    sha: 75bb7f77caa566add4489259f97512eed84e52a0718eb0b2e3de4f426687fbf1
    url: https://governance.cortex-os.local/docs/00-core/llm-threat-controls.md
    full_text: |
      # LLM Threat Controls ‚Äî OWASP Top 10 Alignment (Cortex-OS)

      **Status:** Authoritative reference for oversight mapping  
      **Scope:** Applies to all Cortex-OS agents, reviewers, and CI guardrails when assessing LLM-centric risk.  
      **Standards Alignment:** OWASP Top 10 for LLM Apps (2025), NIST AI RMF 1.0, NIST Generative AI Profile, W3C Trace Context, CycloneDX 1.7, SLSA v1.1.

      ---

      ## How to use this document
      - Reference control IDs (`LLM0x`) in oversight findings, vibe-check evidence, risk assessments, and PR discussions.
      - If a required mitigation is missing, mark **[BLOCKER]** unless a Constitution waiver exists.
      - Map multiple IDs when a scenario spans more than one threat category.
      - Attach the **Evidence Hooks** below to your PR (paths, logs, screenshots).

      ---

      ## Control Catalog (with Evidence Hooks)

      | ID | OWASP LLM Top 10 | Cortex-OS Mitigations | Evidence Hooks to Attach in PR |
      |----|-------------------|-----------------------|--------------------------------|
      | **LLM01** | Prompt Injection | Strict input validation (Zod), tool allow-list & scoped capabilities, **structured outputs / function calling**, sandboxed tool execution, **vibe_check** before side-effects. | Schema files; tool registry entries; vibe_check JSON; failing‚Üípassing injection tests; blocked-call log/screenshot. |
      | **LLM02** | Data Leakage | Data minimization; observability redaction; secrets via **1Password CLI (`op`)**; access reviews; encrypted storage; PII scanners. | Redaction config; scanner report; `op` usage evidence; access review notes; encryption config. |
      | **LLM03** | Model Theft | Authenticated API gateways; rate limits; watermarking (where applicable); signed inference manifests. | Gateway policy; rate-limit config; watermark test; signed manifest sample. |
      | **LLM04** | Supply Chain | **SBOM CycloneDX 1.7**, dependency review, reproducible builds, **SLSA v1.1** provenance, **Cosign v3 bundle** verification, OSV scan. | SBOM file; SLSA attestation; cosign bundle verify log; OSV report. |
      | **LLM05** | Insecure Plugins | Plugin registry attestation; contract testing; minimal scopes; orchestration kill-switch toggles. | Registry entry; contract tests; scope diff; toggle docs. |
      | **LLM06** | Excessive Agency | Phase policy (**HITL only at REVIEW**); action throttles; deterministic plans ‚â§7 steps; recap logging; guardian mode blocks. | Phase tokens (`PHASE_TRANSITION:*`); throttle config; plan evidence; guardian failure screenshot. |
      | **LLM07** | Sensitive Output Handling | Output classifiers; policy-based redaction; watermark detection; reviewer approval for regulated content. | Classifier config; redaction policies; reviewer checklist link; detection logs. |
      | **LLM08** | Inadequate Monitoring | **W3C Trace Context**; OpenTelemetry logs/traces/metrics; audit log retention; anomaly dashboards; run-manifest archives. | `traceparent` capture; `trace_id` samples; dashboard screenshot; manifest path. |
      | **LLM09** | Model Poisoning | Dataset provenance attestations; corpus hash pinning; data quality scoring; quarantine pipelines. | Dataset attestations; hash manifests; quality scores; quarantine run logs. |
      | **LLM10** | Insecure Defaults | Secure-by-default configs; least privilege via **OIDC/WIF**; disabled legacy endpoints; documented escalation paths. | OIDC/WIF proof; IAM least-privilege diffs; endpoint matrix; incident playbook link. |

      ---

      ## Cortex‚ÄëOS Extensions (beyond OWASP)

      - **LLM‚ÄëS0 ‚Äî Structured Output Contract (BLOCKER)**  
        Machine‚Äëconsumed generations **must** conform to JSON‚ÄëSchema or tool/function calling. Free‚Äëtext is not a contract.  
        _Evidence:_ schema files, validator test logs, failing‚Üípassing contract tests.

      - **LLM‚ÄëS1 ‚Äî Cancellable Side‚ÄëEffects (BLOCKER)**  
        All network/tool calls support cancellation (`AbortSignal` or SDK equivalent).  
        _Evidence:_ semgrep/lint results, unit tests proving cancellation paths.

      - **LLM‚ÄëS2 ‚Äî Academic Research & Licensing (BLOCKER)**  
        Implementation plans enhanced via Wikidata/arXiv/Semantic Scholar/OpenAlex/Context7; licensing validated; only SAFE/REVIEW content included.  
        _Evidence:_ `logs/academic-research/findings.json`, license validation notes, references cited in plan.

      ---

      ## Reporting Template

      ```markdown
      **LLM Threat Controls**
      - Controls: LLM0x, LLM0y; Extensions: LLM‚ÄëS0/LLM‚ÄëS1/LLM‚ÄëS2
      - Summary: <1‚Äì2 sentences of the risk + mitigation>
      - Mitigation evidence: <file://path#Lstart-Lend or log ref / screenshot>
      - Residual risk & follow-ups: <tickets/waivers with IDs, expiry>
      ```

      ---

      ## References

      * OWASP Top 10 for Large Language Model Applications (2025)
      * NIST AI RMF 1.0; NIST Generative AI Profile
      * `/.cortex/rules/vibe-check.md` ‚Ä¢ `/.cortex/rules/agentic-coding-workflow.md` ‚Ä¢ `/.cortex/rules/CHARTER_FRAGMENT.md`
      * Supply chain: CycloneDX 1.7 ‚Ä¢ SLSA v1.1 ‚Ä¢ Cosign v3 bundle
      * Observability: W3C Trace Context ‚Ä¢ OpenTelemetry
  - id: skills_system_governance
    file: .cortex/rules/00-core/skills-system-governance.md
    sha: f3fbbca5b4516d71139d66610c992bd461a4fdc85c45b840fedc2fe3fb7ce64f
    url: https://governance.cortex-os.local/docs/00-core/skills-system-governance.md
    full_text: |
      ---
      title: "Skills System Governance"
      description: "Standards and guidelines for creating, managing, and utilizing skills in brAInwav Cortex-OS"
      version: "1.2.0"
      maintainer: "brAInwav Development Team"
      last_updated: "2025-11-11"
      status: "authoritative"
      applies_to: ["all agents", "all packages", "all skills"]
      enforcement: "CI validation + supply-chain gating + code review"
      standards_alignment:
        - ArcTDD v2025.11 (G0‚ÄìG7)
        - Agentic Phase Policy (R‚ÜíG‚ÜíF‚ÜíREVIEW)
        - Constitution v1.3.0
        - WCAG 2.2 AA (ISO/IEC 40500:2025)
        - W3C Trace Context + OpenTelemetry
        - CycloneDX 1.7 ‚Ä¢ SLSA v1.1 ‚Ä¢ Cosign v3 bundle
        - OIDC/WIF for CI/cloud auth
      ---

      # Skills System Governance

      **Authority**: This document is part of the Governance Pack (`/.cortex/rules/`) and is binding for all agent and human activities involving skills.

      **Scope**: Standards for creating, validating, storing, discovering, applying, measuring, and retiring skills within the brAInwav Cortex-OS ecosystem.

      ---

      ## 0. Operative Guardrails (binding)

      - **Structured Outputs (BLOCKER):** Any machine‚Äëconsumed output from a skill **must** conform to JSON‚ÄëSchema or tool/function calling. Free‚Äëtext is not a contract.
      - **Trace Context (BLOCKER):** Skill application events include W3C `traceparent` and structured logs with `brand:"brAInwav"`, `trace_id` (32 lower‚Äëhex).
      - **Academic Research & Licensing (BLOCKER):** New/major‚Äëupdated skills must cite research and pass license validation; only SAFE/REVIEW content allowed.
      - **Security by Default (BLOCKER):** No secrets in examples, no unsafe patterns; scanners must be clean (Semgrep ERROR=block, gitleaks ANY=block, OSV clean).
      - **A11y Baseline:** Content examples meet WCAG‚ÄØ2.2 AA (ISO/IEC‚ÄØ40500:2025).
      - **Identity & Supply Chain:** CI uses OIDC/WIF; skills tooling/artifacts use CycloneDX‚ÄØ1.7 SBOM + SLSA‚ÄØv1.1 provenance; Cosign v3 bundle verify logs attached.

      **Evidence Tokens (CI‚Äëscanned across PR/logs):**  
      `STRUCTURED_OUTPUTS:OK` ¬∑ `TRACE_CONTEXT:OK` ¬∑ `SUPPLY_CHAIN:OK sbom=cyclonedx@1.7 slsa=1.1 cosign=bundle` ¬∑ `A11Y_REPORT:OK` ¬∑ `brAInwav-vibe-check` ¬∑ `AGENTS_MD_SHA:*`

      ---

      ## 1. Purpose & Principles

      ### 1.1 Purpose

      The Skills System provides structured reference knowledge that:

      - Complements Local Memory (experiential)
      - Increases compliance with best practices
      - Accelerates agent proficiency
      - Ensures consistency across implementations
      - Captures and shares organizational knowledge

      ### 1.2 Core Principles

      1. **Quality > Quantity** (curated, high‚Äësignal skills)
      2. **Evidence‚ÄëBased** (measured effectiveness with citations)
      3. **Accessible** (clear, practical, inclusive)
      4. **Measurable** (defined success criteria + telemetry)
      5. **Ethical** (transparent, beneficial)
      6. **Maintainable** (versioned, reviewed, retired when stale)
      7. **Constitution‚ÄëCompliant** (brand logs, no mock prod claims)

      ---

      ## 2. Skill Lifecycle

      ### 2.1 Creation

      **Who:** Humans, agents, or teams.

      **Creation Requirements (all MUST):**

      1. **Research Phase:** Summarize sources; record license checks.
      2. **Validation Phase:** ‚â• 5 successful applications (Local Memory evidence).
      3. **Documentation Phase:** Fill template (frontmatter + structured sections).
      4. **Review Phase:** Peer review for accuracy, ethics, security, a11y.
      5. **Testing Phase:** Schema + content checks; security scanners clean.
      6. **Approval Phase:** Merge only after gates pass (ArcTDD G0‚ÄìG7).

      **Required Evidence:**

      - Local Memory entries (‚â• 5) with outcomes and links
      - Effectiveness rate ‚â• 80% (initial), computed from application records
      - Clear problem statement, solution approach, examples, and acceptance checks
      - Research citations and license validation summary

      ### 2.2 Validation Standards

      **Schema Validation (Automated, Zod/JSON‚ÄëSchema):**

      ```typescript
      // @cortex-os/contracts SkillSchema (excerpt)
      id: /^skill-[a-z0-9-]{3,}$/  // kebab-case with skill- prefix
      name: string(3..100)
      description: string(10..500)
      content: string(50..50000)
      version: semver
      category: oneOf( "coding","security","testing","documentation","automation","communication","analysis","integration","observability" )
      tags: string[1..20](1..50)
      difficulty: oneOf("beginner","intermediate","advanced","expert")
      estimatedTokens: int(1..10000)
      persuasiveFraming?: { authority?: string[]; commitment?: string[]; scarcity?: string[]; socialProof?: string[]; reciprocity?: string[] }
      citations?: { title: string; url: string; license: "SAFE"|"REVIEW" }[]
      licenseSummary: { overall: "SAFE"|"REVIEW"; notes?: string }
      successCriteria: string[1..20]
      structuredOutputs:
        applicationRecordSchemaRef: "schemas/skill-application-record.schema.json" // REQUIRED
      ```

      **Content Quality (Manual):**

      - ‚ÄúWhen to Use‚Äù, ‚ÄúHow to Apply‚Äù (stepwise), ‚ÄúSuccess Criteria‚Äù
      - ‚ÄúCommon Pitfalls‚Äù and ‚ÄúExamples‚Äù (runnable or verifiable)
      - brAInwav branding included in outputs where appropriate
      - Inclusive language; no dark patterns

      **Security Validation (Automated):**

      - Rejects SQL/command/path injection, hardcoded secrets, insecure shells
      - Code blocks scanned by Semgrep; repo scanned by gitleaks/OSV

      **Ethical Validation (Manual):**

      - Facts cited; no manipulation; respects autonomy
      - Claims marked `[Inference]`/`[Speculation]` if unproven

      ### 2.3 Storage

      **Directory Structure:**

      ```text
      skills/
      ‚îú‚îÄ‚îÄ README.md
      ‚îú‚îÄ‚îÄ schemas/skill-application-record.schema.json
      ‚îú‚îÄ‚îÄ examples/
      ‚îú‚îÄ‚îÄ coding/ security/ testing/ documentation/ automation/
      ‚îú‚îÄ‚îÄ communication/ analysis/ integration/ observability/
      ‚îî‚îÄ‚îÄ archived/
      ```

      **File Naming:** `skill-{descriptive-name}.md` (kebab‚Äëcase); must match frontmatter `id`.

      **Version Control:** semantic versioning; `deprecated: true` + `replacedBy` when retiring.

      ### 2.4 Discovery

      **MCP Tooling (REQUIRED for agents):**

      ```typescript
      // MCP tool contracts (JSON-Schema enforced)
      skill_search(args: { query: string; category?: string; difficulty?: string; topK?: number; threshold?: number })
      skill_get(args: { id: string })
      skill_apply(args: { id: string; context: object }) -> returns { planSteps: string[]; outputs: object } // structured
      ```

      **RAG Surface:** index skills; semantic search (Qdrant or equivalent); store vector config in repo.

      ### 2.5 Application

      **Standard Flow:** Search ‚Üí Read ‚Üí Apply ‚Üí Record ‚Üí Link ‚Üí Analyze.

      **Structured Application Record (REQUIRED):**

      ```json
      // schemas/skill-application-record.schema.json (excerpt)
      {
        "type":"object",
        "required":["skillId","skillVersion","outcome","effectivenessScore","traceId","timestamp","brand"],
        "properties":{
          "skillId":{"type":"string"},
          "skillVersion":{"type":"string"},
          "outcome":{"enum":["success","partial","failure"]},
          "effectivenessScore":{"type":"number","minimum":0,"maximum":1},
          "traceId":{"type":"string","pattern":"^[0-9a-f]{32}$"},
          "timestamp":{"type":"string","format":"date-time"},
          "brand":{"const":"brAInwav"}
        }
      }
      ```

      **Local Memory Write (example):**

      ```javascript
      memoryStore({
        content: "Applied skill-refactoring-guard-clauses to task-123. Outcome: success.",
        importance: 8,
        tags: ["skill-applied","skill-refactoring-guard-clauses","success"],
        metadata: {
          skillUsed: "skill-refactoring-guard-clauses",
          skillVersion: "1.2.0",
          outcome: "success",
          effectivenessScore: 0.9,
          traceparent: "<w3c-traceparent>",
          branding: "brAInwav"
        }
      })
      ```

      **Relationship Link:**

      ```javascript
      relationships({
        relationship_type: "create",
        source_memory_id: "<outcome-memory-id>",
        target_memory_id: "skill-refactoring-guard-clauses",
        relationship_type_enum: "applies",
        strength: 0.0-1.0
      })
      ```

      ### 2.6 Updates & Deprecation

      - SemVer bump; update `last_updated`; document changes
      - Breaking guidance ‚Üí new skill + deprecate old (`deprecated: true`, `replacedBy`)
      - Keep deprecated skills searchable but down‚Äëranked for 6 months, then archive

      ### 2.7 Retirement

      Retire when: no usage in 12 months, effectiveness < 50%, replaced, or obsolete.

      Process: mark deprecated ‚Üí notify ‚Üí archive (`skills/archived/`) ‚Üí remove from indices.

      ---

      ## 3. Effectiveness Tracking

      ### 3.1 Metrics

      - **Success Rate** (‚â• 10 applications): `success/(success+partial+failure)`
      - **Application Frequency** (‚â• 1/month target)
      - **Relationship Strength** (avg ‚â• 0.7 target)
      - **A/B or cohort deltas** (optional for optimization)

      ### 3.2 Gates & Remediation

      - Falling below thresholds ‚Üí review, update plan, or deprecate
      - Track remediation in skill‚Äôs changelog; re‚Äëvalidate effectiveness after changes

      ---

      ## 4. Persuasive Framing Standards

      **Elements:** authority, commitment, scarcity, socialProof, reciprocity.
      **Ethical Requirements (MUST):** honest, beneficial, cited, proportional, respectful.
      **Stats:** If quantitative claims are used, provide citations; otherwise mark as `[Unverified]` and avoid numeric claims.

      ---

      ## 5. Integration with Cortex‚ÄëOS

      ### 5.1 Agentic Coding Workflow Touchpoints

      - **Research:** reference skills + citations in `research/findings.md`
      - **Planning:** include skill IDs in `implementation-plan.md`; add success criteria
      - **Implementation:** apply guidance; store TDD progress with skill ID
      - **Review:** verify success criteria met; deviations documented
      - **Verification:** confirm gates; update effectiveness metrics
      - **Archive:** write final metrics; link outcomes to skill

      ### 5.2 Testing Standards

      - Adhere to `.cortex/rules/testing-standards.md`: coverage ‚â•90% global; ‚â•95% changed lines; mutation ‚â•90% (where enabled); performance budgets.

      ### 5.3 Code Style

      - Follow `CODESTYLE.md`: named exports, ‚â§ 40 lines per function, async/await with cancellation, strict types, brAInwav branding.

      ---

      ## 6. CI/CD Integration

      ### 6.1 Automated Validation

      ```bash
      pnpm skills:validate           # schema/frontmatter/structured outputs
      pnpm skills:security-scan      # semgrep/gitleaks/osv on code blocks and repo
      pnpm skills:parse-all          # index build
      pnpm sbom:generate             # CycloneDX 1.7
      pnpm attest:sign && pnpm verify:attest  # SLSA v1.1 + Cosign v3 bundle
      ```

      ### 6.2 Pre-commit Hooks

      ```bash
      pnpm skills:validate --changed
      pnpm skills:security-scan --changed
      ```

      ### 6.3 PR Requirements

      1. Evidence links (Local Memory outcomes, ‚â•5 for new skills)
      2. Peer review approval
      3. Validator/scanner logs attached
      4. README updates (if needed)
      5. Changeset + release notes (if published package impacted)

      ---

      ## 7. Governance Enforcement

      ### 7.1 Review Checklist (must pass before merge)

      - [ ] Schema validation passes
      - [ ] Structured outputs present & validated
      - [ ] Security scanners clean (Semgrep/gitleaks/OSV)
      - [ ] Frontmatter complete and valid
      - [ ] Content quality reviewed (When/How/Success/Pitfalls/Examples)
      - [ ] Ethical framing and citations present
      - [ ] brAInwav branding present in relevant examples
      - [ ] Success criteria defined and testable
      - [ ] Effectiveness evidence present (for new skills)
      - [ ] Correct category/tags; version bumped; changelog entry

      ### 7.2 Metrics & Escalation

      - Track pass rates for validators/scanners; target 100%
      - Non‚Äëcompliance ‚Üí block merge; repeated issues ‚Üí access review (per Constitution)

      ---

      ## 8. Future Enhancements

      - Analytics dashboard; skill recommendations; cross‚Äëskill graphs
      - A/B testing; multi‚Äëlanguage skills; automated extraction from patterns

      ---

      ## 9. References

      - `skills/README.md`
      - `AGENTS.md ¬ß24.1` (skills ops)
      - `.cortex/rules/agentic-coding-workflow.md`
      - `.cortex/rules/testing-standards.md`
      - `.cortex/rules/CODESTYLE.md`
      - `.cortex/rules/00-core/AGENT_CHARTER.md`
      - `@cortex-os/contracts/skill-events.ts`
      - `packages/memory-core/src/skills/`

      ---

      **Maintained by:** brAInwav Development Team
      **Version:** 1.2.0
      **Last Updated:** 2025-11-11
      **Status:** Authoritative
